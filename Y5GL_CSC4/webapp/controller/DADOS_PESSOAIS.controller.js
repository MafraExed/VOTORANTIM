sap.ui.define(["Y5GL_CSC4/Y5GL_CSC4/controller/BaseController","sap/ui/Device","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/ui/model/Filter"],function(e,t,a,i,r,o){"use strict";var s;var n;return e.extend("Y5GL_CSC4.Y5GL_CSC4.controller.DADOS_PESSOAIS",{onInit:function(){this.getRouter().getRoute("DADOS_PESSOAIS").attachPatternMatched(this._onObjectMatched,this);var e=sap.ushell.Container.getUser().getFullName();this.getView().byId("idTitleDep").setText(e);var t=jQuery.sap.getModulePath("Y5GL_CSC4.Y5GL_CSC4");var a=t+"/imagens/loading.gif";this.getView().byId("idimg").setSrc(a)},_onObjectMatched:function(e){s=e.getParameter("arguments").Pernr;n=e.getParameter("arguments").Chamado;this.getView().byId("idTitleDependentes").setText("Datos personales - (Matrícula - "+s+") - Chamado - "+n+" ");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_MEUS_DADOS_ECSet",{Pernr:s,Tipo:"V",Chamado:n});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getView().getModel();var a=this;t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){a.loading(true)},dataReceived:function(){a.loading(false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");return}},onBackMaster:function(){this.getRouter().navTo("worklist")},onAprovar:function(){var e=this.getView();var t=e.byId("IdNomeCompleto").getValue();var o=e.byId("IdDataNascimento").getValue();var s=e.byId("IdSexo").getSelectedKey();var n=e.byId("IdNacionaliade").getSelectedKey();var l=e.byId("IdLocNascimento").getValue();var d=e.byId("IdEstNasc").getSelectedKey();var u=e.byId("IdPaisNasc").getSelectedKey();var g=e.byId("IdAposentado").getSelectedKey();var c=e.byId("IdRaca").getSelectedKey();var p=e.byId("IdCasadoDesde").getValue();var m=e.byId("IdEstCivil").getSelectedKey();var v=e.byId("IdIdioma").getSelectedKey();var I=e.byId("IdCodNat").getValue();var h;var f=this.getView().getModel();var b=this;var V;var y;var C;var w;var S={};S.Vorna=this.getView().byId("IdVorna").getValue();S.Rufnm=this.getView().byId("IdRufnm").getValue();S.Nachn=this.getView().byId("IdNachn").getValue();S.Name2=this.getView().byId("IdName2").getValue();if(S.Nachn===""){this.getView().byId("IdNachn").setValueState("Error");sap.m.MessageBox.error("Apelido no informado");return}else{this.getView().byId("IdNomeCompleto").setValueState("Success")}if(t===""){this.getView().byId("IdName2").setValueState("Error");sap.m.MessageBox.error("Nombre no informado");return}else{this.getView().byId("IdName2").setValueState("Success")}S.Nome=t;o=o.substring(0,4)+o.substring(5,7)+o.substring(8,10);S.DtNasc=o;S.Sexo=s;S.Pais=u;S.Estado=d;S.Nacionalidade=n;S.Municipio=l;S.CodNaturalidade=I;S.Idioma=v;S.EstadoCivil=m;p=p.substring(0,4)+p.substring(5,7)+p.substring(8,10);S.DtCasamento=p;S.Raca=c;S.Aposentado=g;S.Tipo="X";w="/ZET_MEUS_DADOS_ECSet(Pernr='0',Tipo='A',Chamado='0')";h=new a({title:"Confirmação",type:"Message",content:new r({text:"Después de la confirmación, no será posible cambiar el archivo adjunto hasta que se complete el proceso. ¿Quieres continuar?"}),beginButton:new i({text:"Sí",press:function(){f.update(w,S,{success:function(e,t){sap.m.MessageBox.success("Su inclusión / cambio ha comenzado y se seguirá procesando. Espere comentarios o siga la aplicación.",{actions:["OK"],onClose:function(e){b.getView().getModel().refresh(true);b.onCancel()}})},error:function(e){V=e;V=V.responseText;y=JSON.parse(V);C=y.error.message.value;sap.m.MessageBox.error(C,{actions:["OK"],onClose:function(e){}});return}});h.close()}}),endButton:new i({text:"No",press:function(){h.close()}}),afterClose:function(){h.destroy()}});h.open()},handleValueHelp:function(e){var t=e.getSource().getValue();this.inputId=e.getSource().getId();if(!this._valueHelpDialog1){this._valueHelpDialog1=sap.ui.xmlfragment("Y5GL_CSC4.Y5GL_CSC4.view.LocNascimento",this);this.getView().addDependent(this._valueHelpDialog1)}this._valueHelpDialog1.open(t);if(t){this._valueHelpDialog1.getBinding("items").filter([new o("IMunicipio",sap.ui.model.FilterOperator.EQ,t)])}this._valueHelpDialog1.getBinding("items").filter([new o("IUf",sap.ui.model.FilterOperator.EQ,"SP")])},onSearchMunicipio:function(e){var t=e.getParameter("value");if(t){var a=t;var i=new sap.ui.model.Filter("IMunicipio",sap.ui.model.FilterOperator.EQ,a);var r=new sap.ui.model.Filter("IUf",sap.ui.model.FilterOperator.EQ,"SP");e.getSource().getBinding("items").filter([i,r])}},onConfirmMunicipio:function(e){var t=e.getParameter("selectedItem");this._valueHelpDialog1=null;if(t){var a=t.getTitle();var i=t.getDescription();var r=i+"-"+a;this.getView().byId("IdCodNat").setValue(r);var o=this.getView().byId(this.inputId);o.setValue(a)}},onEdit:function(){this.getView().byId("Form2").setVisible(false);this.getView().byId("form1").setVisible(true);this.getView().byId("UploadCollection").setUploadButtonInvisible(false);this.getView().byId("IdEnviarDetailDep").setVisible(true);this.getView().byId("IdEditDados").setVisible(false);this.getView().byId("IdCancelarDetailDep").setVisible(true)},onCancel:function(){this.getView().byId("Form2").setVisible(true);this.getView().byId("form1").setVisible(false);this.getView().byId("UploadCollection").setUploadButtonInvisible(true);this.getView().byId("IdEnviarDetailDep").setVisible(false);this.getView().byId("IdEditDados").setVisible(true);this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().getModel().refresh(true)},onChange:function(e){var t=e.getSource();var a=this.getView().getModel();a.refreshSecurityToken();var i=a.oHeaders;var r=i["x-csrf-token"];var o=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:r});t.addHeaderParameter(o)},onBeforeUploadStarts:function(e){var t="0";var a="0002";var i="0";var r="0";if(t!==""||i!==""||r!==""){var o=t+"$"+a+"$"+i+"$"+r+"$"+e.getParameter("fileName");var s=new sap.m.UploadCollectionParameter({name:"slug",value:o});e.getParameters().addHeaderParameter(s)}},onuploadComplete:function(e){var t="0002";var a="0";var i="C";if(s!==""||a!==""){var r=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,t);var o=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var n=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,i);var l=this.getView().byId("UploadCollection");l.getBinding("items").filter([r,o,n])}},onmodelListContextChange:function(e){var t="0002";var a="0";var i="C";if(s!==""||a!==""){var r=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,s);var o=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,t);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var l=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,i);var d=this.getView().byId("UploadCollection");d.getBinding("items").filter([r,o,n,l])}},onDeleteSelectedItems:function(e){var t="0002";var o="0";var n=this.getView().getModel();var l="0";var d="0";var u=t;var g="0";var c="E";var o=o;var p=e.getParameters("listItem");var m=p.documentId;m=parseInt(m);var v=this.getView().byId("idTipo").getValue();if(v==="Em ResoluÃ§Ã£o"){sap.m.MessageBox.error("Não será possivel exclusão do anexo, quando o chamado ja existir.");return}var I="/ZET_GLRH_UPLOADSet(Ano='"+l+"',Favor='"+d+"',Infty='"+u+"',Mes='"+g+"',Pernr='"+s+"',Tipo='"+c+"',Subty='"+o+"',DocId="+m+",Objps='',Icnum='')";var h={};h.DocId=1;var f=this.getView().byId("UploadCollection");var b=new a({title:"Confirmação",type:"Message",content:new r({text:"Confirma a exclusão anexo?"}),beginButton:new i({text:"Sim",press:function(){n.update(I,h,{success:function(e,t){sap.m.MessageBox.success("Documentos excluido com sucesso.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){f.getBinding("items").refresh(true)}})},error:function(e){var t=e;t=t.responseText;var a=JSON.parse(t);var i=a.error.message.value;sap.m.MessageBox.error(i,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){f.getBinding("items").refresh(true)}});return}});b.close()}}),endButton:new i({text:"Não",press:function(){b.close()}}),afterClose:function(){b.destroy()}});b.open()},formatVisibleEdit:function(e){if(e==="Em ResoluÃ§Ã£o"){return false}else{return true}}})});