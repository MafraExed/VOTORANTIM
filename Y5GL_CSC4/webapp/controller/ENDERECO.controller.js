sap.ui.define(["Y5GL_CSC4/Y5GL_CSC4/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/Dialog","sap/m/Button","sap/m/Text"],function(e,t,i,r,a){"use strict";var o;return e.extend("Y5GL_CSC4.Y5GL_CSC4.controller.ENDERECO",{onInit:function(){this.getRouter().getRoute("ENDERECO").attachPatternMatched(this._onObjectMatched,this)},FormatFalse:function(e){return false},formatVisibleEdit:function(e){if(e==="Em ResoluÃ§Ã£o"){return false}else{return true}},formatVisible:function(e){if(e==="Em ResoluÃ§Ã£o"){return true}else{return false}},onChangeCEP:function(){var e=this.getView().byId("IdCEP").getValue();var t="https://viacep.com.br/ws/"+e+"/json/?callback=callback_name";var i;var r=this;$.ajax({url:t,dataType:"jsonp",success:function(e){i=e;r.BuscaEndereco(i)},error:function(){}})},BuscaEndereco:function(e){var t=e.logradouro;var i=e.bairro;var r=e.localidade;var a=e.uf;var o=e.ibge;var d=e.cep;this.getView().byId("IdRua").setValue(t);this.getView().byId("IdBairro").setValue(i);this.getView().byId("IdCidade").setValue(r);this.getView().byId("IdUF").setValue(a);this.getView().byId("IdCodMunicipio").setValue(o);this.getView().byId("IdCEP").setValue(d)},FormatEditable:function(e){return true},_onObjectMatched:function(e){var t="C";o=e.getParameter("arguments").Pernr;var i="0";this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_GLHR_CAD_ENDERECOSet",{ITipo:t,Pernr:o,Subty:i});this._bindView("/"+e)}.bind(this))},onBackMaster:function(){this.getRouter().navTo("worklist")},_bindView:function(e){var t=this;var i=this.getView().getModel();i.setSizeLimit(1e3);i.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.loading(true)},dataReceived:function(){t.loading(false)}}})},FormatButtom1:function(e){if(e!==""||e===undefined){return false}else{return true}},FormatButtom2:function(e){if(e!==""||e===undefined){return true}else{return false}},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");return}var i=this.getView().byId("idTipo").getValue();if(i==="X"){this.getView().byId("IdEditDetailDep").setVisible(false)}this.getView().byId("IdTipo_End").setEditable(false);this.filtraProvinicia()},filtraProvinicia:function(){var e=this.getView().byId("IdZzregion").getSelectedKey();var t=this.getView().byId("IdZzcounc");var i=new sap.ui.model.Filter("Regio",sap.ui.model.FilterOperator.EQ,e);t.getBinding("items").filter([i]);this.filtraDistrito()},filtraDistrito:function(){var e=this.getView().byId("IdZzregion").getSelectedKey();var t=this.getView().byId("IdZzcounc").getSelectedKey();var i=new sap.ui.model.Filter("Regio",sap.ui.model.FilterOperator.EQ,e);var r=new sap.ui.model.Filter("Counc",sap.ui.model.FilterOperator.EQ,t);var a=this.getView().byId("IdZzcityc");a.getBinding("items").filter([i,r])},onCancela:function(){this.getView().getModel().refresh(true)},onChangeZzregion:function(){var e=this.getView().byId("IdZzregion").getSelectedKey();var t=this.getView().byId("IdZzcounc");var i=new sap.ui.model.Filter("Regio",sap.ui.model.FilterOperator.EQ,e);t.getBinding("items").filter([i]);this.getView().byId("IdZzcounc").setEditable(true)},onChangeZzcounc:function(){var e=this.getView().byId("IdZzregion").getSelectedKey();var t=this.getView().byId("IdZzcounc").getSelectedKey();var i=new sap.ui.model.Filter("Regio",sap.ui.model.FilterOperator.EQ,e);var r=new sap.ui.model.Filter("Counc",sap.ui.model.FilterOperator.EQ,t);var a=this.getView().byId("IdZzcityc");a.getBinding("items").filter([i,r]);this.getView().byId("IdZzcityc").setEditable(true)},onChangeZzcityc:function(){var e=this.getView().byId("IdZzregion").getSelectedKey();var t=this.getView().byId("IdZzcounc").getSelectedKey();var i=this.getView().byId("IdZzcityc").getSelectedKey();var r=e+t+i;this.getView().byId("IdZzubigeo").setValue(r)},onEdit:function(){this.getView().byId("IdCEP").setEditable(true);this.getView().byId("IdNumero").setEditable(true);this.getView().byId("IdComplemento").setEditable(true);this.getView().byId("IdTipoEnd").setEditable(false);this.getView().byId("IdRua").setEditable(true);this.getView().byId("IdBairro").setEditable(true);this.getView().byId("IdCidade").setEditable(true);this.getView().byId("idProvincia").setEditable(true);this.getView().byId("IdCodMunicipio").setEditable(true);this.getView().byId("IdLand1").setEditable(true);this.getView().byId("IdZztpcalle").setEditable(true);this.getView().byId("IdZztpzona").setEditable(true);this.getView().byId("IdZdszon").setEditable(true);this.getView().byId("IdZzregion").setEditable(true);this.getView().byId("IdZzcityc").setEditable(false);this.getView().byId("IdZzubigeo").setEditable(false);this.getView().byId("IdSalvarDetailDep").setVisible(true);this.getView().byId("IdCancelaAprov").setVisible(true);this.getView().byId("UPLOAD").setVisible(true);this.getView().byId("IdEditDetailDep").setVisible(false)},onChange:function(e){var t=e.getSource();var i=this.getView().getModel();i.refreshSecurityToken();var r=i.oHeaders;var a=r["x-csrf-token"];var o=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:a});t.addHeaderParameter(o)},onBeforeUploadStarts:function(e){var t="0";var i="0006";var r=this.getView().byId("IdTipoEnd").getSelectedKey();var a="0";if(t!==""||r!==""||a!==""){var o=t+"$"+i+"$"+r+"$"+a+"$"+e.getParameter("fileName");var d=new sap.m.UploadCollectionParameter({name:"slug",value:encodeURIComponent(o)});e.getParameters().addHeaderParameter(d)}},onuploadComplete:function(e){var t="0";var i="0006";var r=this.getView().byId("IdTipoEnd").getSelectedKey();var a="C";if(t!==""||r!==""){var o=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,i);var d=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,r);var n=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,a);var s=this.getView().byId("UploadCollection");s.getBinding("items").filter([o,d,n])}},onmodelListContextChange:function(e){var t="0006";var i=this.getView().byId("IdTipoEnd").getSelectedKey();var r="C";if(o!==""||i!==""){var a=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,o);var d=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,t);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,i);var s=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,r);var l=this.getView().byId("UploadCollection");l.getBinding("items").filter([a,d,n,s])}},onAprova:function(){var e;var t;var o=this;var d=this.getView().getModel();var n;var s={};var l;var u;var g=this.getView().byId("IdTipoEnd").getSelectedKey();s.Subty=g;if(s.Subty===""){this.getView().byId("IdTipoEnd").setValueState("Error");sap.m.MessageBox.error("Informe o tipo de endereço");return}else{this.getView().byId("IdTipoEnd").setValueState("Success")}var c=this.getView().byId("IdCEP").getValue();s.Cep=c;var I=this.getView().byId("IdTipo_End").getSelectedKey();s.Zztpend=I;var y=this.getView().byId("IdRua").getValue();s.Rua=y;var v=this.getView().byId("IdNumero").getValue();s.Numero=v;var b=this.getView().byId("IdComplemento").getValue();s.Complemento=b;var p=this.getView().byId("IdBairro").getValue();s.Bairro=p;var V=this.getView().byId("IdCidade").getValue();s.Cidade=V;var h=this.getView().byId("idProvincia").getSelectedKey();s.State=h;var w=this.getView().byId("IdCodMunicipio").getValue();s.Ibge=w;var f=this.getView().byId("IdLand1").getSelectedKey();s.Land1=f;var m=this.getView().byId("IdZztpcalle").getSelectedKey();s.Zztpcalle=m;var E=this.getView().byId("IdZztpzona").getSelectedKey();s.Zztpzona=E;var C=this.getView().byId("IdZdszon").getValue();s.Zdszon=C;var S=this.getView().byId("IdZzregion").getSelectedKey();s.Zzregion=S;var z=this.getView().byId("IdZzcounc").getSelectedKey();s.Zzcounc=z;var Z=this.getView().byId("IdZzcityc").getSelectedKey();s.Zzcityc=Z;var B=this.getView().byId("Idtelnr").getValue();s.Telnr=B;n="/ZET_GLHR_CAD_ENDERECOSet(ITipo='A',Pernr='0',Subty='"+g+"')";e=new i({title:"Confirmación",type:"Message",content:new a({text:"¿Confirmar la grabación de la dirección?"}),beginButton:new r({text:"Sí",press:function(){d.update(n,s,{success:function(e,t){sap.m.MessageBox.success("DIRECCIÓN REGISTRADA CON ÉXITO!",{actions:["OK"],onClose:function(e){o.getView().getModel().refresh(true)}})},error:function(e){t=e;t=t.responseText;l=JSON.parse(t);u=l.error.message.value;sap.m.MessageBox.error(u,{actions:["OK"],onClose:function(e){}});return}});e.close()}}),endButton:new r({text:"No",press:function(){e.close()}}),afterClose:function(){e.destroy()}});e.open()},onReprova:function(){var e;var t;var o=this;var d=this.getView().getModel();var n;var s={};var l;var u;var g=this.getView().byId("IdTipoEnd").getSelectedKey();s.Subty=g;if(s.Subty===""){this.getView().byId("IdTipoEnd").setValueState("Error");sap.m.MessageBox.error("Informe o tipo de endereço");return}else{this.getView().byId("IdTipoEnd").setValueState("Success")}var c=this.getView().byId("IdCEP").getValue();s.Cep=c;var I=this.getView().byId("IdTipo_End").getSelectedKey();s.Zztpend=I;var y=this.getView().byId("IdRua").getValue();s.Rua=y;var v=this.getView().byId("IdNumero").getValue();s.Numero=v;var b=this.getView().byId("IdComplemento").getValue();s.Complemento=b;var p=this.getView().byId("IdBairro").getValue();s.Bairro=p;var V=this.getView().byId("IdCidade").getValue();s.Cidade=V;var h=this.getView().byId("idProvincia").getSelectedKey();s.State=h;var w=this.getView().byId("IdCodMunicipio").getValue();s.Ibge=w;var f=this.getView().byId("IdLand1").getSelectedKey();s.Land1=f;var m=this.getView().byId("IdZztpcalle").getSelectedKey();s.Zztpcalle=m;var E=this.getView().byId("IdZztpzona").getSelectedKey();s.Zztpzona=E;var C=this.getView().byId("IdZdszon").getValue();s.Zdszon=C;var S=this.getView().byId("IdZzregion").getSelectedKey();s.Zzregion=S;var z=this.getView().byId("IdZzcounc").getSelectedKey();s.Zzcounc=z;var Z=this.getView().byId("IdZzcityc").getSelectedKey();s.Zzcityc=Z;n="/ZET_GLHR_CAD_ENDERECOSet(ITipo='R',Pernr='0',Subty='"+g+"')";e=new i({title:"Confirmación",type:"Message",content:new a({text:"¿Confirmar la grabación de la dirección?"}),beginButton:new r({text:"Sí",press:function(){d.update(n,s,{success:function(e,t){sap.m.MessageBox.success("DIRECCIÓN REGISTRADA CON ÉXITO!",{actions:["OK"],onClose:function(e){o.getView().getModel().refresh(true)}})},error:function(e){t=e;t=t.responseText;l=JSON.parse(t);u=l.error.message.value;sap.m.MessageBox.error(u,{actions:["OK"],onClose:function(e){}});return}});e.close()}}),endButton:new r({text:"No",press:function(){e.close()}}),afterClose:function(){e.destroy()}});e.open()},onDeleteSelectedItems:function(e){var t="0";var o="0006";var d=this.getView().byId("IdTipoEnd").getSelectedKey();var n=this.getView().getModel();var s="0";var l="0";var o=o;var u="0";var t="0";var g="E";var d=d;var c=e.getParameters("listItem");var I=c.documentId;I=parseInt(I);var y=this.getView().byId("idTipo").getValue();var v="0";var b=this.getView().byId("UploadCollection");if(y==="Em ResoluÃ§Ã£o"){sap.m.MessageBox.error("No será posible eliminar el archivo adjunto cuando el ticket ya exista.");return}var p="/ZET_GLRH_UPLOADSet(Ano='"+s+"',Favor='"+l+"',Infty='"+o+"',Mes='"+u+"',Pernr='"+t+"',Tipo='"+g+"',Subty='"+d+"',DocId="+I+",Objps='',Icnum='',Valor='',Dependentes='',Area='"+v+"')";var V={};V.DocId=1;var h=new i({title:"Confirmación",type:"Message",content:new a({text:"¿Confirmar la eliminación del archivo adjunto?"}),beginButton:new r({text:"Sim",press:function(){n.update(p,V,{success:function(e,t){sap.m.MessageBox.success("Documentos eliminados correctamente.",{actions:["OK"],onClose:function(e){b.getBinding("items").refresh(true)}})},error:function(e){var t=e;t=t.responseText;var i=JSON.parse(t);var r=i.error.message.value;sap.m.MessageBox.error(r,{actions:["OK"],onClose:function(e){b.getBinding("items").refresh(true)}});return}});h.close()}}),endButton:new r({text:"Não",press:function(){h.close()}}),afterClose:function(){h.destroy()}});h.open()},uploadButtonInvisible:function(e){if(e==="Em ResoluÃ§Ã£o"){return true}else{return false}}})});