sap.ui.define(["Y5GL_CSC4/Y5GL_CSC4/controller/BaseController","sap/ui/Device","Y5GL_CSC4/Y5GL_CSC4/model/formatter","sap/m/Button","sap/m/Dialog","sap/m/Text","sap/m/Label","sap/m/RadioButton","sap/ui/model/json/JSONModel"],function(e,t,i,a,s,r,d,o,l){"use strict";var n;var g;var u;var I;var V;var c;var b;var h;return e.extend("Y5GL_CSC4.Y5GL_CSC4.controller.DepententeDetail",{formatter:i,onInit:function(){this.getRouter().getRoute("DependenteDetail").attachPatternMatched(this._onObjectMatched,this);var e=jQuery.sap.getModulePath("Y5GL_CSC4.Y5GL_CSC4");var t=e+"/imagens/loading.gif";this.getView().byId("idimg").setSrc(t)},filtraProvinicia:function(){var e=this.getView().byId("idDepartamento").getSelectedKey();var t=this.getView().byId("idProvincia");var i=new sap.ui.model.Filter("Regio",sap.ui.model.FilterOperator.EQ,e);t.getBinding("items").filter([i])},filtraDistrito:function(){var e=this.getView().byId("idDepartamento").getSelectedKey();var t=this.getView().byId("idProvincia").getSelectedKey();var i=new sap.ui.model.Filter("Regio",sap.ui.model.FilterOperator.EQ,e);var a=new sap.ui.model.Filter("Counc",sap.ui.model.FilterOperator.EQ,t);var s=this.getView().byId("idDistrito");s.getBinding("items").filter([i,a])},formatSimNao:function(e){if(e==="X"){return"S"}else{return"N"}},onChangeCPF:function(){var e=this.getView().byId("idCpf").getValue();while(e.indexOf(".")!=-1){e=e.replace(".","")}while(e.indexOf("-")!=-1){e=e.replace("-","")}var t,i,a,s,r,d;var o;d=1;if(e.length<11){o=1}if(o!==1){for(s=0;s<e.length-1;s++)if(e.charAt(s)!=e.charAt(s+1)){d=0;break}if(!d){t=e.substring(0,9);i=e.substring(9);a=0;for(s=10;s>1;s--){a+=t.charAt(10-s)*s}r=a%11<2?0:11-a%11;if(r!=i.charAt(0)){o=1}t=e.substring(0,10);a=0;for(s=11;s>1;s--)a+=t.charAt(11-s)*s;r=a%11<2?0:11-a%11;if(r!=i.charAt(1)){o=1}}else{o=1}}else{o=1}if(o===1){sap.m.MessageBox.error("CPF inválido");this.getView().byId("idCpf").setValueState("Error")}else{this.getView().byId("idCpf").setValueState("Success")}},onVoltar:function(){this.getRouter().navTo("worklist")},formatVisibleEdit:function(e){if(e==="Em ResoluÃ§Ã£o"){return false}else{return true}},formatVisibleUpload:function(e){if(e==="Em ResoluÃ§Ã£o"){return true}else{return false}},_onAdd:function(e){this.getView().getModel().refresh(true);var t=e.getParameter("arguments").Pernr;var i=e.getParameter("arguments").Subty;var a="N";var s=e.getParameter("arguments").Objps;var r=e.getParameter("arguments").Favor;var d=e.getParameter("arguments").Icnum;var o;this.getView().byId("IdParentesco").setEditable(true);this.getView().byId("IdFavor").setEditable(true);this.getView().byId("IdFanam").setEditable(true);this.getView().byId("IdFgbdt").setEditable(true);this.getView().byId("IdSexo").setEditable(true);this.getView().byId("IdZzestciv").setEditable(true);this.getView().byId("IdIR").setEditable(true);this.getView().byId("idCpf").setEditable(true);this.getView().byId("IdSalvarDetailDep").setVisible(true);this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().byId("IdPlano").setEditable(true);this.getView().byId("IdParentesco").setValueState("None");this.getView().byId("IdFavor").setValueState("None");this.getView().byId("IdFanam").setValueState("None");this.getView().byId("IdFgbdt").setValueState("None");this.getView().byId("IdFgbdt").setValueState("None");this.getView().byId("IdSexo").setValueState("None");this.getView().byId("IdZzestciv").setValueState("None");this.getView().byId("IdPlano").setValueState("None");this.getView().byId("IdIR").setValueState("None");this.getView().byId("idCpf").setValueState("None");this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("IdCancelarDetailDep").setVisible(true);this.getView().byId("iddelete").setVisible(false);this.getView().byId("idTextEditar").setVisible(false);this.getView().byId("idTextExcluir").setVisible(false);this.getView().byId("idTextIncluir").setVisible(true);this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){o=this.getModel().createKey("ZET_GLRH_DEPENDENTESSet",{Pernr:t,Subty:i,Objps:s,Tipo:a,Favor:r,Icnum:d});this._bindView("/"+o)}.bind(this))},onEdit:function(){n=this.getView().byId("IdParentesco").getSelectedKey();g=this.getView().byId("IdFavor").getValue();u=this.getView().byId("IdFanam").getValue();I=this.getView().byId("IdFgbdt").getValue();V=this.getView().byId("IdSexo").getValue();c=this.getView().byId("IdZzestciv").getSelectedKey();b=this.getView().byId("IdIR").getSelectedKey();if(b==="S"){b="SIM"}else{b="Não"}this.getView().byId("UploadCollection").setUploadButtonInvisible(false);this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("IdSalvarDetailDep").setVisible(true);this.getView().byId("IdCancelarDetailDep").setVisible(true);this.getView().byId("IdParentesco").setEditable(true);this.getView().byId("IdFavor").setEditable(true);this.getView().byId("IdFanam").setEditable(true);this.getView().byId("IdFgbdt").setEditable(true);this.getView().byId("IdSexo").setEditable(true);this.getView().byId("IdZzestciv").setEditable(true);this.getView().byId("IdIR").setEditable(true);this.getView().byId("idCpf").setEditable(true);this.getView().byId("IdPlano").setEditable(false);this.getView().byId("idTextEditar").setVisible(true);this.getView().byId("idTextExcluir").setVisible(false);this.getView().byId("idTextIncluir").setVisible(false)},onCancel:function(){this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().byId("IdEditDetailDep").setVisible(true);this.getView().byId("IdSalvarDetailDep").setVisible(false);this.getView().byId("UploadCollection").setUploadButtonInvisible(true);this.getView().byId("IdParentesco").setEditable(false);this.getView().byId("IdFavor").setEditable(false);this.getView().byId("IdFanam").setEditable(false);this.getView().byId("IdFgbdt").setEditable(false);this.getView().byId("IdSexo").setEditable(false);this.getView().byId("IdZzestciv").setEditable(false);this.getView().byId("IdIR").setEditable(false);this.getView().byId("idCpf").setEditable(false);this.getView().byId("IdPlano").setEditable(false);this.getView().byId("IdParentesco").setSelectedKey(n);this.getView().byId("IdFavor").setValue(g);this.getView().byId("IdFanam").setValue(u);this.getView().byId("IdFgbdt").setValue(I);this.getView().byId("IdSexo").setValue(V);this.getView().byId("IdZzestciv").setSelectedKey(c);this.getView().byId("IdIR").setValue(b);this.getView().byId("idTextEditar").setVisible(false);this.getView().byId("idTextExcluir").setVisible(false);this.getView().byId("idTextIncluir").setVisible(false)},onchangeParentesco:function(){var e=this.getView().byId("IdParentesco").getSelectedKey();if(e==="11"||e==="12"){this.getView().byId("idformplano").setVisible(false)}else{this.getView().byId("idformplano").setVisible(true)}},_onObjectMatched:function(e){var t=e.getParameter("arguments").Tipo;var i=e.getParameter("arguments").Pernr;var a=e.getParameter("arguments").Subty;var s="V";var r=e.getParameter("arguments").Objps;var d=e.getParameter("arguments").Favor;var o=e.getParameter("arguments").Icnum;h=e.getParameter("arguments").Chamado;this.getView().byId("IdObjps").setValue(r);this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_GLRH_DEPENDENTESSet",{Icnum:o,Pernr:i,Subty:a,Objps:r,Tipo:s,Favor:d,Chamado:h});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this;t.loading(false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.loading(true)},dataReceived:function(){t.loading(false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}this.filtraProvinicia();this.filtraDistrito()},onExcluir:function(){var e=this;var t=this.getView().getModel();var i=this.getView().byId("IdPernr").getValue();var d=this.getView().byId("IdParentesco").getSelectedKey();var o=this.getView().byId("IdObjps").getValue();var l=this.getView().byId("IdFavor").getValue();var n=this.getView().byId("idCpf").getValue();var g="/ZET_GLRH_DEPENDENTESSet(Pernr='"+i+"',Subty='"+d+"',Objps='"+o+"',Favor='"+l+"',Tipo='E',Icnum='"+n+"')";var u={};u.Parentesco=this.getView().byId("IdParentesco").getSelectedKey();u.Favor=this.getView().byId("IdFavor").getValue();u.Fanam=this.getView().byId("IdFanam").getValue();u.Fgbdt=this.getView().byId("IdFgbdt").getValue();u.Sexo=this.getView().byId("IdSexo").getSelectedKey();u.Zzestciv=this.getView().byId("IdZzestciv").getSelectedKey();u.Irflg=this.getView().byId("IdIR").getSelectedKey();u.Operation="Exclusão";if(u.Irflg==="S"){u.Irflg="X"}else{u.Irflg=""}u.Icnum=this.getView().byId("idCpf").getValue();u.Zplanosaude=this.getView().byId("IdPlano").getSelectedKey();if(u.Zplanosaude==="S"){u.Zplanosaude="X"}else{u.Zplanosaude=" "}var I=new s({title:"Confirmação",type:"Message",content:new r({text:"Após a confirmação não será possivel alterar o anexo até que o processo seja finalizado, deseja seguir?"}),beginButton:new a({text:"Sim",press:function(){t.update(g,u,{success:function(t,i){sap.m.MessageBox.success("Sua exclusão foi iniciada e seguirá para processamento, aguarde retorno ou acompanhae pelo app.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(t){e.getView().getModel().refresh(true);e.getRouter().navTo("DEPENDENTES")}})},error:function(e){var t=e;t=t.responseText;var i=JSON.parse(t);var a=i.error.message.value;sap.m.MessageBox.error(a);return}});I.close()}}),endButton:new a({text:"Não",press:function(){I.close()}}),afterClose:function(){I.destroy()}});I.open()},onChange:function(e){var t=e.getSource();var i=this.getView().getModel();i.refreshSecurityToken();var a=i.oHeaders;var s=a["x-csrf-token"];var r=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:s});t.addHeaderParameter(r)},onBeforeUploadStarts:function(e){var t=this.getView().byId("IdPernr").getValue();var i="0021";var a=this.getView().byId("IdParentesco").getSelectedKey();var s=this.getView().byId("IdObjps").getValue();if(s===""){s="0"}var r=this.getView().byId("IdParentesco").getSelectedKey();var d=this.getView().byId("IdFavor").getValue();var o=this.getView().byId("idCpf").getValue();if(r===""){sap.m.MessageBox.error("Selecione o Grau de Parentesco.");return}if(t!==""&&a!==""&&s!==""){var l=t+"$"+i+"$"+a+"$"+s+"$"+e.getParameter("fileName")+"$"+d+"$"+o;var n=new sap.m.UploadCollectionParameter({name:"slug",value:l});e.getParameters().addHeaderParameter(n)}else{sap.m.MessageBox.error("Não foi possivel fazer upload do arquivo.")}},onuploadComplete:function(e){var t=this.getView().byId("IdPernr").getValue();var i="0021";var a=this.getView().byId("IdParentesco").getSelectedKey();var s="C";var r=this.getView().byId("IdFavor").getValue();var d=this.getView().byId("idCpf").getValue();if(t!==""&&a!==""){this.getView().byId("IdParentesco").setEditable(false);var o=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,t);var l=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,i);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var g=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,s);var u=new sap.ui.model.Filter("Favor",sap.ui.model.FilterOperator.EQ,r);var I=new sap.ui.model.Filter("Icnum",sap.ui.model.FilterOperator.EQ,d);var V=this.getView().byId("UploadCollection");V.getBinding("items").filter([o,l,n,g,u,I])}},onmodelListContextChange:function(e){var t=this.getView().byId("IdPernr").getValue();var i="0021";var a=this.getView().byId("IdParentesco").getSelectedKey();var s="C";var r=this.getView().byId("IdFavor").getValue();var d=this.getView().byId("idCpf").getValue();if(t!==""||a!==""){var o=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,t);var l=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,i);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var g=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,s);var u=new sap.ui.model.Filter("Favor",sap.ui.model.FilterOperator.EQ,r);var I=new sap.ui.model.Filter("Icnum",sap.ui.model.FilterOperator.EQ,d);var V=this.getView().byId("UploadCollection");V.getBinding("items").filter([o,l,n,g,u,I])}},onSave:function(){var e=this;var t=this.getView().getModel();var i=this.getView().byId("IdPernr").getValue();var d=this.getView().byId("IdParentesco").getSelectedKey();var o=this.getView().byId("IdObjps").getValue();var l=this.getView().byId("IdFavor").getValue();var n=this.getView().byId("idCpf").getValue();var g="/ZET_GLRH_DEPENDENTESSet(Pernr='"+i+"',Subty='"+d+"',Objps='"+o+"',Favor='"+l+"',Tipo='A',Icnum='"+n+"',Chamado='"+h+"')";var u={};u.Pernr=i;u.Parentesco=this.getView().byId("IdParentesco").getSelectedKey();if(u.Parentesco===""){this.getView().byId("IdParentesco").setValueState("Error");sap.m.MessageBox.error("Selecione o Grau de Parentesco.");return}else{this.getView().byId("IdParentesco").setValueState("Success")}u.Favor=this.getView().byId("IdFavor").getValue();if(u.Favor===""){this.getView().byId("IdFavor").setValueState("Error");sap.m.MessageBox.error("Preencher o Nome.");return}else{this.getView().byId("IdFavor").setValueState("Success")}u.Fanam=this.getView().byId("IdFanam").getValue();if(u.Fanam===""){this.getView().byId("IdFanam").setValueState("Error");sap.m.MessageBox.error("Preencher o sobrenome.");return}else{this.getView().byId("IdFanam").setValueState("Success")}u.Fgbdt=this.getView().byId("IdFgbdt").getValue();if(u.Fgbdt===""){this.getView().byId("IdFgbdt").setValueState("Error");sap.m.MessageBox.error("Selecione data de nascimento.");return}else{this.getView().byId("IdFgbdt").setValueState("Success")}u.Sexo=this.getView().byId("IdSexo").getSelectedKey();if(u.Sexo===" "){this.getView().byId("IdSexo").setValueState("Error");sap.m.MessageBox.error("Selecione o sexo.");return}else{this.getView().byId("IdSexo").setValueState("Success")}u.Zzestciv=this.getView().byId("IdZzestciv").getSelectedKey();if(u.Zzestciv===" "){this.getView().byId("IdZzestciv").setValueState("Error");sap.m.MessageBox.error("Selecione o Estado Civil.");return}else{this.getView().byId("IdZzestciv").setValueState("Success")}u.Irflg=this.getView().byId("IdIR").getSelectedKey();if(u.Irflg===" "){this.getView().byId("IdIR").setValueState("Error");sap.m.MessageBox.error("Selecione se é dependente de IR.");return}else{if(u.Irflg==="S"){u.Irflg="X"}else{u.Irflg=""}this.getView().byId("IdIR").setValueState("Success")}u.Icnum=this.getView().byId("idCpf").getValue();u.HealthplanInd=this.getView().byId("IdPlano").getSelectedKey();if(u.HealthplanInd==="S"){u.HealthplanInd="X"}else{u.HealthplanInd=" "}if(d==="11"||d==="12"){u.HealthplanInd="N"}u.Mothe=this.getView().byId("idNomedaMae").getValue();u.Fgbld=this.getView().byId("IdPaisNasc").getSelectedKey();u.Fanat=this.getView().byId("IdNacionaliade").getSelectedKey();u.ZzIctyp=this.getView().byId("idIdentificacion").getSelectedKey();u.ZzTpvia=this.getView().byId("idVia").getSelectedKey();u.ZzTxvia=this.getView().byId("idNombreVia").getValue();u.ZzNrvia=this.getView().byId("idNumeroVia").getValue();u.ZzNrint=this.getView().byId("idInterior").getValue();u.ZzTpzon=this.getView().byId("idTpZona").getSelectedKey();u.ZzNrodep=this.getView().byId("idNrodep").getValue();u.ZzNomzon=this.getView().byId("idZzNomzon").getValue();u.ZzRefer=this.getView().byId("idZzRefer").getValue();u.ZzCityc=this.getView().byId("idDistrito").getSelectedKey();u.ZzUbigeo=this.getView().byId("idUbigeo").getValue();u.ZzManza=this.getView().byId("idManzana").getValue();u.ZzLote=this.getView().byId("idLote").getValue();u.ZzKilom=this.getView().byId("idKilometro").getValue();u.ZzBlock=this.getView().byId("idBloque").getValue();u.ZzEtapa=this.getView().byId("idEtapa").getValue();u.ZzRegio=this.getView().byId("idDepartamento").getSelectedKey();u.ZzCounc=this.getView().byId("idProvincia").getSelectedKey();u.ZzStudy=this.getView().byId("IdZzStudy").getSelectedKey();if(u.ZzStudy==="S"){u.ZzStudy=true}else{u.ZzStudy=false}u.Fgbna=this.getView().byId("IdFgbna").getValue();if(u.Fgbna===""){this.getView().byId("IdFgbna").setValueState("Error");sap.m.MessageBox.error("Apelido de solteiro no llenado");return}u.Fgbot=this.getView().byId("IdLocNascimento").getValue();u.ZzIctyp=this.getView().byId("idIdentificacion").getSelectedKey();if(u.ZzIctyp===""){this.getView().byId("idIdentificacion").setValueState("Error");sap.m.MessageBox.error("Tipo de documento no llenado");return}u.ZzIcnum=this.getView().byId("idZzIcnum").getValue();if(u.ZzIcnum===""){this.getView().byId("idZzIcnum").setValueState("Error");sap.m.MessageBox.error("Numero de documento no llenado");return}var I=new s({title:"Confirmação",type:"Message",content:new r({text:"Después de la confirmación, no será posible cambiar el archivo adjunto hasta que se complete el proceso. ¿Quieres continuar?"}),beginButton:new a({text:"Sí",press:function(){t.update(g,u,{success:function(t,i){sap.m.MessageBox.success("Su inclusión / cambio ha comenzado y se seguirá procesando. Espere comentarios o siga la aplicación.",{actions:["OK"],onClose:function(t){e.getView().getModel().refresh(true);e.getRouter().navTo("worklist")}})},error:function(e){var t=e;t=t.responseText;var i=JSON.parse(t);var a=i.error.message.value;sap.m.MessageBox.error(a);return}});I.close()}}),endButton:new a({text:"No",press:function(){I.close()}}),afterClose:function(){I.destroy()}});I.open()},onBackMaster:function(){this.getRouter().navTo("master")},onDeleteSelectedItems:function(e){this.getView().byId("IdParentesco").setEditable(true);var t="0021";var i=this.getView().byId("IdParentesco").getSelectedKey();var d=this.getView().getModel();var o="0000";var l=this.getView().byId("IdFavor").getValue();var n="00";var g="0";var u="E";var I=e.getParameters("listItem");var V=I.documentId;V=parseInt(V);var c=this.getView().byId("idTipo").getValue();var b=this.getView().byId("idCpf").getValue();if(c==="Em ResoluÃ§Ã£o"){sap.m.MessageBox.error("Não será possivel exclusão do anexo, quando o chamado ja existir.");return}var h="/ZET_GLRH_UPLOADSet(Ano='"+o+"',Favor='"+l+"',Infty='"+t+"',Mes='"+n+"',Pernr='"+g+"',Tipo='"+u+"',Subty='"+i+"',DocId="+V+",Objps='',Icnum='"+b+"')";var y={};y.DocId=1;var p=this.getView().byId("UploadCollection");var w=new s({title:"Confirmação",type:"Message",content:new r({text:"Confirma a exclusão anexo?"}),beginButton:new a({text:"Sim",press:function(){d.update(h,y,{success:function(e,t){sap.m.MessageBox.success("Documentos excluido com sucesso.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){p.getBinding("items").refresh(true)}})},error:function(e){var t=e;t=t.responseText;var i=JSON.parse(t);var a=i.error.message.value;sap.m.MessageBox.error(a,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){}});return}});w.close()}}),endButton:new a({text:"Não",press:function(){w.close()}}),afterClose:function(){w.destroy()}});w.open()},FormatIrflg:function(e){if(e==="X"||e==="S"){return"S"}else{return"N"}},FormatPlano:function(e){if(e==="11"||e==="12"){return false}else{return true}},handleValueHelp:function(e){var t=e.getSource().getValue();this.inputId=e.getSource().getId();if(!this._valueHelpDialog1){this._valueHelpDialog1=sap.ui.xmlfragment("Y5GL_CSC4.Y5GL_CSC4.view.LocNascimento",this);this.getView().addDependent(this._valueHelpDialog1)}this._valueHelpDialog1.open(t);if(t){this._valueHelpDialog1.getBinding("items").filter([new Filter("IMunicipio",sap.ui.model.FilterOperator.EQ,t)])}this._valueHelpDialog1.getBinding("items").filter([new Filter("IUf",sap.ui.model.FilterOperator.EQ,"SP")])},onSearchMunicipio:function(e){var t=e.getParameter("value");if(t){var i=t;var a=new sap.ui.model.Filter("IMunicipio",sap.ui.model.FilterOperator.EQ,i);var s=new sap.ui.model.Filter("IUf",sap.ui.model.FilterOperator.EQ,"SP");e.getSource().getBinding("items").filter([a,s])}}})});