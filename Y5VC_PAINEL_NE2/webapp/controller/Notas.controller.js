sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/Text","sap/ui/model/Sorter","sap/m/MessageBox","sap/m/Dialog","../model/formatter"],function(e,t,a,r,n,i,s,o){"use strict";var g;var l;var d;var u;var h;var p;return e.extend("Y5VC_PAINEL_NE2.Y5VC_PAINEL_NE2.controller.Notas",{formatter:o,onInit:function(){var e,a=new t({busy:true,delay:0});this.getRouter().getRoute("Notas").attachPatternMatched(this._onObjectMatched,this);e=this.getView().getBusyIndicatorDelay();this.setModel(a,"NotasView");this.getOwnerComponent().getModel().metadataLoaded().then(function(){a.setProperty("/delay",e)})},_onObjectMatched:function(e){g=e.getParameter("arguments").Belnr;l=e.getParameter("arguments").Bukrs;d=e.getParameter("arguments").Buzei;u=e.getParameter("arguments").Fikrs;h=e.getParameter("arguments").Gjahr;p=e.getParameter("arguments").Knkli;var t=this.getView().byId("ItNotas");t.rebindTable("e")},NotasBeforeRebindTable:function(e){if(g!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Belnr",operator:"EQ",value1:g}))}if(l!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Bukrs",operator:"EQ",value1:l}))}if(d!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Buzei",operator:"EQ",value1:d}))}if(u!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Fikrs",operator:"EQ",value1:u}))}if(h!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Gjahr",operator:"EQ",value1:h}))}if(p!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Knkli",operator:"EQ",value1:p}))}},AnexosVisu:function(e){var t=e.getSource().getText();if(t==="00000"){sap.m.MessageBox.error("NÃ£o existe anexo para essa nota!");return}var a=e.getSource().getBindingContext().getObject().NotaId;var r=e.getSource().getBindingContext().getObject().GjahrNota;var n=e.getSource().getBindingContext().getObject().Fikrs;this.getRouter().navTo("Anexos",{Fikrs:n,NotaId:a,GjahrNota:r})},VisualizarNotas:function(e){var t=this.getView().byId("table4").getSelectedIndices();var r=this.getView().byId("table4");if(t.length<1){sap.m.MessageBox.error("Nenhum item selecionado");return}var n;var i;var o;for(var g=0;g<t.length;g++){if(g===0){n=r.getContextByIndex([t[g]]).getObject().Fikrs;i=r.getContextByIndex([t[g]]).getObject().NotaId;o=r.getContextByIndex([t[g]]).getObject().GjahrNota}else{n=n+";"+r.getContextByIndex([t[g]]).getObject().Fikrs;i=i+";"+r.getContextByIndex([t[g]]).getObject().NotaId;o=o+";"+r.getContextByIndex([t[g]]).getObject().GjahrNota}}var l=new sap.ui.model.json.JSONModel;var d="/sap/opu/odata/sap/ZGWVCFI_PAINEL_NEGOCIACAO_SRV/ZET_VCFI_BUSCA_NOTASet(Fikrs='"+n+"',NotaId='"+i+"',GjahrNota='"+o+"')";l.loadData(d,null,false,"GET",false,false,null);var u=l.getData();var h=this;var p=this.getView().getModel();var m=l.oData.d.Texto;var c=m.replace(/&&/g,"\n");var b="";b=new s({title:"",type:"Message",content:[new sap.m.Label({text:"Notas",labelFor:"submitDialogTextarea"}),new sap.m.TextArea("submitDialogTextarea",{id:"IdTextArea",value:c,editable:true,growing:true})],beginButton:new a({type:sap.m.ButtonType.Emphasized,text:"Ok",press:function(){b.close()}.bind(this)}),endButton:new a({text:"Cancelar",press:function(){b.close()}}),afterClose:function(){b.destroy()}});b.open()},_bindView:function(e){var t=this.getModel("NotasView"),a=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){a.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=this.getModel("NotasView"),a=e.getElementBinding();if(!a.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var r=this.getResourceBundle(),n=e.getBindingContext().getObject(),i=n.Belnr,s=n.Cliente;t.setProperty("/busy",false);this.addHistoryEntry({title:this.getResourceBundle().getText("objectTitle")+" - "+s,icon:"sap-icon://enter-more",intent:"#Y5VC_PAINEL_NE2-display&/ZET_VCFI_NOTASSet/"+i});t.setProperty("/saveAsTileTitle",r.getText("saveAsTileTitle",[s]));t.setProperty("/shareOnJamTitle",s);t.setProperty("/shareSendEmailSubject",r.getText("shareSendEmailObjectSubject",[i]));t.setProperty("/shareSendEmailMessage",r.getText("shareSendEmailObjectMessage",[s,i,location.href]))}})});