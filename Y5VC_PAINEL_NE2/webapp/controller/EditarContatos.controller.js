sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Button","sap/m/Text","sap/m/MessageBox","sap/m/Dialog","../model/formatter"],function(e,t,r,n,a,o,s,i,d){"use strict";var g,l,u,c,m,p;return e.extend("Y5VC_PAINEL_NE2.Y5VC_PAINEL_NE2.controller.EditarContatos",{formatter:d,onInit:function(){this.getRouter().getRoute("EditarContatos").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){g=e.getParameter("arguments").Kunnr;l=e.getParameter("arguments").stcd1;u=e.getParameter("arguments").stcd2;c=e.getParameter("arguments").Kkber;m=e.getParameter("arguments").Fikrs;p=e.getParameter("arguments").NivelDet;var t=this.getView().byId("tableCont");t.bindAggregation("rows",{path:"/ZET_VCFI_CONTATO_CLISet",filters:[new r("Kunnr",n.EQ,g),new r("Kkber",n.EQ,c),new r("NivelDet",n.EQ,p)]})},Inserir:function(e){var t=this;var r=this.getView().getModel();r.setUseBatch(true);var n={};var d;var l=this.getView().byId("smartTableCont");if(!t.getView().byId("idSel2").getSelectedKey()){s.show("Selecione o tipo de contato")}if(!t.getView().byId("idContat2").getValue()){s.show("Informe o dado de contato")}if(!t.getView().byId("idPrior2").getValue()){s.show("Informe a prioridade do contato")}var u="Inserir registro?";var f=new i({title:"Confirmação",type:"Message",content:new o({text:u}),beginButton:new a({text:"Sim",press:function(){n={};n.Kunnr=g;n.ContTyp=t.getView().byId("idSel2").getSelectedKey();n.Contat=t.getView().byId("idContat2").getValue();n.Prior=t.getView().byId("idPrior2").getValue();n.Tag=t.getView().byId("IdTag2").getValue();n.Kkber=c;n.Fikrs=m;n.NivelDet=p;r.update("/"+"ZET_VCFI_CONTATO_CLISet(Kunnr='"+g+"',PosnrCt='999')",n,{success:function(e,r){if(!d){d="Regitro inserido com sucesso";s.show(d);l.rebindTable("e");t.getView().byId("idContat2").setValue("");t.getView().byId("idPrior2").setValue("");t.getView().byId("IdTag2").setValue("")}},error:function(e){if(!d){for(var t=0;t<JSON.parse(e.responseText).error.innererror.errordetails.length;t++){var r="- "+JSON.parse(e.responseText).error.innererror.errordetails[t].message+"\n";d=d+r}sap.m.MessageBox.error(d)}}});f.close()}}),endButton:new a({text:"Cancelar",press:function(){f.close()}}),afterClose:function(){f.destroy()}});f.open()},Remover:function(e){var t=this.getView().getModel();t.setUseBatch(true);var r=this.getView().byId("tableCont");var n=r.getSelectedIndices();var s=this.getView().byId("smartTableCont");var d=this;if(n.length===0){sap.m.MessageBox.error("Nenhum registro selecionado.");return}else{var g="Deseja deletar o item selecionado?";var l=new i({title:"Confirmação",type:"Message",content:new o({text:g}),beginButton:new a({text:"Sim",press:function(){for(var e=0;e<n.length;e++){var r="/"+s._getRowBinding().aKeys[n[e]];t.remove(r,{method:"DELETE",success:function(e){s.rebindTable("e");sap.m.MessageBox.success("Item deletado com sucesso!")},error:function(e){sap.m.MessageBox.error("Não foi possível deletar o item")}})}l.close()}}),endButton:new a({text:"Cancelar",press:function(){l.close()}}),afterClose:function(){l.destroy()}});l.open()}},OnSave:function(e){var t=this.getView().byId("tableCont");var r=this.getView().byId("tableCont").getBinding("rows").getLength();var n=this.getView().getModel();n.setUseBatch(true);var d={};var l;var u=this.getView().byId("smartTableCont");var m="Os dados de contatos serão atualizados, deseja continuar?";var f=new i({title:"Confirmação",type:"Message",content:new o({text:m}),beginButton:new a({text:"Sim",press:function(){for(var e=0;e<r;e++){d={};d.Kunnr=g;d.PosnrCt=t.getContextByIndex(e).getObject().PosnrCt;d.ContTyp=t.getContextByIndex(e).getObject().ContTyp;d.Contat=t.getContextByIndex(e).getObject().Contat;d.Prior=t.getContextByIndex(e).getObject().Prior;d.Tag=t.getContextByIndex(e).getObject().Tag;d.Fikrs=t.getContextByIndex(e).getObject().Fikrs;d.Kkber=c;d.NivelDet=p;n.update("/"+u._getRowBinding().aKeys[0],d,{success:function(e,t){if(!l){l="Dados atualizados com sucesso";u.rebindTable("e");s.show(l)}},error:function(t){if(!l){for(e=0;e<JSON.parse(t.responseText).error.innererror.errordetails.length;e++){var r="- "+JSON.parse(t.responseText).error.innererror.errordetails[e].message+"\n";l=l+r}sap.m.MessageBox.error(l)}}})}f.close()}}),endButton:new a({text:"Cancelar",press:function(){f.close()}}),afterClose:function(){f.destroy()}});f.open()},BeforeTable:function(e){if(g!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Kunnr",operator:"EQ",value1:g}))}if(p!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"NivelDet",operator:"EQ",value1:p}))}if(l!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Stcd1",operator:"EQ",value1:l}))}if(u!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Stcd2",operator:"EQ",value1:u}))}if(c!==""){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Kkber",operator:"EQ",value1:c}))}},_bindView:function(e){var t=this.getModel("EditarContatosView"),r=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){r.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=this.getModel("EditarContatosView"),r=e.getElementBinding();if(!r.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var n=this.getResourceBundle(),a=e.getBindingContext().getObject(),o=a.Belnr,s=a.Cliente;t.setProperty("/busy",false);this.addHistoryEntry({title:this.getResourceBundle().getText("objectTitle")+" - "+s,icon:"sap-icon://enter-more",intent:"#Y5VC_PAINEL_NE2-display&/ZET_VCFI_CONTATO_CLISet/"+o});t.setProperty("/saveAsTileTitle",n.getText("saveAsTileTitle",[s]));t.setProperty("/shareOnJamTitle",s);t.setProperty("/shareSendEmailSubject",n.getText("shareSendEmailObjectSubject",[o]));t.setProperty("/shareSendEmailMessage",n.getText("shareSendEmailObjectMessage",[s,o,location.href]))}})});