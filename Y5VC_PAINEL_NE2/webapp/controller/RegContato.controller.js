sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Button","sap/m/UploadCollectionParameter","sap/ui/Device","sap/m/Text","sap/m/MessageBox","sap/m/Dialog","../model/formatter"],function(e,t,a,s,r,o,i,d,n,l,u){"use strict";var h,g,I,m,f,b,c,p,y,$,v;return e.extend("Y5VC_PAINEL_NE2.Y5VC_PAINEL_NE2.controller.RegContato",{formatter:u,onInit:function(){this.getView().setModel(new t(i),"device");let e=new t([]);this.getView().setModel(e,"statusCobranca");e=new t([]);this.getView().setModel(e,"detalheStatus");this.getRouter().getRoute("RegContato").attachPatternMatched(this._onObjectMatched,this);var a=this.getView().byId("UploadCollection");a.setUploadUrl("/sap/opu/odata/sap/ZGWVCFI_PAINEL_NEGOCIACAO_SRV/ZET_VCFI_REG_CONTSet")},_onObjectMatched:function(e){h=e.getParameter("arguments").Kunnr;g=e.getParameter("arguments").Knkli;I=e.getParameter("arguments").stcd1;m=e.getParameter("arguments").stcd2;f=e.getParameter("arguments").Kkber;b=e.getParameter("arguments").Fikrs;c=e.getParameter("arguments").Belnr;p=e.getParameter("arguments").Bukrs;y=e.getParameter("arguments").Buzei;$=e.getParameter("arguments").Gjahr;v=e.getParameter("arguments").Geral;if(v!=="X"){v=""}if(v==="X"){this.byId("btnOnOff").setState(false);this.byId("btnOnOff").setEnabled(false);this.byId("IdDataProm").setEditable(false);this.byId("IdObs2").setEditable(false);this.byId("IDforme41").setVisible(true)}else{this.byId("btnOnOff").setState(false);this.byId("btnOnOff").setEnabled(true);this.byId("IdDataProm").setEditable(false);this.byId("IdObs2").setEditable(false);this.byId("IDforme41").setVisible(false)}var t=new Date;var a=String(t.getDate()).padStart(2,"0");var s=String(t.getMonth()+1).padStart(2,"0");var r=t.getFullYear();t=r+"-"+s+"-"+a;var o=new Date;o=o.getHours();var i=new Date;i=i.getMinutes();if(o<10){o="0"+o}if(i<10){i="0"+i}o=o+":"+i;var d=sap.ushell.Container.getUser().getId();this.byId("idSel1").setSelectedKey("");this.byId("idSel2").setSelectedKey("");this.byId("idSel3").setSelectedKey("");this.byId("IdData").setValue(t);this.byId("IdHora").setValue(o);this.byId("IdUser").setValue(d);this.byId("IdPessoa").setValue("");this.byId("Idtel").setValue("");this.byId("Idemail").setValue("");this.byId("idText").setValue("");this.byId("IdDataProm").setValue("");this.byId("IdObs2").setValue("");this.getStatusCobranca(b);this.getDetalheStatus(b)},getStatusCobranca:function(e){const t=new a({path:"Fikrs",operator:s.EQ,value1:e});const r=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZGWVCFI_PAINEL_NEGOCIACAO_SRV/");r.read("/ZET_VCFI_RESULTSet",{filters:[t],success:function(e){this.getModel("statusCobranca").setProperty("/",e.results)}.bind(this)})},getDetalheStatus:function(e){const t=new a({path:"Fikrs",operator:s.EQ,value1:e});const r=new sap.ui.model.odata.v2.ODataModel("/sap/opu/odata/sap/ZGWVCFI_PAINEL_NEGOCIACAO_SRV/");r.read("/ZET_VCFI_RESULT_DETSet",{filters:[t],success:function(e){this.getModel("detalheStatus").setProperty("/",e.results)}.bind(this)})},onStartUpload:function(e){var t=this.getView().getModel();var a={};var s=this.byId("UploadCollection");var i=this.byId("idSel1").getSelectedKey();var n=this.byId("idSel2").getSelectedKey();var u=this.byId("idSel3").getSelectedKey();var I=this.byId("IdData").getValue();var m=this.byId("IdHora").getValue();var f=this.byId("IdUser").getValue();var S=this.byId("IdPessoa").getValue();var M=this.byId("Idtel").getValue();var V=this.byId("Idemail").getValue();var P=this.byId("idText").getValue();var O=P.replace(/\n/,";");var O=O.replace(/\n\n/,";;");var C=this;if(this.byId("btnOnOff").getState()===true){var w=this.byId("IdObs2").getValue();var E=this.byId("IdDataProm").getValue()}if(!i){sap.m.MessageToast.show("Forma de contato não foi preenchido");return}if(!n){sap.m.MessageToast.show("Status de cobrança não foi preenchido");return}if(!I){sap.m.MessageToast.show("Data não foi preenchido");return}if(!m){sap.m.MessageToast.show("Hora não foi preenchido");return}if(!f){sap.m.MessageToast.show("'Executado por:' não foi preenchido");return}if(!P){sap.m.MessageToast.show("o campo Nota não foi preenchido");return}if(this.byId("btnOnOff").getState()===true){if(!this.byId("IdDataProm").getValue()){sap.m.MessageToast.show("Data para promessa de pagamento obrigatória");return}}var D=String(Math.floor(Math.random()*10))+String(Math.floor(Math.random()*10))+String(Math.floor(Math.random()*10))+String(Math.floor(Math.random()*10))+String(Math.floor(Math.random()*10));var T=s.getItems();if(T.length>0){var _=D+"$"+b+"$"+c+"$"+p+"$"+y+"$"+$+"$"+i+"$"+n+"$"+u+"$"+I+"$"+m+"$"+f+"$"+S+"$"+M+"$"+v+"$"+V+"$"+O+"$"+s.getItems()[0].getFileName()+"$"+w+"$"+E;var F=encodeURI(_);var N=new o({name:"slug",value:F});s.addHeaderParameter(N);var U=setTimeout(s.upload(),2e3)}else{_=D+"$"+b+"$"+c+"$"+p+"$"+y+"$"+$+"$"+i+"$"+n+"$"+u+"$"+I+"$"+m+"$"+f+"$"+S+"$"+M+"$"+v+"$"+V+"$"+O+"$"+"X"+"$"+w+"$"+E;a={};a.Knkli=g;a.Kunnr=h;a.Fikrs=b;a.Belnr=c;a.Bukrs=p;a.Buzei=y;a.Gjahr=$;a.FormCont=i;a.Resultado=n;a.ResultDet=u;a.Data=I;a.Hora=m;a.User=f;a.PessoaCont=S;a.NumTel=M;a.Email=V;a.Nota=O;a.RegGeral=v;a.Comentario=w;a.DataProm=E;var k="/ZET_VCFI_REG_CONTSet(Fikrs='"+a.Fikrs+"',Knkli='"+a.Knkli+"')";t.update(k,a,{success:function(e,t){},error:function(e){}})}var R="Registro efetuado com sucesso";var K=new l({title:"Sucesso",type:"Message",content:new d({text:R}),beginButton:new r({text:"Ok",press:function(){C.getRouter().navTo("worklist");K.close()}}),afterClose:function(){K.destroy()}});K.open()},onBeforeUploadStarts:function(e){var t=this.byId("UploadCollection");var a=this.byId("idSel1").getSelectedKey();var s=this.byId("idSel2").getSelectedKey();var r=this.byId("idSel3").getSelectedKey();var i=this.byId("IdData").getValue();var d=this.byId("IdHora").getValue();var n=this.byId("IdUser").getValue();var l=this.byId("IdPessoa").getValue();var u=this.byId("Idtel").getValue();var I=this.byId("Idemail").getValue();var m=this.byId("idText").getValue();var f=m.replace(/\n/,";");if(this.byId("btnOnOff").getState()===true){var S=this.byId("IdObs2").getValue();var M=this.byId("IdDataProm").getValue()}if(!a){sap.m.MessageToast.show("Forma de contato não foi preenchido");return}if(!s){sap.m.MessageToast.show("Status de cobrança não foi preenchido");return}if(!i){sap.m.MessageToast.show("Data não foi preenchido");return}if(!d){sap.m.MessageToast.show("Hora não foi preenchido");return}if(!n){sap.m.MessageToast.show("'Executado por:' não foi preenchido");return}if(!f){sap.m.MessageToast.show("o campo Nota não foi preenchido");return}if(this.byId("btnOnOff").getState()===true){if(!this.byId("IdDataProm")){sap.m.MessageToast.show("Data para promessa de pagamento obrigatória");return}}var V=String(Math.floor(Math.random()*10))+String(Math.floor(Math.random()*10))+String(Math.floor(Math.random()*10))+String(Math.floor(Math.random()*10))+String(Math.floor(Math.random()*10));var P=t.getItems();if(P.length>0){var O=V+"$"+g+"$"+b+"$"+c+"$"+p+"$"+y+"$"+$+"$"+a+"$"+s+"$"+r+"$"+i+"$"+d+"$"+n+"$"+l+"$"+u+"$"+v+"$"+I+"$"+f+"$"+e.getParameter("fileName")+"$"+S+"$"+M+"$"+h}else{O=V+"$"+h+"$"+b+"$"+c+"$"+p+"$"+y+"$"+$+"$"+a+"$"+s+"$"+r+"$"+i+"$"+d+"$"+n+"$"+l+"$"+u+"$"+v+"$"+I+"$"+f+"$"+"X"+"$"+S+"$"+M+"$"+h}var C=encodeURI(O);var w=new o({name:"slug",value:C});e.getParameters().addHeaderParameter(w)},onUploadComplete:function(e){var t=e.getParameter("files")[0].fileName;setTimeout(function(){var e=this.byId("UploadCollection");for(var a=0;a<e.getItems().length;a++){if(e.getItems()[a].getFileName()===t){e.removeItem(e.getItems()[a]);break}}}.bind(this),8e3)},OnOff:function(e){if(e.getParameter("state")===false){this.byId("IdDataProm").setEditable(false);this.byId("IdObs2").setEditable(false)}else if(e.getParameter("state")===true){this.byId("IdDataProm").setEditable(true);this.byId("IdObs2").setEditable(true)}},onChange:function(e){var t=e.getSource();var a=this.getView().getModel();a.refreshSecurityToken();var s=a.oHeaders;var r=s["x-csrf-token"];var o=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:r});t.addHeaderParameter(o)},OnResult:function(e){var t=this.byId("idSel2").getSelectedKey();var a=this.byId("idSel3").getBinding("items");var s=new sap.ui.model.Filter("CodResult",sap.ui.model.FilterOperator.EQ,t);a.filter([s]);this.byId("idSel3").setEditable(true)},onSelectChange:function(e){var t=this.byId("UploadCollection");t.setShowSeparators(e.getParameters().selectedItem.getProperty("key"))}})});