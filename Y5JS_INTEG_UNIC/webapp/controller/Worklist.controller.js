sap.ui.define(["./BaseController","../model/formatter","sap/m/Dialog","sap/m/Button","sap/m/Text"],function(t,e,a,i,r){"use strict";return t.extend("votorantim.Y5JS_INTEGRACAO_UNICO.controller.Worklist",{formatter:e,onInit:function(){this.getRouter().getRoute("worklist").attachPatternMatched(this.PrimeiraValidacao,this);var t=window.location.href.toLowerCase();var e=t.indexOf("fiori.votorantim",0);if(e!==-1){this.ApiKey="UbEPL29xKT1p81JrAOyrEMhrVu7abJ4Z";this.LinkCpi="https://votorantim.apimanagement.br10.hana.ondemand.com:443/jsm-cpi-prd/http/js/acessorh/"}else{this.ApiKey="1fm687FHCXBGsFBU7y79NBz0EUVorpTL";this.LinkCpi="https://api-dev.apimanagement.br10.hana.ondemand.com/jsm-cpi-dev/http/js/acessorh/"}},PrimeiraValidacao:function(){var t=this.getLogonUser();if(t===undefined||t==="DEFAULT_USER"){t="fernando.cervantes@votorantim.com"}this.byId("tipoContrato").setSelectedKey("");this.byId("dataAdmissao").setValue("");this.byId("dataLimite").setValue("");this.byId("idNomeCandidato").setValue("");this.byId("idEmailCandidato").setValue("");this.byId("idCPFcandidato").setValue("");this.byId("idCelularCandidato").setValue("");this.ValidaPosicao="";this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_COL_ESTR_ORGSet",{EmailOrg:t});this._bindView("/"+e)}.bind(this))},getLogonUser:function(){var t;var e=new sap.ushell.services.UserInfo;if(e){t=e.getUser().getEmail()}return t},defineIcon:function(){var t=jQuery.sap.getModulePath("votorantim.Y5JS_INTEGRACAO_UNICO");var e=t+"/imagens/JS.jpg";return e},defineLoading:function(){var t=jQuery.sap.getModulePath("votorantim.Y5JS_INTEGRACAO_UNICO");var e=t+"/imagens/voto_load.gif";return e},onchangePosicao:function(t){this.ObjectStatus0=this.byId("ObjectStatus0").getText();this.ObjectAttribute=this.byId("ObjectAttribute").getText();this.ObjectAttribute1=this.byId("ObjectAttribute1").getText();this.ObjectAttribute2=this.byId("ObjectAttribute2").getText();this.ObjectAttribute3=this.byId("ObjectAttribute3").getText();this.EmailOrg=this.byId("EmailOrg").getText();this.Bukrs=this.byId("Empresa").getText();this.Werks=this.byId("AreaRH").getText();this.Btrtl=this.byId("subAreaRH").getText();this.ValidaPosicao="X";var e=t.getParameters().value;if(!e){this.PrimeiraValidacao();sap.m.MessageBox.error("Posição obrigatoria");this.byId("idPosicao").setValueState("Error");this.byId("button").setVisible(false);return}else{this.byId("idPosicao").setValueState("None");this.byId("button").setVisible(true)}this.getModel().metadataLoaded().then(function(){var t=this.getModel().createKey("ZET_BUSCA_POSICAOSet",{Plans:e});this._bindView("/"+t)}.bind(this))},_bindView:function(t){var e=this;if(this.erro!=="X"){e.byId("idimg").setVisible(true)}this.getView().bindElement({path:t,events:{change:this._onBindingChange.bind(this),dataRequested:function(){e.byId("idimg").setVisible(true)},dataReceived:function(){e.byId("idimg").setVisible(false)},error:function(){e.byId("idimg").setVisible(false)}}})},_onBindingChange:function(){var t=this.getView(),e=t.getElementBinding();if(!e.getBoundContext()){}if(this.ValidaPosicao==="X"){this.byId("ObjectStatus0").setText(this.ObjectStatus0);this.byId("ObjectAttribute").setText(this.ObjectAttribute);this.byId("ObjectAttribute1").setText(this.ObjectAttribute1);this.byId("ObjectAttribute2").setText(this.ObjectAttribute2);this.byId("ObjectAttribute3").setText(this.ObjectAttribute3);this.byId("EmailOrg").setText(this.EmailOrg);this.byId("Empresa").setText(this.Bukrs);this.byId("AreaRH").setText(this.Werks);this.byId("subAreaRH").setText(this.Btrtl)}},onChangedtAdmissao:function(t){var e=this.byId("dataAdmissao").getValue();if(e===""){this.byId("dataAdmissao").setValueState("Error");sap.m.MessageBox.error("Data de admissão obrigatório.");this.Erro="X";return}else{this.byId("dataAdmissao").setValueState("Success");this.Erro=""}var a=new Date,i=this.transformaData(e);a=a.toLocaleDateString();a=this.transformaData(a);if(a>i){this.byId("dataAdmissao").setValueState("Error");sap.m.MessageBox.error("Admissão deve possuir uma data futura.");this.Erro="X";return}else{this.byId("dataAdmissao").setValueState("Success");this.Erro="";this.dataAdmissao=i}},onChangedtLimite:function(t){var e=this.byId("dataLimite").getValue();if(e===""){this.byId("dataLimite").setValueState("Error");sap.m.MessageBox.error("Data de limite obrigatório.");this.Erro="X";return}else{this.byId("dataLimite").setValueState("Success");this.Erro=""}var a=new Date,i=this.transformaData(e);a=a.toLocaleDateString();a=this.transformaData(a);if(a>i){this.byId("dataLimite").setValueState("Error");sap.m.MessageBox.error("Data limite deve possuir uma data futura.");this.Erro="X";return}else{this.byId("dataLimite").setValueState("Success");this.Erro=""}if(i>this.dataAdmissao){this.byId("dataLimite").setValueState("Error");this.byId("dataAdmissao").setValueState("Error");sap.m.MessageBox.error("Data limite para o cadastro deve ser inferior a Data de Admissão.");this.Erro="X";return}else{this.byId("dataLimite").setValueState("Success");this.byId("dataAdmissao").setValueState("Success");this.Erro=""}},transformaData:function(t){var e;if(t.indexOf(".")!==-1){e=t.split(".")}else if(t.indexOf("/")!==-1){e=t.split("/")}var a=e[0];var i=e[1];var r=e[2];var s=r+i+a;return s},transformaDataZZ:function(t){var e;if(t.indexOf(".")!==-1){e=t.split(".")}else if(t.indexOf("/")!==-1){e=t.split("/")}var a=e[0];var i=e[1];var r=e[2];var s=r+"-"+i+"-"+a+"T00:00:00Z";return s},onChangeNomeCandidato:function(t){var e=this.byId("idNomeCandidato").getValue();var a;if(e.indexOf(" ")!==-1){a=e.split(" ");if(a[0].length<2){this.byId("idNomeCandidato").setValueState("Error");sap.m.MessageBox.error("Preencher nome completo.");this.Erro="X";return}if(a[1].length<2){this.byId("idNomeCandidato").setValueState("Error");sap.m.MessageBox.error("Preencher nome completo.");this.Erro="X";return}}else{this.byId("idNomeCandidato").setValueState("Error");sap.m.MessageBox.error("Preencher nome completo.");this.Erro="X";return}if(e.length<2){this.byId("idNomeCandidato").setValueState("Error");sap.m.MessageBox.error("Preencher nome completo.");this.Erro="X";return}if(!e){this.byId("idNomeCandidato").setValueState("Error");sap.m.MessageBox.error("Nome do candidato obrigatorio.");this.Erro="X";return}this.byId("idNomeCandidato").setValueState("Success");this.Erro=""},onChangeTelefone:function(t){var e=this.byId("idCelularCandidato").getValue();while(e.indexOf("(")!==-1){e=e.replace("(","")}while(e.indexOf(")")!==-1){e=e.replace(")","")}while(e.indexOf("_")!==-1){e=e.replace("_","")}if(e.length<11){this.byId("idCelularCandidato").setValueState("Error");sap.m.MessageBox.error("Nr. celular invalido - Informe DDD (99)9 + 8 dígitos.");this.Erro="X";return}else if(e[2]!=="9"){this.byId("idCelularCandidato").setValueState("Error");sap.m.MessageBox.error("Nr. celular invalido - Informe DDD (99)9 + 8 dígitos.");this.Erro="X";return}else{this.byId("idCelularCandidato").setValueState("Success");this.Erro=""}},onChangeTipoContrato:function(t){var e=this.byId("tipoContrato").getSelectedKey();if(e!=""){this.byId("tipoContrato").setValueState("Success");this.Erro=""}else{this.byId("tipoContrato").setValueState("Error");sap.m.MessageBox.error("Tipo Contrato invalido.");this.Erro="X";return}},onChangeEmail:function(t){var e=this.byId("idEmailCandidato").getValue();if(e.match(/@/)){this.byId("idEmailCandidato").setValueState("Success");this.Erro=""}else{this.byId("idEmailCandidato").setValueState("Error");sap.m.MessageBox.error("Email invalido.");this.Erro="X";return}},onChangeCPF:function(t){var e=this.byId("idCPFCandidato").getValue();while(e.indexOf(".")!==-1){e=e.replace(".","")}while(e.indexOf("-")!==-1){e=e.replace(".","")}while(e.indexOf("_")!==-1){e=e.replace("_","")}if(e.length<11){this.byId("idCPFCandidato").setValueState("Error");sap.m.MessageBox.error("CPF invalido.");this.Erro="X";return}else{this.byId("idCPFCandidato").setValueState("Success");this.Erro=""}},onEnviar:function(){var t=this.getModel();var e=t.oData;var s=this.byId("idPosicao").getValue();var o="ZET_BUSCA_POSICAOSet('"+s+"')";var n=this;var d="/ZET_GRAVA_POSICAOSet";var l="31/12/9999";var h=this.byId("dataAdmissao").getValue();var u=this.byId("dataLimite").getValue();var c=this.byId("EmailOrg").getText();var m=this.byId("tipoContrato").getSelectedKey();var g=this.byId("idNomeCandidato").getValue();var b=this.byId("idCPFcandidato").getValue();var f=this.byId("idEmailCandidato").getValue();var v=this.byId("idCelularCandidato").getValue();this.onChangeTipoContrato();if(this.Erro==="X"){return}this.onChangedtAdmissao();if(this.Erro==="X"){return}this.onChangedtLimite();if(this.Erro==="X"){return}this.onChangeNomeCandidato();if(this.Erro==="X"){return}this.onChangeEmail();if(this.Erro==="X"){return}this.onChangeTelefone();if(this.Erro==="X"){return}var C={SolBukrs:e[o].Bukrs,SolPersa:e[o].Persa,SolBtrtl:e[o].Btrtl,SolName:e[o].Cname,SolEmail:c,SolUser:"",ReqPlans:s,ReqStell:e[o].Stell,ReqBukrs:e[o].Bukrs,ReqPersa:e[o].Persa,ReqBtrtl:e[o].Btrtl,ReqCttyp:m,ReqCtedt:l,ReqPersg:e[o].Persg,ReqPersk:e[o].Persk,ReqDtadmPrev:h,ReqDtlimPreench:u,ReqCandCpf:b,ReqCandName:g,ReqCandEmail:f,ReqCandPhone:v};var p=new a({title:"Confirmação",type:"Message",content:new r({text:"Confirma o envio da posição?"}),beginButton:new i({text:"Sim",press:function(){t.create(d,C,{success:function(t,e){sap.m.MessageBox.success("Posição enviada para processamento!",{actions:["OK"],onClose:function(e){n.ExecutaEnviaCargos();n.ExecutaContrataCandidato(t.IntId);n.PrimeiraValidacao()}})},error:function(t){var e=t;e=e.responseText;var a=JSON.parse(e);var i=a.error.message.value;sap.m.MessageBox.error(i,{actions:["OK"],onClose:function(t){}});return}});p.close()}}),endButton:new i({text:"Não",press:function(){p.close()}}),afterClose:function(){p.destroy()}});p.open()},ExecutaEnviaCargos:function(){var t=this.getModel();var e=t.oData;var a=this.byId("idPosicao").getValue();var i="ZET_BUSCA_POSICAOSet('"+a+"')";var r=this.LinkCpi+"envioCargos";var s={APIKey:"1fm687FHCXBGsFBU7y79NBz0EUVorpTL"};var o=this.byId("dataAdmissao").getValue();o=this.transformaDataZZ(o);var n=this.byId("dataLimite").getValue();n=this.transformaDataZZ(n);var d={ROOT:{Positions:{Empresa:e[i].Bukrs,Codigo:e[i].Plans,inicioVigencia:o,nomeCargo:e[i].Descc,CBO:e[i].Cbo,centroCusto:e[i].Kostl,centroCustoDesc:e[i].Ltext,valorMaxFaixa:0,valorMinFaixa:0,grupoSalarial:e[i].Persg,posicaoGestor:e[i].Pernr,inicioVigenciaGestor:"",unidadeOrg:e[i].Orgeh,unidadeOrgDesc:e[i].Orgtx,grupoEmpregado:e[i].Persg,grupoEmpregadoDesc:e[i].Descgre}}};var l=this.OBJtoXML(d);var h;var u=new XMLHttpRequest;u.open("POST",r,false);u.setRequestHeader("Content-Type","application/json");u.send(l);u.onreadystatechange=function(){h=u.status;if(h===200){}else{sap.m.MessageBox.error("Erro de comunicação API  - >  envioCargos")}}},ExecutaContrataCandidato:function(t){var e=this.getModel();var a=e.oData;var i=this.byId("idPosicao").getValue();var r="ZET_BUSCA_POSICAOSet('"+i+"')";var s=new Date;var o=this.LinkCpi+"envioPosicoes";var n={APIKey:"1fm687FHCXBGsFBU7y79NBz0EUVorpTL"};var d=this.byId("dataAdmissao").getValue();d=this.transformaDataZZ(d);var l=this.byId("dataLimite").getValue();l=this.transformaDataZZ(l);var h=s.getDate();var u=s.getMonth();var c=s.getFullYear();var m=this.byId("idCelularCandidato").getValue();var g=this.byId("idCPFcandidato").getValue();if(h<10){h="0"+h}u=u+1;if(u<10){u="0"+u}s=c+"-"+u+"-"+h+"T00:00:00Z";while(m.indexOf("(")!==-1){m=m.replace("(","")}while(m.indexOf(")")!==-1){m=m.replace(")","")}while(m.indexOf("_")!==-1){m=m.replace("_","")}while(g.indexOf(".")!==-1){g=g.replace(".","")}while(g.indexOf("-")!==-1){g=g.replace("-","")}var b=a[r].Persa+"-"+a[r].Btrtl;var f={ROOT:{Empregados:{Empresa:a[r].Bukrs,DataRequisicao:s,Departamento:a[r].Orgeh,DepartamentoDesc:a[r].Orgtx,Cargo:a[r].Plans,DataContratacao:d,DataLimite:l,Nome:this.byId("idNomeCandidato").getValue(),CPF:g,Email:this.byId("idEmailCandidato").getValue().trim(),Telefone:m,externalCode:t,arearh:b,DadosUnico:{tipoContrato:this.byId("tipoContrato").getSelectedKey()}}}};var v=this.OBJtoXML(f);var C;var p=new XMLHttpRequest;p.open("POST",o,false);p.send(v);p.onreadystatechange=function(){C=p.status;if(C===200){}else{sap.m.MessageBox.error("Erro de comunicação API  - >  envioPosicoes")}}},ConvertDateTime:function(t){var e;if(t.indexOf(".")!==-1){e=t.split(".")}else if(t.indexOf("/")!==-1){e=t.split("/")}var a=e[0];var i=e[1];var r=e[2];var s=r+"-"+i+"-"+a;var o=new Date(s);return o},OBJtoXML:function(t){var e="";for(var a in t){e+=t[a]instanceof Array?"":"<"+a+">";if(t[a]instanceof Array){for(var i in t[a]){e+="<"+a+">";e+=this.OBJtoXML(new Object(t[a][i]));e+="</"+a+">"}}else if(typeof t[a]==="object"){e+=this.OBJtoXML(new Object(t[a]))}else{e+=t[a]}e+=t[a]instanceof Array?"":"</"+a+">"}var e=e.replace(/<\/?[0-9]{1,}>/g,"");return e}})});