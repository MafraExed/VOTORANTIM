sap.ui.define(["sap/ui/core/mvc/Controller"], function(Controller) {
	"use strict";
	return Controller.extend("com.sap.votorantimZHCM_Demonstrativo.controller.View1", {
		/**
		 *@memberOf com.sap.votorantimZHCM_Demonstrativo.controller.View1
		 */
		onInit: function() {
			var dialog = new sap.m.BusyDialog({
				text: "Carregando..."
			});
			dialog.open();
			var oEntry = [];
			var i = 2000;
			while (i < 2019) {
				oEntry.push({
					name: i,
					value: i
				});
				i++;
			}
			var oModel = new sap.ui.model.json.JSONModel(oEntry);
			this.getView().setModel(oModel, "Zcombo");
			dialog.close();
		},
		pdfviewer: function() {
			//This code was generated by the layout editor.
			var id = this.getView().byId("v_recibo");
			var periodo = this.getView().byId("v_mes");
			var ano = this.getView().byId("v_ano");
			var dialog = new sap.m.BusyDialog({
				text: "Processando"
			});
			dialog.open();
			if (id.getSelectedKey() === "") {
				dialog.close();
				sap.m.MessageToast.show("Selecione um Recibo!");
				return;
			}
			if (periodo.getValue() === "") {
				dialog.close();
				sap.m.MessageToast.show("Selecione um M\xEAs!");
				return;
			}
			if (ano.getValue() === "") {
				dialog.close();
				sap.m.MessageToast.show("Selecione um Ano!");
				return;
			}
			//visual
		//mes
		var mest = this.getView().byId("v_mes").getValue();
		var anot = this.getView().byId("v_ano").getValue();
		localStorage.setItem("mes", JSON.stringify(mest));
		localStorage.setItem("ano", JSON.stringify(anot));
					var that = this;
						var oModel = this.getOwnerComponent().getModel("ferias");
						var sPath = "/ZET_VCRH_PERIODOS";
			oModel.read(sPath, {
				success: function(oData, oResponse) {
					  localStorage.setItem("nome", JSON.stringify(oData.results));
						var spdf = "Formulario.html";
			
				var tamanhow = $(window).width() - 20;
					if (tamanhow > "800") {
						tamanhow = "100%";
							dialog.close();
						var oFrame = that.byId("visualizador");
							var oFrameContent = oFrame.$()[0];
						oFrameContent.setAttribute("width", tamanhow + "px");
						oFrameContent.setAttribute("src", "Formulario2.html");
						oFrameContent.setAttribute("width", tamanhow + "px");
					} else {
						if (spdf !== "") {
							dialog.close();
							window.location.href = spdf;
						
						} else {
							dialog.close();
							sap.m.MessageToast.show("Demonstrativo n\xE3o encontrado!");
						}
					}
				}
			});
					
					
					return;
			//visual
			
		//	var oFrame = this.byId("visualizador");
			var oFrameContent = oFrame.$()[0];
			var oModel = this.getOwnerComponent().getModel("opdf");
			var sFilter = "Tipo eq '" + id.getSelectedKey() + "' and Mes eq '" + periodo.getSelectedKey() + "' and Ano eq '" + ano.getValue() +
				"'";
			var sPath = "/zdemonstrativosSet";
			oModel.read(sPath, {
				urlParameters: {
					"$filter": sFilter
				},
				success: function(oData, oResponse) {
					//alert(oData);
					//var sid = this.getView().byId("box0").getSelectedItem().getText();
					var spdf = oData.results["0"].Arquivo;
					if (spdf !== "") {
						dialog.close();
				//		spdf = "/sap/opu/odata/sap/ZGWVCHR_DEMONSTRATIVOS_SRV/zpdf(Tipo='" + id.getSelectedKey() + "',Mes='" + periodo.getSelectedKey() +
			//				"',Ano='" + ano.getValue() + "')/$value";
			
			spdf = "Formulario.html";
					} else {
						spdf = "";
					}
					var tamanhow = $(window).width() - 20;
					if (tamanhow > "800") {
						tamanhow = "100%";
							dialog.close();
						oFrameContent.setAttribute("width", tamanhow + "px");
						oFrameContent.setAttribute("src", "sap/bc/ui5_ui5/sap/zvcrh_demonstr/Formulario2.html");
						oFrameContent.setAttribute("width", tamanhow + "px");
					} else {
						if (spdf !== "") {
							dialog.close();
							window.location.href = "sap/bc/ui5_ui5/sap/zvcrh_demonstr/Formulario.html";
						} else {
							dialog.close();
							sap.m.MessageToast.show("Demonstrativo n\xE3o encontrado!");
						}
					}
				},
				error: function() {
					dialog.close();
					sap.m.MessageToast.show("Demonstrativo n\xE3o encontrado!");
				}
			});
			
		},
		/**
		 *@memberOf com.sap.votorantimZHCM_Demonstrativo.controller.View1
		 */
		check_recibo: function() {
			//This code was generated by the layout editor.
		},
		/**
		 *@memberOf com.sap.votorantimZHCM_Demonstrativo.controller.View1
		 */
		voltarsucces: function() {
			//This code was generated by the layout editor.
				window.location.href = 'https://pmsalesdemo8.successfactors.com/sf/home?bplte_company=BRAZIL18#Shell-home';
			
		}
	});
});