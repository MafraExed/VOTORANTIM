/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.ScfldMasterController");jQuery.sap.require("hcm.mypaystubs.utils.ConcurrentEmployment");jQuery.sap.require("hcm.mypaystubs.utils.Formatter");jQuery.sap.require("sap.ca.ui.model.format.NumberFormat");jQuery.sap.require("sap.ca.ui.model.type.Date");jQuery.sap.require("hcm.mypaystubs.utils.DataManager");sap.ca.scfld.md.controller.ScfldMasterController.extend("hcm.mypaystubs.view.S2",{extHookChangeFooterButtons:null,onInit:function(){sap.ca.scfld.md.controller.ScfldMasterController.prototype.onInit.call(this);this.oApplication=this.oApplicationFacade.oApplicationImplementation;this.oBundle=this.oApplicationFacade.getResourceBundle();this.oDataModel=this.oApplicationFacade.getODataModel();this._page=this.getView().byId("PAYSLIP_MASTER_PAGE");this.delayDataLoad=false;this._oRouterArgs=null;hcm.mypaystubs.utils.DataManager.init(this.oDataModel,this.oBundle);this.oRouter.getRoute("master").attachMatched(this._onRouteMatched,this);var s=this;var m=new sap.ui.core.routing.HashChanger();var h=m.getHash();var p=h.match(/PersonnelAssignment='(\d{1,8})'/);if(p){this.oApplication.pernr=p[1];}if(h.indexOf("?search=")!==-1){this.delayDataLoad=true;}if(!this.oApplication.pernr){hcm.mypaystubs.utils.ConcurrentEmployment.getCEEnablement(this,function(){s._initialize();});}else if(!this.delayDataLoad){s._initialize();}},onDataLoaded:function(){var i=this.getList().getItems();if(i.length===0){this.showEmptyView("DETAIL_TITLE",sap.ui.getCore().getConfiguration().getLanguage(),this.oBundle.getText("NO_PAYSLIPS_AVAILABLE"));}},_initialize:function(s){var l=this.getList();var p=this.oApplication.pernr;var t=l.getItems()[0].clone();var f=this._getFilters(p,s);l.bindItems("/Paystubs",t,null,f);if(s!==undefined){this._oControlStore.oMasterSearchField.setValue(s);}this.registerMasterListBind();this.refreshHeaderFooterForEditToggle();},_getFilters:function(p,s){var f=[];var F=new sap.ui.model.Filter("PersonnelAssignment",sap.ui.model.FilterOperator.EQ,p);f.push(F);if(s!==undefined){var o=new sap.ui.model.Filter("Reason",sap.ui.model.FilterOperator.Contains,s);var a=new sap.ui.model.Filter("Period",sap.ui.model.FilterOperator.Contains,s);var b=new sap.ui.model.Filter("Currency",sap.ui.model.FilterOperator.Contains,s);var d=sap.ui.core.format.DateFormat.getDateInstance();var c=d.parse(s,true,true);if(c){var e=new sap.ui.model.Filter("PayDate",sap.ui.model.FilterOperator.EQ,c);f.push(e);}f.push(o);f.push(a);f.push(b);}return f;},_onRouteMatched:function(e){this._oRouterArgs=e.getParameter("arguments");this._oRouterArgs.query=this._oRouterArgs["?query"]||null;delete this._oRouterArgs["?query"];if(this.delayDataLoad){this.delayDataLoad=false;this._initialize(decodeURIComponent(this._oRouterArgs.query.search));}},isBackendSearch:function(){return true;},applyBackendSearchPattern:function(f,b){var F=this._getFilters(this.oApplication.pernr,f);b.filter(F,sap.ui.model.FilterType.Application);if(f){this._oRouterArgs.query={search:encodeURIComponent(f)};}else{this._oRouterArgs.query=null;}this._bListLoaded=false;this.oRouter.navTo("master",this._oRouterArgs,true);},getHeaderFooterOptions:function(){var o={sI18NMasterTitle:"DISPLAY_NAME_LIST"};if(this.extHookChangeFooterButtons){o=this.extHookChangeFooterButtons(o);}return o;},setListItem:function(i){var q=this._oRouterArgs.query;this.oRouter.navTo("detail",{from:i.getTitle(),contextPath:i.getBindingContext().sPath.substr(1),query:q},!sap.ui.Device.system.phone);this.refreshHeaderFooterForEditToggle();}});
