/*
 * Copyright (C) 2009-2014 SAP SE or an SAP affiliate company. All rights reserved
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseDetailController");jQuery.sap.require("hcm.mypaystubs.utils.PdfLoader");jQuery.sap.require("hcm.mypaystubs.utils.Formatter");jQuery.sap.require("sap.ca.ui.model.format.NumberFormat");sap.ca.scfld.md.controller.BaseDetailController.extend("hcm.mypaystubs.view.S3",{extHookChangeFooterButtons:null,onInit:function(){sap.ca.scfld.md.controller.BaseDetailController.prototype.onInit.call(this);this.resourceBundle=this.oApplicationFacade.getResourceBundle();this.oRouter.attachRouteMatched(this.handleRouteMatched,this);this.oPfdLoader=new hcm.mypaystubs.utils.PdfLoader();this.jsonModel=new sap.ui.model.json.JSONModel();this.getView().setModel(this.jsonModel,"NewModel");this._zoomableScrollContainer=this.getView().byId("PAYSLIP_PDF_VIEWER_CONTAINER");this._busy=this.getView().byId("PAYSLIP_BUSY_CURSOR_CONTAINER");this._zoomableScrollContainer.addEventDelegate({onAfterRendering:jQuery.proxy(this.afterZoomableScrollContainerRendering,this)},this);this._pdfViewer=this._zoomableScrollContainer.getContent()[0];},afterZoomableScrollContainerRendering:function(){this._zoomableScrollContainer.getDomRef().style.marginLeft="2.5%";this._pdfViewer.UnloadPdf();this._pdfViewer.Show(this.oPfdLoader);},showBusyCursor:function(){setTimeout(jQuery.proxy(function(){if(this._busy!==null){this._busy.setVisible(true);}},this),0);},hideBusyCursor:function(){setTimeout(jQuery.proxy(function(){if(this._busy!==null){this._busy.setVisible(false);}},this),0);},handleRouteMatched:function(e){var v=this.getView();var i=null;if(e.getParameter("name")==="detail"){var c=new sap.ui.model.Context(this.oApplicationFacade.getODataModel(),'/'+e.getParameter("arguments").contextPath);v.setBindingContext(c);var p=this.getPdfUrl(c);i={};i.initialScale=sap.ui.Device.system.phone?1/4:1;i.minScale=sap.ui.Device.system.phone?1/4:1;i.maxScale=sap.ui.Device.system.phone?2:3;i.EndDate=p.EndDate;i.SEQUENCENUMBER=p.SEQUENCENUMBER;i.PDFPayslipUrl=p.PDFPayslipUrl;this.jsonModel.setData(i);this._zoomableScrollContainer.invalidate();this.oApplicationImplementation.defineDetailHeaderFooter(this);}},getPdfUrl:function(b){var p={};if(b.getProperty("")){p.SEQUENCENUMBER=b.getProperty("").SEQUENCENUMBER;p.EndDate=b.getProperty("").EndDate;}p.PDFPayslipUrl=(b.getModel().sServiceUrl+b.sPath).replace("Paystubs","PDFPaystubs")+"/$value";if(jQuery.sap.getUriParameters().get("local")){var a=window.location.href.indexOf("index.html");var c=null;if(a>-1){c=window.location.href.substring(0,a);}else{var o=window.location.protocol+"//"+window.location.hostname+(window.location.port?':'+window.location.port:'');c=o+window.location.pathname;}var e=p.PDFPayslipUrl.indexOf("http://")>-1?p.PDFPayslipUrl.replace("http://","proxy/http/"):p.PDFPayslipUrl.replace("https://","proxy/https/");p.PDFPayslipUrl=c+e;}return p;},onOpenPDFClicked:function(e){jQuery.sap.log.info("open pdf pressed");var a=new Date(Date.parse(this.jsonModel.getProperty("/EndDate")));var m=("0"+(a.getMonth()+1)).slice(-2);var d=("0"+a.getDate()).slice(-2);var y=a.getFullYear();var b=m+'.'+d+'.'+y;var n=window.open(this.jsonModel.getProperty("/PDFPayslipUrl"),"_blank");n.onload=jQuery.proxy(function(){n.document.title=this.resourceBundle.getText('PDF_WINDOW_TITLE',[b]);},this);},getHeaderFooterOptions:function(){var t=this;var o={buttonList:[{sId:"PAYSLIP_DETAIL_BTN_OPEN_PDF",sI18nBtnTxt:"OPEN_AS_PDF",bEnabled:true,onBtnPressed:function(e){t.onOpenPDFClicked(e);}}],oAddBookmarkSettings:{title:t.resourceBundle.getText("DISPLAY_NAME_DETAILS"),icon:"sap-icon://travel-expense-report"}};var m=new sap.ui.core.routing.HashChanger();var u=m.getHash();if(u.indexOf("Shell-runStandaloneApp")>=0){o.bSuppressBookmarkButton=true;}if(this.extHookChangeFooterButtons){o=this.extHookChangeFooterButtons(o);}return o;}});
