sap.ui.define(["Y5GL_EC_BENEF2/Y5GL_EC_BENEF2/controller/BaseController","sap/ui/Device","Y5GL_EC_BENEF2/Y5GL_EC_BENEF2/model/formatter","sap/m/Button","sap/m/Dialog","sap/m/Text","sap/m/Label","sap/m/RadioButton","sap/ui/model/json/JSONModel"],function(e,t,i,a,s,r,d,o,l){"use strict";var n;var g;var I;var u;var b;var V;var c;return e.extend("Y5GL_EC_BENEF2.Y5GL_EC_BENEF2.controller.DepententeDetail",{formatter:i,onInit:function(){this.getRouter().getRoute("DepententeDetail").attachPatternMatched(this._onObjectMatched,this);this.getRouter().getRoute("DependentesAdd").attachPatternMatched(this._onAdd,this)},onchangeParentesco:function(){var e=this.getView().byId("IdParentesco").getSelectedKey();if(e==="11"||e==="12"){this.getView().byId("idformplano").setVisible(false)}else{this.getView().byId("idformplano").setVisible(true)}},onChangeCPF:function(){var e=this.getView().byId("idCpf").getValue();while(e.indexOf(".")!=-1){e=e.replace(".","")}while(e.indexOf("-")!=-1){e=e.replace("-","")}var t,i,a,s,r,d;var o;d=1;if(e.length<11){o=1}if(o!==1){for(s=0;s<e.length-1;s++)if(e.charAt(s)!=e.charAt(s+1)){d=0;break}if(!d){t=e.substring(0,9);i=e.substring(9);a=0;for(s=10;s>1;s--){a+=t.charAt(10-s)*s}r=a%11<2?0:11-a%11;if(r!=i.charAt(0)){o=1}t=e.substring(0,10);a=0;for(s=11;s>1;s--)a+=t.charAt(11-s)*s;r=a%11<2?0:11-a%11;if(r!=i.charAt(1)){o=1}}else{o=1}}else{o=1}if(o===1){sap.m.MessageBox.error("CPF inválido");this.getView().byId("idCpf").setValueState("Error")}else{this.getView().byId("idCpf").setValueState("Success")}},onVoltar:function(){var e=!t.system.phone;var i="BENEFICIOS_DETAIL";var a="PLANO MÉDICO";var s="PLANO_MEDICO";this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getRouter().navTo(i,{Zparam:s,Zdesc:a},e)},formatVisibleEdit:function(e){if(e==="Em ResoluÃ§Ã£o"){return false}else{return true}},FormatFalse:function(e){return false},formatVisibleUpload:function(e){if(e==="Em ResoluÃ§Ã£o"){return true}else{return false}},_onAdd:function(e){this.getView().getModel().refresh(true);var t=e.getParameter("arguments").Pernr;var i=e.getParameter("arguments").Subty;var a="N";var s=e.getParameter("arguments").Objps;var r=e.getParameter("arguments").Favor;var d=e.getParameter("arguments").Icnum;var o;var l=e.getParameter("arguments").Plan;if(l=="CNUN"||l=="BRAD"){this.getView().byId("TextInclusao_CNUN_BRAD").setVisible(true)}else if(l=="UNCU"){this.getView().byId("TextInclusao_UNCU").setVisible(true)}else if(l=="UNJZ"){this.getView().byId("TextInclusao_UNJZ").setVisible(true)}else if(l=="SCMP"){this.getView().byId("TextInclusao_SCMP").setVisible(true)}this.getView().byId("IdParentesco").setEditable(true);this.getView().byId("IdFavor").setEditable(true);this.getView().byId("IdFanam").setEditable(true);this.getView().byId("IdFgbdt").setEditable(true);this.getView().byId("IdSexo").setEditable(true);this.getView().byId("IdZzestciv").setEditable(true);this.getView().byId("IdIR").setEditable(true);this.getView().byId("idCpf").setEditable(true);this.getView().byId("IdSalvarDetailDep").setVisible(true);this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().byId("IdPlano").setEditable(true);this.getView().byId("IdParentesco").setValueState("None");this.getView().byId("IdFavor").setValueState("None");this.getView().byId("IdFanam").setValueState("None");this.getView().byId("IdFgbdt").setValueState("None");this.getView().byId("IdFgbdt").setValueState("None");this.getView().byId("IdSexo").setValueState("None");this.getView().byId("IdZzestciv").setValueState("None");this.getView().byId("IdPlano").setValueState("None");this.getView().byId("IdIR").setValueState("None");this.getView().byId("idCpf").setValueState("None");this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("IdCancelarDetailDep").setVisible(true);this.getView().byId("iddelete").setVisible(false);this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){o=this.getModel().createKey("ZET_GLRH_DEPENDENTESSet",{Pernr:t,Subty:i,Objps:s,Tipo:a,Favor:r,Icnum:d,Chamado:" "});this._bindView("/"+o)}.bind(this))},onEdit:function(){n=this.getView().byId("IdParentesco").getSelectedKey();g=this.getView().byId("IdFavor").getValue();I=this.getView().byId("IdFanam").getValue();u=this.getView().byId("IdFgbdt").getValue();b=this.getView().byId("IdSexo").getValue();V=this.getView().byId("IdZzestciv").getSelectedKey();c=this.getView().byId("IdIR").getSelectedKey();if(c==="S"){c="SIM"}else{c="Não"}this.getView().byId("UploadCollection").setUploadButtonInvisible(false);this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("IdSalvarDetailDep").setVisible(true);this.getView().byId("IdCancelarDetailDep").setVisible(true);this.getView().byId("IdParentesco").setEditable(true);this.getView().byId("idNomedaMae").setEditable(true);this.getView().byId("IdFavor").setEditable(true);this.getView().byId("IdFanam").setEditable(true);this.getView().byId("IdFgbdt").setEditable(true);this.getView().byId("IdSexo").setEditable(true);this.getView().byId("IdZzestciv").setEditable(true);this.getView().byId("IdIR").setEditable(true);this.getView().byId("idCpf").setEditable(true);this.getView().byId("IdPlano").setEditable(false);this.getView().byId("idTextEditar").setVisible(true);this.getView().byId("idTextExcluir").setVisible(false);this.getView().byId("idTextIncluir").setVisible(false)},onCancel:function(){this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().byId("IdEditDetailDep").setVisible(true);this.getView().byId("IdSalvarDetailDep").setVisible(false);this.getView().byId("UploadCollection").setUploadButtonInvisible(true);this.getView().byId("IdParentesco").setEditable(false);this.getView().byId("IdFavor").setEditable(false);this.getView().byId("IdFanam").setEditable(false);this.getView().byId("IdFgbdt").setEditable(false);this.getView().byId("IdSexo").setEditable(false);this.getView().byId("IdZzestciv").setEditable(false);this.getView().byId("IdIR").setEditable(false);this.getView().byId("idCpf").setEditable(false);this.getView().byId("IdPlano").setEditable(false);this.getView().byId("IdParentesco").setSelectedKey(n);this.getView().byId("IdFavor").setValue(g);this.getView().byId("IdFanam").setValue(I);this.getView().byId("IdFgbdt").setValue(u);this.getView().byId("IdSexo").setValue(b);this.getView().byId("IdZzestciv").setSelectedKey(V);this.getView().byId("IdIR").setValue(c);this.getView().byId("idTextEditar").setVisible(false);this.getView().byId("idTextExcluir").setVisible(false);this.getView().byId("idTextIncluir").setVisible(false)},_onObjectMatched:function(e){var t=e.getParameter("arguments").Tipo;var i=e.getParameter("arguments").Pernr;var a=e.getParameter("arguments").Subty;var s="V";var r=e.getParameter("arguments").Objps;var d=e.getParameter("arguments").Favor;var o=e.getParameter("arguments").Icnum;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_GLRH_DEPENDENTESSet",{Icnum:o,Pernr:i,Subty:a,Objps:r,Tipo:s,Favor:d});this._bindView("/"+e)}.bind(this));this.getView().byId("IdParentesco").setEditable(false);this.getView().byId("IdFavor").setEditable(false);this.getView().byId("IdFanam").setEditable(false);this.getView().byId("IdFgbdt").setEditable(false);this.getView().byId("IdSexo").setEditable(false);this.getView().byId("IdZzestciv").setEditable(false);this.getView().byId("IdIR").setEditable(false);this.getView().byId("idCpf").setEditable(false);this.getView().byId("IdPlano").setEditable(false);if(t==="V"){this.getView().byId("IdSalvarDetailDep").setVisible(false);this.getView().byId("IdEditDetailDep").setVisible(true);this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().byId("iddelete").setVisible(false);this.getView().byId("UploadCollection").setUploadButtonInvisible(true)}if(t==="E"){this.getView().byId("IdSalvarDetailDep").setVisible(false);this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().byId("iddelete").setVisible(true);this.getView().byId("UploadCollection").setUploadButtonInvisible(false)}},_bindView:function(e){var t=this;t.loading(false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.loading(true)},dataReceived:function(){t.loading(false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}},onExcluir:function(){var e=this;var t=this.getView().getModel();var i=this.getView().byId("IdPernr").getValue();var d=this.getView().byId("IdParentesco").getSelectedKey();var o=this.getView().byId("IdObjps").getValue();var l=this.getView().byId("IdFavor").getValue();var n=this.getView().byId("idCpf").getValue();var g="/ZET_GLRH_DEPENDENTESSet(Pernr='"+i+"',Subty='"+d+"',Objps='"+o+"',Favor='"+l+"',Tipo='E',Icnum='"+n+"')";var I={};I.Parentesco=this.getView().byId("IdParentesco").getSelectedKey();I.Favor=this.getView().byId("IdFavor").getValue();I.Fanam=this.getView().byId("IdFanam").getValue();I.Fgbdt=this.getView().byId("IdFgbdt").getValue();I.Sexo=this.getView().byId("IdSexo").getSelectedKey();I.Zzestciv=this.getView().byId("IdZzestciv").getSelectedKey();I.Irflg=this.getView().byId("IdIR").getSelectedKey();I.Operation="Exclusão";if(I.Irflg==="S"){I.Irflg="X"}else{I.Irflg=""}I.Icnum=this.getView().byId("idCpf").getValue();I.Zplanosaude=this.getView().byId("IdPlano").getSelectedKey();if(I.Zplanosaude==="S"){I.Zplanosaude="X"}else{I.Zplanosaude=" "}var u=new s({title:"Confirmação",type:"Message",content:new r({text:"Após a confirmação não será possivel alterar o anexo até que o processo seja finalizado, deseja seguir?"}),beginButton:new a({text:"Sim",press:function(){t.update(g,I,{success:function(t,i){sap.m.MessageBox.success("Sua exclusão foi iniciada e seguirá para processamento, aguarde retorno ou acompanhae pelo app.",{actions:["OK"],onClose:function(t){e.getView().getModel().refresh(true);e.getRouter().navTo("DEPENDENTES")}})},error:function(e){var t=e;t=t.responseText;var i=JSON.parse(t);var a=i.error.message.value;sap.m.MessageBox.error(a);return}});u.close()}}),endButton:new a({text:"Não",press:function(){u.close()}}),afterClose:function(){u.destroy()}});u.open()},onChange:function(e){var t=e.getSource();var i=this.getView().getModel();i.refreshSecurityToken();var a=i.oHeaders;var s=a["x-csrf-token"];var r=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:s});t.addHeaderParameter(r)},onBeforeUploadStarts:function(e){var t="0";var i="0021";var a=this.getView().byId("IdParentesco").getSelectedKey();var s=this.getView().byId("IdObjps").getValue();if(s===""){s="0"}var r=this.getView().byId("IdParentesco").getSelectedKey();var d=this.getView().byId("IdFavor").getValue();var o=this.getView().byId("idCpf").getValue();if(r===""){sap.m.MessageBox.error("Selecione o Grau de Parentesco.");return}if(t!==""&&a!==""&&s!==""){var l=t+"$"+i+"$"+a+"$"+s+"$"+e.getParameter("fileName")+"$"+d+"$"+o;var n=new sap.m.UploadCollectionParameter({name:"slug",value:encodeURIComponent(l)});e.getParameters().addHeaderParameter(n)}else{sap.m.MessageBox.error("Não foi possivel fazer upload do arquivo.")}},onuploadComplete:function(e){var t="0";var i="0021";var a=this.getView().byId("IdParentesco").getSelectedKey();var s="C";var r=this.getView().byId("IdFavor").getValue();var d=this.getView().byId("idCpf").getValue();if(t!==""&&a!==""){this.getView().byId("IdParentesco").setEditable(false);var o=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,t);var l=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,i);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var g=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,s);var I=new sap.ui.model.Filter("Favor",sap.ui.model.FilterOperator.EQ,r);var u=new sap.ui.model.Filter("Icnum",sap.ui.model.FilterOperator.EQ,d);var b=this.getView().byId("UploadCollection");b.getBinding("items").filter([o,l,n,g,I,u])}},onmodelListContextChange:function(e){var t="0";var i="0021";var a=this.getView().byId("IdParentesco").getSelectedKey();var s="C";var r=this.getView().byId("IdFavor").getValue();var d=this.getView().byId("idCpf").getValue();if(t!==""||a!==""){var o=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,t);var l=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,i);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var g=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,s);var I=new sap.ui.model.Filter("Favor",sap.ui.model.FilterOperator.EQ,r);var u=new sap.ui.model.Filter("Icnum",sap.ui.model.FilterOperator.EQ,d);var b=this.getView().byId("UploadCollection");b.getBinding("items").filter([o,l,n,g,I,u])}},onSave:function(){var e=this;var i=this.getView().getModel();var d=this.getView().byId("IdPernr").getValue();var o=this.getView().byId("IdParentesco").getSelectedKey();var l=this.getView().byId("IdObjps").getValue();var n=this.getView().byId("IdFavor").getValue();var g=this.getView().byId("idCpf").getValue();var I="/ZET_GLRH_DEPENDENTESSet(Pernr='"+d+"',Subty='"+o+"',Objps='"+l+"',Favor='"+n+"',Tipo='G',Icnum='"+g+"',Chamado='')";var u={};u.Parentesco=this.getView().byId("IdParentesco").getSelectedKey();if(u.Parentesco===""){this.getView().byId("IdParentesco").setValueState("Error");sap.m.MessageBox.error("Selecione o Grau de Parentesco.");return}else{this.getView().byId("IdParentesco").setValueState("Success")}u.Favor=this.getView().byId("IdFavor").getValue();if(u.Favor===""){this.getView().byId("IdFavor").setValueState("Error");sap.m.MessageBox.error("Preencher o Nome.");return}else{this.getView().byId("IdFavor").setValueState("Success")}u.Fanam=this.getView().byId("IdFanam").getValue();if(u.Fanam===""){this.getView().byId("IdFanam").setValueState("Error");sap.m.MessageBox.error("Preencher o sobrenome.");return}else{this.getView().byId("IdFanam").setValueState("Success")}u.Fgbdt=this.getView().byId("IdFgbdt").getValue();if(u.Fgbdt===""){this.getView().byId("IdFgbdt").setValueState("Error");sap.m.MessageBox.error("Selecione data de nascimento.");return}else{this.getView().byId("IdFgbdt").setValueState("Success")}u.Mothe=this.getView().byId("idNomedaMae").getValue();if(u.Mothe===""){this.getView().byId("idNomedaMae").setValueState("Error");sap.m.MessageBox.error("Informe o nome da mãe.");return}else{this.getView().byId("idNomedaMae").setValueState("Success")}u.Sexo=this.getView().byId("IdSexo").getSelectedKey();if(u.Sexo===" "){this.getView().byId("IdSexo").setValueState("Error");sap.m.MessageBox.error("Selecione o sexo.");return}else{this.getView().byId("IdSexo").setValueState("Success")}u.Zzestciv=this.getView().byId("IdZzestciv").getSelectedKey();if(u.Zzestciv===" "){this.getView().byId("IdZzestciv").setValueState("Error");sap.m.MessageBox.error("Selecione o Estado Civil.");return}else{this.getView().byId("IdZzestciv").setValueState("Success")}u.Irflg=this.getView().byId("IdIR").getSelectedKey();if(u.Irflg===" "){this.getView().byId("IdIR").setValueState("Error");sap.m.MessageBox.error("Selecione se é dependente de IR.");return}else{if(u.Irflg==="S"){u.Irflg="X"}else{u.Irflg=""}this.getView().byId("IdIR").setValueState("Success")}u.Icnum=this.getView().byId("idCpf").getValue();if(u.Icnum===""){this.getView().byId("idCpf").setValueState("Error");sap.m.MessageBox.error("Informe o CPF.");return}else{this.getView().byId("idCpf").setValueState("Success")}u.Zplanosaude=this.getView().byId("IdPlano").getSelectedKey();if(u.Zplanosaude===""){this.getView().byId("IdPlano").setValueState("Error");sap.m.MessageBox.error("Informe se o dependente será incluido no plano de saúde.");return}else{if(u.Zplanosaude==="S"){u.Zplanosaude="X"}else{u.Zplanosaude=" "}this.getView().byId("IdPlano").setValueState("Success")}var b=new s({title:"Confirmação",type:"Message",content:new r({text:"Após a confirmação não será possivel alterar o anexo até que o processo seja finalizado. Deseja seguir?"}),beginButton:new a({text:"Sim",press:function(){i.update(I,u,{success:function(i,a){sap.m.MessageBox.success("Sua inclusão/alteração foi iniciada e seguirá para processamento. Aguarde retorno ou acompanhe pelo app.",{actions:["OK"],onClose:function(i){e.getView().getModel().refresh(true);var a=!t.system.phone;var s="BENEFICIOS_DETAIL";var r="PLANO MÉDICO";var d="PLANO_MEDICO";e.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");e.getRouter().navTo(s,{Zparam:d,Zdesc:r},a)}})},error:function(e){var t=e;t=t.responseText;var i=JSON.parse(t);var a=i.error.message.value;sap.m.MessageBox.error(a);return}});b.close()}}),endButton:new a({text:"Não",press:function(){b.close()}}),afterClose:function(){b.destroy()}});b.open()},onBackMaster:function(){this.getRouter().navTo("master")},onDeleteSelectedItems:function(e){this.getView().byId("IdParentesco").setEditable(true);var t="0021";var i=this.getView().byId("IdParentesco").getSelectedKey();var d=this.getView().getModel();var o="0000";var l=this.getView().byId("IdFavor").getValue();var n="00";var g="0";var I="E";var u=e.getParameters("listItem");var b=u.documentId;b=parseInt(b);var V=this.getView().byId("idTipo").getValue();var c=this.getView().byId("idCpf").getValue();if(V==="Em ResoluÃ§Ã£o"){sap.m.MessageBox.error("Não será possivel exclusão do anexo, quando o chamado ja existir.");return}var h="/ZET_GLRH_UPLOADSet(Ano='"+o+"',Favor='"+l+"',Infty='"+t+"',Mes='"+n+"',Pernr='"+g+"',Tipo='"+I+"',Subty='"+i+"',DocId="+b+",Objps='',Icnum='"+c+"')";var y={};y.DocId=b;var p=this.getView().byId("UploadCollection");var w=new s({title:"Confirmação",type:"Message",content:new r({text:"Confirma a exclusão anexo?"}),beginButton:new a({text:"Sim",press:function(){d.update(h,y,{success:function(e,t){sap.m.MessageBox.success("Documentos excluido com sucesso.",{actions:["OK"],onClose:function(e){p.getBinding("items").refresh(true)}})},error:function(e){var t=e;t=t.responseText;var i=JSON.parse(t);var a=i.error.message.value;sap.m.MessageBox.error(a,{actions:["OK"],onClose:function(e){}});return}});w.close()}}),endButton:new a({text:"Não",press:function(){w.close()}}),afterClose:function(){w.destroy()}});w.open()},FormatIrflg:function(e){if(e==="X"){return"S"}else{return"N"}},FormatPlano:function(e){if(e==="11"||e==="12"){return false}else{return true}}})});