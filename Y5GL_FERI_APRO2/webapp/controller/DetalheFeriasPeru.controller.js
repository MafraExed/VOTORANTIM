sap.ui.define(["Y5GL_FERI_APRO2/Y5GL_FERI_APRO2/controller/BaseController","sap/ui/model/json/JSONModel","Y5GL_FERI_APRO2/Y5GL_FERI_APRO2/model/formatter","sap/ui/Device","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/ui/core/Fragment","sap/m/Label","sap/m/Button","sap/m/Dialog","sap/m/Text","sap/m/TextArea","sap/m/CheckBox","sap/m/Input"],function(e,t,a,r,i,s,n,o,d,l,g,u,c,f,p){"use strict";var v,h,m,b,w,V,I,y,P,x,M,E,R,B,C,A,_,S;var O;var F;var T;var L;var G;var D;var Y;var K;return e.extend("Y5GL_FERI_APRO2.Y5GL_FERI_APRO2.controller.DetalheFeriasPeru",{formatter:a,onInit:function(){var e=new t({busy:false,delay:0});this.getRouter().getRoute("DetalheFeriasPeru").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"detailView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this));var a=jQuery.sap.getModulePath("Y5GL_FERI_APRO2.Y5GL_FERI_APRO2");var r=a+"/imagens/loading.gif";this.getView().byId("idimg").setSrc(r)},formatterIcon:function(e){var t=jQuery.sap.getModulePath("Y5GL_FERI_APRO2.Y5GL_FERI_APRO2");var a=t+"/Icones/";var r;r=a+"FERIAS_DET.png";return r},_onObjectMatched:function(e){this.getView().byId("idPage").scrollTo(0,0);this.getView().getModel().refresh(true);E=e.getParameter("arguments").Pernr;R=e.getParameter("arguments").Index;B=e.getParameter("arguments").Endda;C=e.getParameter("arguments").Begda;O=C;F=B;if(E!==""&&a!==""&&x!==""&&I!==""){this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_GLHR_FERI_PERU_DETALHESet",{Endda:B,Begda:C,Pernr:E});this._bindView("/"+e)}.bind(this))}else{sap.m.MessageBox.success("Não foi possivel determinar rota.");return}},_bindView:function(e){var t=this;var a=this.getView().getModel();var r;t.loading(false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.loading(true)},dataReceived:function(){t.loading(false);t.getView().byId("idPage").scrollTo(0,0)}}})},_onBindingChange:function(e){var t=this.getView().byId("LineItemsSmartTable");t.rebindTable("e")},onVoltar:function(e){this.getRouter().navTo("object",{Pernr:E})},_onMetadataLoaded:function(){var e=this.getView().getBusyIndicatorDelay(),t=this.getModel("detailView");t.setProperty("/delay",0);t.setProperty("/busy",true);t.setProperty("/delay",e)},onbeforeRebindTable:function(e){var t=O;var a=F;if(t){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Begda",operator:"EQ",value1:t}))}if(a){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Endda",operator:"EQ",value1:a}))}if(E){e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Pernr",operator:"EQ",value1:E}))}e.getParameter("bindingParams").filters.push(new sap.ui.model.Filter({path:"Tipo",operator:"EQ",value1:"X"}))},AfterUpdate:function(e){var t=this.getView().byId("FERIAS");var a=this.getView().byId("FERIAS").getBinding("rows").getLength();t.setVisibleRowCount(a)},FormatCheck:function(e){if(e==="X"){return true}else{return false}},FormatEditable:function(e){if(e){return false}else{return true}},onAprova:function(){var e=this.getView().byId("FERIAS");var t=e.getSelectedIndices();var a;var r;var i;var s={};var n=this.getView().getModel();var o=this;s.Tipo="A";if(t.length===0||t.length===""||t.length===undefined){sap.m.MessageBox.error("Selecione ao menos um registro para aprovar.");return}else{var d=new g({title:"Confirmación",type:"Message",content:new u({text:"¿Confirma la aprobación de los períodos seleccionados?"}),beginButton:new l({text:"Si",press:function(){for(var i=0;i<t.length;i++){a=e.getContextByIndex([t[i]]);s.Adiantamento=a.getObject().Adiantamento;r=a.sPath;n.update(r,s,{success:function(e,t){sap.m.MessageBox.success("Períodos aprovados com exito.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){K="";T="";L="";o.getView().getModel().refresh(true)}})},error:function(e){var t=e;t=t.responseText;var a=JSON.parse(t);var r=a.error.message.value;sap.m.MessageBox.error(r,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){}});return}})}d.close()}}),endButton:new l({text:"No",press:function(){d.close()}}),afterClose:function(){d.destroy()}});d.open()}},onReprova:function(){var e=this.getView().byId("FERIAS");var t=e.getSelectedIndices();var a;var r;var i;var s={};var n=this.getView().getModel();var o=this;s.Tipo="R";if(t.length===0||t.length===""||t.length===undefined){sap.m.MessageBox.error("Selecione ao menos um período para reprovar.");return}else{var d=new g({title:"Confirmação",type:"Message",content:new u({text:"Confirma a reprovação dos períodos selecionados?"}),beginButton:new l({text:"Sim",press:function(){for(var i=0;i<t.length;i++){a=e.getContextByIndex([t[i]]);r=a.sPath;n.update(r,s,{success:function(e,t){sap.m.MessageBox.success("Períodos reprovados com sucesso.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){K="";T="";L="";o.getView().getModel().refresh(true)}})},error:function(e){var t=e;t=t.responseText;var a=JSON.parse(t);var r=a.error.message.value;sap.m.MessageBox.error(r,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){}});return}})}d.close()}}),endButton:new l({text:"Não",press:function(){d.close()}}),afterClose:function(){d.destroy()}});d.open()}},onEdita:function(){var e=this.getView().byId("FERIAS");var t=e.getSelectedIndices();var a;var r;var i;var s={};var n=this.getView().getModel();var o=this;var o=this;if(t.length===0||t.length===""||t.length===undefined){sap.m.MessageBox.error("Seleciona um registro para editar.");return}else{a=e.getContextByIndex(t);r=a.sPath;var u="";u=new g({title:"Período de edição",type:"Message",content:[new d({text:"Inicio:",labelFor:"submitDialogTextarea"}),new p("submitDialogTextarea",{liveChange:function(e){A=e.getParameter("value");_=A},width:"100%",type:"Date"}),new d({text:"Dias gozo",labelFor:"idDiasDisfrute"}),new p("idDiasDisfrute",{liveChange:function(e){A=e.getParameter("value");S=A;var t=e.getSource().getParent();t.getBeginButton().setEnabled(A.length>0)},width:"100%"}),new f("IdAdelantoo",{text:"Adelanto",select:function(e){Y=e.getParameter("selected")},width:"100%"})],beginButton:new l({text:"Gravar",enabled:false,press:function(){S=parseInt(S);s.Inicio=_;s.DiasGozo=S;s.Tipo="Q";if(Y===true){s.Adiantamento="X"}else{s.Adiantamento=""}Y="";n.update(r,s,{success:function(e,t){sap.m.MessageBox.success("Solicitação enviada com exito",{actions:["OK"],onClose:function(e){K="";T="";L="";o.getView().getModel().refresh(true)}})},error:function(e){var t=e;t=t.responseText;var a=JSON.parse(t);var r=a.error.message.value;sap.m.MessageBox.error(r,{actions:["OK"],onClose:function(e){}});return}});u.close()}}),endButton:new l({text:"Cancelar",press:function(){u.close()}}),afterClose:function(){u.destroy()}});u.open()}},ChangeDataInicio:function(e){G=e.mParameters.id;this.getView().byId("idAprovar").setVisible(false);this.getView().byId("idReprovar").setVisible(false);this.getView().byId("idEditar").setVisible(false);this.getView().byId("idGravar").setVisible(true);this.getView().byId("idCancelar").setVisible(true);T="";var t=e;var a=t.getParameters().value;T=a},onChangeDiasGozo:function(e){D=e.mParameters.id;this.getView().byId("idAprovar").setVisible(false);this.getView().byId("idReprovar").setVisible(false);this.getView().byId("idEditar").setVisible(false);this.getView().byId("idGravar").setVisible(true);this.getView().byId("idCancelar").setVisible(true);L="";var t=e;var a=t.getParameters().value;L=a},onCancelar:function(){L="";T="";this.getView().byId("idAprovar").setVisible(true);this.getView().byId("idReprovar").setVisible(true);this.getView().byId("idEditar").setVisible(true);this.getView().byId("idGravar").setVisible(false);this.getView().byId("idCancelar").setVisible(false);if(D){this.getView().byId(D).setValue("")}if(G){this.getView().byId(G).setValue("")}},onGrava:function(){var e=this.getView().getModel();var t="";var a={};var r=this;if(!T){sap.m.MessageBox.error("Informe a data e início das férias");return}if(!L){sap.m.MessageBox.error("Informe dias de gozo");return}a.Inicio=T;L=parseInt(L);a.DiasGozo=L;a.Tipo="Y";if(K===true){a.Adiantamento="X"}else{a.Adiantamento=""}t="/ZET_GLHR_FERI_PERUSet(Pernr='"+E+"',Begda='"+O+"',Endda='"+F+"',Seqnr=0)";var i=new g({title:"Confirmação",type:"Message",content:new u({text:"Quer enviar a solicitação de férias?"}),beginButton:new l({text:"Sim",press:function(){e.update(t,a,{success:function(e,t){sap.m.MessageBox.success("Solicitação enviada com exito",{actions:["OK"],onClose:function(e){r.getView().getModel().refresh(true);K="";T="";L="";r.getView().byId("idAprovar").setVisible(true);r.getView().byId("idReprovar").setVisible(true);r.getView().byId("idEditar").setVisible(true);r.getView().byId("idGravar").setVisible(false);r.getView().byId("idCancelar").setVisible(false)}})},error:function(e){var t=e;t=t.responseText;var a=JSON.parse(t);var r=a.error.message.value;sap.m.MessageBox.error(r,{actions:["OK"],onClose:function(e){}});return}});i.close()}}),endButton:new l({text:"Não",press:function(){i.close()}}),afterClose:function(){i.destroy()}});i.open()},onSelectedAdiant:function(e){t="";var t=e.getParameters().selected;K=t}})});