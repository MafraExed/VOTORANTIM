"use strict";function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,o)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(t,e,r){if(e in t){Object.defineProperty(t,e,{value:r,enumerable:true,configurable:true,writable:true})}else{t[e]=r}return t}sap.ui.define(["./Base","sap/ui/model/json/JSONModel","com/innova/vendor/chart.js","sap/ui/core/HTML","sap/m/DialogType","sap/m/Dialog","sap/m/Button","sap/m/DatePicker","sap/m/ButtonType","sap/m/MessageToast","sap/ui/model/BindingMode","com/innova/factory/purchaseTracking/process","com/innova/lib/layout/layout","com/innova/formatter/columnTitleProcess","sap/ui/model/FilterOperator","sap/ui/model/Filter","com/innova/util/isEmpty","com/innova/model/formatter"],function(t,e,r,o,i,s,a,n,l,c,h,u,d,g,p,b,f,y){return t.extend("com.innova.sitrack.controller.purchaseTracking.Indicators",{layout:d,process:u,formatter:{columnTitleProcess:g},formatterLib:y,onInit:function t(){this._initialState();this._myChart=null;this._oPage=this.byId("page");this._oProcessTable=this.byId("indicatorsTable");this._oPorcentDayRetar=this.byId("oIPorcentDayRetar");this._oRouter=this.getRouter();this._oRouter.getRoute("purchaseTrackingIndicators").attachMatched(this._onRouteMatched,this)},_fetch:function t(){Promise.resolve(this._oPage.setBusy(true)).then(this._getInitialData.bind(this)).catch(this.errorHandler.bind(this)).then(this._oPage.setBusy.bind(this._oPage,false))},_getInitialData:function t(){return Promise.resolve(this._resetTableDefatuls()).then(this._fetchFirstPage.bind(this)).then(this._buildData.bind(this)).then(this._buildCatalogIndicators.bind(this))},_buildCatalogIndicators:function t(){var e=[];var r={};var o=this._oRes.catalog;o.forEach(function(t){var e=t.FIELDNAME;var o=t.SCRTEXT_L;r=_objectSpread(_objectSpread({},r),{},_defineProperty({},e,o))});e.push(r);this._oModel.setProperty("/catalog",this._oRes.catalog);this._oModel.setProperty("/indicatorsFields",r);this._oModel.setProperty("/indicators",this._oRes.indicators[0])},onPressIndicatorsButton:function t(){if(this._myChart){this._myChart.destroy()}if(!this.oApproveDialog){var e="<canvas id='myChart' width='1000' height='500'></canvas>";this.oApproveDialog=new s({type:i.Message,title:"{main>/textPool/K170}",content:[new o({content:e})],beginButton:new a({type:l.Emphasized,text:"Aceptar",press:function t(){this.oApproveDialog.close()}})})}this.oApproveDialog.open();var n=[];var c=[];var h=document.getElementById("myChart");this._oRes.graph.forEach(function(t){n.push(t.MESEJER);c.push(t.POH_INPOATRAS)});this._myChart=new r(h,{type:"bar",data:{labels:n,datasets:[{label:this.getMessageTextPool("K205"),data:c,backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},options:{scales:{y:{beginAtZero:true}}}})},_resetSortingState:function t(){var e=this._oProcessTable.getColumns();e.forEach(function(t){t.setSorted(false)})},onResetFilters:function t(){try{this._oPage.setBusy(true);var e=this._oProcessTable.getColumns().length;var r=0;for(r=0;r<e;r+=1){var o=this._oProcessTable.getColumns()[r];this._oProcessTable.getBinding("rows").filter([]);o.setFilterValue("");o.setFiltered(false)}}catch(t){this.errorHandler(t)}finally{this._oPage.setBusy(false)}},onResetOrder:function t(){try{this._oPage.setBusy(true);this._oProcessTable.getBinding().sort(null);this._resetSortingState()}catch(t){this.errorHandler(t)}finally{this._oPage.setBusy(false)}},onFilterByColumn:function t(e){var r=this;e.preventDefault();var o=e.getParameter("column");var i=e.getParameter("value");var s=f(i);var a=s?[]:[new b(o.getName(),p.Contains,"".concat(i))];var n=Promise.resolve(this._oPage.setBusy(true));if(this._hasMorePages()){n=this._getAllData().then(function(){r._setNewData(r._items)})}n.then(this._setFilterByColumn.bind(this,{column:o,filters:a,isEmptyValue:s})).catch(this.errorHandler.bind(this)).then(this._oPage.setBusy.bind(this._oPage,false))},_setFilterByColumn:function t(e){var r=e.column,o=e.filters,i=e.isEmptyValue;this.byId("indicatorsTable").getBinding("rows").filter(o);r.setFiltered(!i);if(this._oFilteredPreviousColumn&&this._oFilteredPreviousColumn!==r){this._oFilteredPreviousColumn.setFilterValue("");this._oFilteredPreviousColumn.setFiltered(false)}this._oFilteredPreviousColumn=r}})});