"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,o=new Array(t);r<t;r++){o[r]=e[r]}return o}function _iterableToArrayLimit(e,t){var r=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r==null)return;var o=[];var n=true;var i=false;var a,s;try{for(r=r.call(e);!(n=(a=r.next()).done);n=true){o.push(a.value);if(t&&o.length===t)break}}catch(e){i=true;s=e}finally{try{if(!n&&r["return"]!=null)r["return"]()}finally{if(i)throw s}}return o}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,o)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}sap.ui.define(["../BaseController","com/innova/model/constant","com/innova/service/petitions","com/innova/model/states","sap/ui/model/json/JSONModel","sap/ui/core/ValueState","com/innova/vendor/lodash.filter","com/innova/vendor/lodash.find","com/innova/util/isEmpty","sap/ui/model/BindingMode","com/innova/formatter/formatMessage"],function(e,t,r,o,n,i,a,s,l,c,u){return e.extend("com.innova.sitrack.controller.purchaseTracking.Base",{_initialState:function e(){this._allData=false;this._aSelectedContext=[];this._aSolPedNotifications=[];this._aPedNotifications=[];this._iColumnHeight=100;this._isExcel=false;this._items=[];this._keys=[];this._nextKeys=[];this._oFilteredPreviousColumn=null;this._oReq={};this._scrollTable=false;this._sTargetReturn=""},_onRouteMatched:function e(t){var r;this._oPaymentModel=this.getOwnerComponent().getModel("payment");var o=t.getParameter("arguments");var n=(r=o["?query"])===null||r===void 0?void 0:r.docs;var i=this.getOwnerComponent().getModel("store");var a=i.getProperty("/req");var s=i.getProperty("/keys");if(l(n)&&(l(a)||l(s))){this.getModel("appView").setProperty("/resetProcessForm",true);this.getRouter().navTo("purchaseTracking",{},true);return}this.getModel("appView").setProperty("/resetProcessForm",false);this._oProcessTable.setSelectedIndex(-1);this._oReq=this._buildReqByStoreOrQueryParams({req:a,docs:n});this.getOwnerComponent().getModel("store").setProperty("/req",this._oReq);this._keys=JSON.parse(JSON.stringify(s!==null&&s!==void 0?s:[]));this._oQuery=n;if(!this.getModel("appView").getProperty("/backFromButton")){this._fetch()}else{this._fetchNoLayout()}this.getModel("appView").setProperty("/backFromButton",false)},_buildReqByStoreOrQueryParams:function e(t){var r=t.req,o=t.docs,n=o===void 0?"":o;if(l(n)){return r}return{IT_SEL_FEILDS:n.split(",").map(function(e){return{FIELDNAME:"BANFN",LOW:e,OPTION:"EQ",SIGN:"I",TABNAME:"EBAN"}}),IV_INDIC_FECHA:"X",IV_INDIC_INFMAT:"X",IV_INDIC_ULTP:"X"}},_resetTableDefatuls:function e(){var t=this;this._scrollTable=true;this._oProcessTable.$().find(".sapUiTableVSb").scrollTop(0);setTimeout(function(){t._scrollTable=false},100)},_fetchFirstPage:function e(){var t=this;this._nextKeys=JSON.parse(JSON.stringify(this._keys));return this._getNextPage().then(function(e){var r=e.data;t._oRes=r;if(t._keys.length===0){t.getOwnerComponent().getModel("store").setProperty("/keys",r.dockeys);t._keys=r.dockeys}})},_buildData:function e(){var t={};t.allCatalog=JSON.parse(JSON.stringify(this._oRes.catalog));t.data=this._buildRows(this._oRes.items);t.dockeys=this._oRes.dockeys;t.total=this._keys.length||t.data.length;t.returnOption="";this._oModel=new n;this._oModel.setData(t);this._oModel.setDefaultBindingMode(c.TwoWay);this._oModel.setSizeLimit(1e6);this.setModel(this._oModel,"process")},_getNextPage:function e(){return Promise.resolve(this._getNextKeys()).then(this._buildRequestObjForPaging.bind(this)).then(this._fetchAPI.bind(this))},_buildRows:function e(t){var r=this;return t.map(function(e){return _objectSpread(_objectSpread({},e),{},{status:[o.buildStateOne({icon:e.ICON1,color:e.COLOR1}),o.buildStateSeven({icon:e.ICON7}),o.buildStateTwo({icon:e.ICON2,color:e.COLOR2}),o.buildStateThree({icon:e.ICON3,color:e.COLOR3}),o.buildStateFour({icon:e.ICON4,color:e.COLOR4}),o.buildStateFive({icon:e.ICON5,color:e.COLOR5})],quantities:r._buildInfoQuantities(e.PR_MENGE,e.PR_BSMNG,e.PR_MEINS),notification:r._setSolPedNotifications(e),longText:r._getLongTextByItem(e),longTextComp:r._getLongTextCompByItem(e)})})},_getLongTextCompByItem:function e(t){var r="";if(t.MAT_TEXT_COMPR){t.MAT_TEXT_COMPR.forEach(function(e){if(e.TDLINE!==null){r+="".concat(e.TDLINE," ")}})}return r},_getAllData:function e(){var t=this;this._allData=true;return this._getNextPage().then(function(e){var r=e.data;r=r===void 0?{}:r;var o=r.items,n=o===void 0?[]:o;t._items=t._items.concat(n);return t._nextKeys.length>0?t._getAllData():Promise.resolve()})},_setSolPedNotifications:function e(t){var r=this._aSolPedNotifications.concat(this._aPedNotifications);var o;var n={BANFN:t.BANFN,BNFPO:t.BNFPO};var i={EBELN:t.EBELN,EBELP:t.EBELP};var c=s(this._aSelectedObjects,n);if(!l(c)){var u=a(r,n);if(!l(u)){var _=a(r,_objectSpread(_objectSpread({},n),{},{BNFPO:0}));var f=_slicedToArray(u,1),h=f[0].TYPE;o={data:u.concat(_),type:h}}var d=a(r,i);if(!l(d)){var y=_slicedToArray(d,1),p=y[0].TYPE;o={data:d,type:p}}}return o},_buildRequestObjForPaging:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var r=JSON.parse(JSON.stringify(this._oReq));r.IT_DOCKEYS=t;r.IV_ONLYKEYS="";return r},_fetchAPI:function e(o){return r.post("".concat(t.GET_PROCESS_SELECTED),o)},_getNextKeys:function e(){var r=this._nextKeys.length>=t.PURCHASE_TRACKING_PER_PAGE;var o=r?this._nextKeys.slice(0,t.PURCHASE_TRACKING_PER_PAGE):this._nextKeys||[];this._nextKeys=r?this._nextKeys.slice(t.PURCHASE_TRACKING_PER_PAGE):[];return o},_getLongTextByItem:function e(t){var r="";t.MAT_TEXT_LARGO.forEach(function(e){if(e.TDLINE!==null){r+="".concat(e.TDLINE," ")}});return r},_buildInfoQuantities:function e(t,r,o){var n={};if(t>0){n.PR_MENGE={percentValue:"100",state:i.Success,displayValue:"{main>/textPool/K046} - ".concat(t," ").concat(o)};var a=this._getStateProgress(r,t);n.PR_BSMNG={percentValue:a.nPercentage,state:a.sState,displayValue:"{main>/textPool/K047} - ".concat(r," ").concat(o)}}else{n.PR_BSMNG={percentValue:100,state:i.Success,displayValue:"{main>/textPool/K047} - ".concat(r," ").concat(o)}}return n},_getStateProgress:function e(t,r){var o=t*100/r;var n="Information";if(o===100){n=i.Success}if(o<99&&o>49){n="Warning"}if(o<50&&o>0){n="Error"}return{sState:n,nPercentage:o}},formatTitle:function e(t,r){for(var o=arguments.length,n=new Array(o>2?o-2:0),i=2;i<o;i++){n[i-2]=arguments[i]}return u.apply(void 0,[t,r.length].concat(n))},onScrollHandler:function e(){var t=this;if(this._hasMorePages()){this._scrollTable=true;this._getNextPage().then(function(e){var r=e.data;r=r===void 0?{}:r;var o=r.items,n=o===void 0?[]:o;t._setNewData(n)}).catch(this.errorHandler.bind(this)).finally(function(){t._scrollTable=false})}},_setNewData:function e(t){var r=this._buildRows(t);var o=this._oModel.getProperty("/data");this._oModel.setProperty("/data",o.concat(r))},_hasMorePages:function e(){return!l(this._nextKeys)&&!this._scrollTable&&!this._isExcel&&!this._allData}})});