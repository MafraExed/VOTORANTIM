"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);if(o==="Object"&&e.constructor)o=e.constructor.name;if(o==="Map"||o==="Set")return Array.from(e);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(e,t)}function _iterableToArray(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var o=0,r=new Array(t);o<t;o++){r[o]=e[o]}return r}function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,r)}return o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach(function(t){_defineProperty(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function _defineProperty(e,t,o){if(t in e){Object.defineProperty(e,t,{value:o,enumerable:true,configurable:true,writable:true})}else{e[t]=o}return e}
/*!
 * SiTrack - Seguimiento de compras
 * (c) Copyright 2022 Innova Internacional S.A.S.
 */sap.ui.define(["com/innova/sitrack/lib/formUtils/formUtils","com/innova/sitrack/model/constant","com/innova/sitrack/model/purchaseTracking/Position","com/innova/sitrack/utils/isEmpty","com/innova/sitrack/utils/showToast","com/innova/service/http","sap/ui/core/Fragment"],function(e,t,o,r,n,i,a){return{onShowNewPositionDialog:function e(){var t=this;var o=this.getView();a.load({id:o.getId(),name:"com.innova.sitrack.view.purchaseTracking.dialog.position.NewPosition",controller:this}).then(function(e){var r=e;o.addDependent(r);r.getEndButton().attachPress(r.close.bind(r));r.attachAfterClose(r.destroy.bind(r));t._oNewPositionDialog=r;r.open()})},onNewPosition:function r(){var a=this;var s=this.byId("newPositionForm");Promise.resolve(this._oNewPositionDialog.setBusy(true)).then(this._isValidForm.bind(this,s)).then(e.getFormData.bind(e,s)).then(function(e){return new o(_objectSpread(_objectSpread({},e),{},{posProc:a._generatePositionId(),processId:a._numProc}))}).then(i.post.bind(i,t.api.PROCESS_POSITION_PATH)).then(function(e){var t=e.data;a._oFormModel.setProperty("/positions",[].concat(_toConsumableArray(a._oFormModel.getProperty("/positions")),[t]));n("__Se han procesado los datos correctamente.");a._oNewPositionDialog.close()}).catch(this.errorHandler.bind(this)).finally(this._oNewPositionDialog.setBusy.bind(this._oNewPositionDialog,false))},onDeletePosition:function e(){var t=this;Promise.resolve(this._oPage.setBusy(true)).then(this._getSelectedIndices.bind(this,this.byId("positionTable"))).then(function(e){t._deletePositionIds=e.map(function(e){return e.getProperty("BANFN")});t._deleteBindingRowsPositions({path:"/processSelected",ids:t._deletePositionIds});t.byId("positionTable").clearSelection()}).catch(this.errorHandler.bind(this)).finally(this._oPage.setBusy.bind(this._oPage,false))},onChangeMatnr:function e(t){var o=t.getSource();o.setDescription();var r=this.byId("maktxPosition");r.setDescription();if(this._oSearchHelpContext){r.setValue(this._oSearchHelpContext.FTEXT);var n=this.byId("meinsPosition");n.setValue(this._oSearchHelpContext.FCODE5);n.setValue(this._oSearchHelpContext.FCODE5);n.destroySuggestionItems().addSuggestionItem(new sap.ui.core.ListItem({key:this._oSearchHelpContext.FCODE5,text:this._oSearchHelpContext.FCODE5}));n.setSelectedKey(this._oSearchHelpContext.FCODE5);var i=this.byId("matklPosition");i.setValue(this._oSearchHelpContext.FCODE4);i.destroySuggestionItems().addSuggestionItem(new sap.ui.core.ListItem({key:this._oSearchHelpContext.FCODE4,text:this._oSearchHelpContext.FCODE4}));i.setSelectedKey(this._oSearchHelpContext.FCODE4);this._oSearchHelpContext=null}},_generatePositionId:function e(){var t=this._oFormModel.getProperty("/positions").map(function(e){var t=e.posProc;return t});return r(t)?1:Math.max.apply(Math,_toConsumableArray(t))+1}}});