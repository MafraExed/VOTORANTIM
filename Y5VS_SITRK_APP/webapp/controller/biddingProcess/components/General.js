"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);if(o==="Object"&&e.constructor)o=e.constructor.name;if(o==="Map"||o==="Set")return Array.from(e);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(e,t)}function _iterableToArray(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var o=0,n=new Array(t);o<t;o++){n[o]=e[o]}return n}function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach(function(t){_defineProperty(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function _defineProperty(e,t,o){if(t in e){Object.defineProperty(e,t,{value:o,enumerable:true,configurable:true,writable:true})}else{e[t]=o}return e}
/*!
 * SiTrack - Seguimiento de compras
 * (c) Copyright 2022 Innova Internacional S.A.S.
 */sap.ui.define(["com/innova/sitrack/lib/formUtils/formUtils","com/innova/sitrack/lib/richTextEditor/editor","com/innova/sitrack/model/constant","com/innova/sitrack/model/purchaseTracking/Process2","com/innova/sitrack/model/purchaseTracking/TypesDocEnum","com/innova/sitrack/model/purchaseTracking/bidding/PositionSap","com/innova/sitrack/model/purchaseTracking/bidding/BiddingPosition","com/innova/sitrack/utils/showToast","com/innova/service/http","com/innova/vendor/moment","com/innova/util/isEmpty","sap/ui/core/ListItem"],function(e,t,o,n,r,i,a,s,c,u,l,d){return{onTipoProcSuggest:function e(t){this._inputSuggest(t,o.api.PROCESS_TYPE_PATH)},onCategorySuggest:function e(t){this._inputSuggest(t,o.api.PROCESS_CATEGORY_PATH)},onCondNegocChange:function e(t){this.byId("dztermFormContainer").setVisible(!t)},onValRfiChange:function e(t){this.byId("numRfiFormContainer").setVisible(t)},onPregRespChange:function e(t){this.byId("limPregFormContainer").setVisible(t)},onSuggestionItemSelected:function e(t,o){t.setValue(o.getText())},onLimPregChange:function e(t,o){var n=this.byId("limOferta");var r=n.getDateValue();if(l(r)){t.setDateValue();s(this.getMessageTextPool("K369"))}var i=u(o,"DD/MM/YYYY").isAfter(r);if(i){t.setDateValue();s(this.getMessageTextPool("K353"))}},onLimOfertaChange:function e(t,o){t.setValueState(sap.ui.core.ValueState.None);if(!o){t.setDateValue();t.setValueState(sap.ui.core.ValueState.Error);s(this.getMessageTextPool("K370"))}},onFechaEntregaChange:function e(t,o,n){t.setValueState(sap.ui.core.ValueState.None);var r=t.getName();var i=t.getBindingContext("store");var a=i.getPath();var c=i.getModel();if(!n){t.setDateValue();t.setValueState(sap.ui.core.ValueState.Error);c.setProperty("".concat(a,"/").concat(r),"");s(this.getMessageTextPool("K370"))}else{c.setProperty("".concat(a,"/").concat(r),o)}c.updateBindings(true);c.refresh()},onValidateCurrency:function e(t,o){var n;var r=this.byId("".concat(t.data("exclude")));var i=t.data("disableButtonId");var a=l(o);(n=this.byId("".concat(i)))===null||n===void 0?void 0:n.setEnabled(true);t.setValueState(sap.ui.core.ValueState.None);if(a){t.setDescription("");t.setValue("");r.setValueState(sap.ui.core.ValueState.None);r.setRequired(a);r.setEditable(a)}else{var s=this.searchHelp.getControlFieldname(t);Promise.resolve(t.setBusy(true)).then(this.searchHelp._validateValueInSearchHelp.bind(this,{name:s,value:o.toUpperCase()})).then(function(e){var n=e;if(!n){a=true;t.setValueState(sap.ui.core.ValueState.Error);t.setValue(null)}t.setValue(o.toUpperCase());t.setDescription(n===null||n===void 0?void 0:n.FTEXT);r.setValueState(sap.ui.core.ValueState.None);r.setRequired(a);r.setEditable(a)}).catch(this.errorHandler.bind(this)).finally(t.setBusy.bind(t,false))}},_createPositionsRequest:function e(t){var n=this;var r=t.data;this._oNumProcBidding=r.numProc;var i=this._oStoreModel.getProperty("/processSelected");var s=i.map(function(e,t){return _objectSpread(_objectSpread({},e),{},{posProc:t+1,processId:n._oNumProcBidding})});var u=[];s.forEach(function(e){u.push(c.post("".concat(o.api.POSITION_BIDDING_PATH),new a(e)))});return u},_sendPositionBidding:function e(t){return t.reduce(function(e,t){return e.then(function(e){return t.then(function(t){return[].concat(_toConsumableArray(e),[t])})})},Promise.resolve([]))},_handleResponseToSap:function e(t){var o=this;var n=t.data;if(n.status==="success"){this._oNumProcBidding=n.process.numProc}var r=this._oStoreModel.getProperty("/processSelected");var a=r.map(function(e){return{LICITA:o._oNumProcBidding,BANFN:e.BANFN,BNFPO:e.BNFPO}});return new i(a)},_oNavToPosition:function e(){s("".concat(this.getMessageTextPool("K331")).concat(this._oNumProcBidding));this.onNavBackTable()},_renderEditors:function e(o){var n=this;var r=o.data;setTimeout(function(){t.removeEditorManager();n._oInvitationEmailEditor=t.initializeQuillEditor.call(n,{container:n.byId("invitationEmailEditor").getDomRef(),placeholder:n.getMessageTextPool("K365"),setup:function e(t){t.on("init",function(){t.setContent(r.content)})}});n._oInvitationEmailEditor.render();n._oOferenteEditor=t.initializeQuillEditor.call(n,{container:n.byId("editorOferente").getDomRef(),placeholder:n.getMessageTextPool("K285"),setup:function e(t){t.on("init",function(){t.setContent("")})}});n._oOferenteEditor.render();n._oInternoEditor=t.initializeQuillEditor({container:n.byId("editorInterno").getDomRef(),placeholder:n.getMessageTextPool("K286"),setup:function e(t){t.on("init",function(){t.setContent("")})}});n._oInternoEditor.render()},0)},_renderEditorsWithData:function e(){var o=this;setTimeout(function(){t.removeEditorManager();o._oInvitationEmailEditor=t.initializeQuillEditor.call(o,{container:o.byId("invitationEmailEditor").getDomRef(),placeholder:o.getMessageTextPool("K285"),setup:function e(t){t.on("init",function(){})}});o._oInvitationEmailEditor.render();o._oOferenteEditor=t.initializeQuillEditor.call(o,{container:o.byId("editorOferente").getDomRef(),placeholder:o.getMessageTextPool("K285"),setup:function e(t){t.on("init",function(){})}});o._oOferenteEditor.render();o._oInternoEditor=t.initializeQuillEditor({container:o.byId("editorInterno").getDomRef(),placeholder:o.getMessageTextPool("K286"),setup:function e(t){t.on("init",function(){})}});o._oInternoEditor.render()},0)},_buildProcessObjToSave:function t(){var o=e.getFormData(this._oGeneralForm);var i=this._oStoreModel.getProperty("/processSelected");return new n(_objectSpread(_objectSpread({},o),{},{ernamDesc:this.byId("oIErnamInput").getDescription(),tipoDoc:r.LIC_COT,infoOferentes:this._oOferenteEditor.getContent(),infoInterno:this._oInternoEditor.getContent(),templateInvitation:this._oInvitationEmailEditor.getContent(),positions:i}))},_inputSuggest:function e(t,o){c.get("".concat(o)).then(function(e){var t=e.data;return t}).then(function(e){t.destroySuggestionItems();e.forEach(function(e){t.addSuggestionItem(new d({key:e.id,text:e.description,additionalText:e.id}))})}).catch(this.errorHandler.bind(this))},_validateProcessCurrency:function e(t){var o=t.offers,n=o===void 0?[]:o;var r=n.some(function(e){var t=e.pricesPerRound;return t.length});this.byId("processCurrency").setEnabled(!r)},_validatePartialOffers:function e(t){var o=t.offers,n=o===void 0?[]:o;var r=n.some(function(e){var t=e.positions;return t.length});this.byId("offerPartialSwitch").setEnabled(!r)}}});