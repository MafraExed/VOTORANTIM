"use strict";function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}
/*!
 * SiTrack - Seguimiento de compras
 * (c) Copyright 2022 Innova Internacional S.A.S.
 */sap.ui.define(["com/innova/sitrack/model/item/FormItem","com/innova/sitrack/model/item/OptionType","com/innova/sitrack/model/variant/ItemVariant","com/innova/sitrack/utils/addPatternToText","sap/m/Token","sap/ui/core/ValueState","com/innova/util/isEmpty"],function(e,t,n,r,a,o,i){var u=function e(t,n){var r=t.length;if(r>0){for(var a=0;a<r;a+=1){var o=t[a];if(o.getKey()===n){return true}}}return false};var c=function e(t){return function(e){var n=e.text;if(t!=="X"){n=n.toUpperCase()}return new a({key:n,text:n})}};var f=function e(t){var n=t.text;if(/^\w+([\\.-]?\w+)*@\w+([\\.-]?\w+)*(\.\w{2,3})+$/.test(n)){return new a({key:n,text:n})}return undefined};var l=function e(t){var n=t.getSource();var r=n.getBindingContext();var a=r.getPath();var o=r.getModel();var u=r.getProperty("E_MAILS");if(i(u)){u=[]}var c=t.getParameter("type");var f=t.getParameter("addedTokens");var l=t.getParameter("removedTokens");if(c==="added"){f.forEach(function(e){u.push({EMAIL:e.getKey()})})}else if(c==="removed"){l.forEach(function(e){u=u.filter(function(t){return t.EMAIL!==e.getKey()})})}o.setProperty("".concat(a,"/E_MAILS"),u)};var d=function a(o){var i=o.fieldname,u=o.functionName,c=o.group,f=o.isVariant,l=o.maxLength,d=o.option,s=o.tabname,p=o.token;var m=d===t.CP?r(p.getText(),l):p.getText();return!f?new e({fieldname:i,low:m,option:d,tabname:s}):new n({fieldname:i,function:u,group:c,low:m,option:d,tabname:s})};var s=function e(n){var r=n.fieldname,a=n.functionName,o=n.group,i=n.isVariant,u=n.lowercase,c=n.maxLength,f=n.tabname,l=n.tokens;var s=u?t.EQ:t.CP;return l.map(function(e){return d({fieldname:r,functionName:a,group:o,isVariant:i,maxLength:c,option:s,tabname:f,token:e})})};var p=function e(t){var n=t.field;return n.getTokens().length>0};return{isMultiInputValid:p,addTokensToMultiInput:function e(t,n,r){t.forEach(function(e){var t=e[n]||e.getObject()[n];t=t.replace(/\*/g,"");if(!u(r.getTokens(),t)){r.addToken(new a({key:t,text:t}))}})},addValidatorAllMultiInputs:function e(t){var n=t.fields;n.filter(function(e){return e.isA("sap.m.MultiInput")}).forEach(function(e){e.removeAllValidators();e.addValidator(c(e.data("lowercase")))})},addValidatorEmailMultiInputs:function e(t){var n=t.fields;n.filter(function(e){return e.isA("sap.m.MultiInput")}).forEach(function(e){e.removeAllValidators();e.addValidator(f);e.attachTokenUpdate(l)})},getMultiInputData:function e(t){var n=t.field,r=t.isVariant,a=t.functionName,i=t.group;var u=[];var c=n.getTokens();if(c&&c.length>0){n.setValueState(o.None);u=s({fieldname:n.getName(),functionName:a,group:i,isVariant:r,lowercase:n.data("lowercase")!=="X",maxLength:n.getMaxLength(),tabname:n.data("tabname"),tokens:c})}return _objectSpread({},u.length&&_defineProperty({},n.getName(),u))},setMultiInputData:function e(t){var n=t.field,r=t.data;n.addToken(new a({key:r.LOW,text:r.LOW}))},cleanMultiInput:function e(t){var n=t.field;n.removeAllTokens();n.fireTokenUpdate({type:"removed"})}}});