"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var a=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(a==null)return;var r=[];var o=true;var n=false;var i,l;try{for(a=a.call(e);!(o=(i=a.next()).done);o=true){r.push(i.value);if(t&&r.length===t)break}}catch(e){n=true;l=e}finally{try{if(!o&&a["return"]!=null)a["return"]()}finally{if(n)throw l}}return r}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach(function(t){_defineProperty(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _defineProperty(e,t,a){if(t in e){Object.defineProperty(e,t,{value:a,enumerable:true,configurable:true,writable:true})}else{e[t]=a}return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(e,t)}function _iterableToArray(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,r=new Array(t);a<t;a++){r[a]=e[a]}return r}
/*!
 * SiTrack - Seguimiento de compras
 * (c) Copyright 2022 Innova Internacional S.A.S.
 */sap.ui.define(["com/innova/factory/searchHelp/searchHelp","com/innova/lib/formUtils/formUtils","com/innova/model/constant","com/innova/model/searchHelp/SearchHelp","com/innova/service/petitions","com/innova/util/hasAllPropsEmpty","com/innova/util/keyBy","com/innova/util/throwError","com/innova/vendor/lodash.find","com/innova/vendor/lodash.get","sap/base/strings/formatMessage","sap/ui/core/Fragment","sap/ui/core/ListItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","com/innova/sitrack/utils/showToast"],function(e,t,a,r,o,n,i,l,s,c,u,d,p,y,h,m,f){var g={factory:e,getControlFieldname:function e(t){var a=t.getName();var r=t.data("fieldname");return r!==null&&r!==void 0?r:a},onValueHelpRequest:function e(t){var n=t.getSource();var i=n.getName();if(n.data().toSeachHelp){i=n.data().toSeachHelp}var l=null;if(this.getModel("oDataToSearchHelp")){l=this.getModel("oDataToSearchHelp").getData()}this._oControlSHelp=n;var s=new r(i,{IvOnlyfcat:"X",FCODE2:l});Promise.resolve(n.setBusy(true)).then(o.post.bind(o,a.GET_SEARCH_HELP,s)).then(function(e){var t=e.data;return t}).then(g._processDynamicData.bind(this)).then(g._showDynamicDialog.bind(this,s)).catch(this.errorHandler.bind(this)).then(n.setBusy.bind(n,false))},onSearch:function e(t,a){var r=[];if(a&&a.length>0){r=g._getFilter(this._oControlSHelp.getName(),a,t.getModel().getProperty("/catalog"))}var o=g._getBindingItems.call(this,t);if(r.length!==0){o.filter(new y(r,false))}else{o.filter([])}},onClose:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];try{if(t.length){var a=this._oControlSHelp.getMetadata().getName();var r="_setValue".concat(a.split(".").pop(),"Control");if(g["".concat(r)]){g["".concat(r)].call(this,t,this._oControlSHelp,this._sKeySHelp)}}this._sKeySHelp=null;this._oControlSHelp=null;g.onCloseDynamicDialog.call(this)}catch(e){this.errorHandler(e)}},onConfirmSelectedOption:function e(){try{var t=this.byId("dynamicSHTable");var a=t.getSelectedItems();if(a.length){var r=this._oControlSHelp.getMetadata().getName();var o="_setValue".concat(r.split(".").pop(),"Control");if(g["".concat(o)]){g["".concat(o)].call(this,a,this._oControlSHelp,this._sKeySHelp)}this._sKeySHelp=null;this._oControlSHelp=null;g.onCloseDynamicDialog.call(this)}}catch(e){this.errorHandler(e)}},onToggleFilters:function e(t){this.byId("SimpleFormSH").setVisible(t);this.byId("execButton").setVisible(t)},onCustomFilter:function e(){var i=this;try{var s=this.byId("dynamicContainer");var c=this.byId("staticContainer");var u=t.getDataFromFields({formElements:[].concat(_toConsumableArray(s.getFormElements()),_toConsumableArray(c.getFormElements()))});l(n(u),this.getMessageTextPool("064"));var d=this._oControlSHelp.getName();if(this._oControlSHelp.data().toSeachHelp){d=this._oControlSHelp.data().toSeachHelp}var p=null;if(this.getModel("oDataToSearchHelp")){p=this.getModel("oDataToSearchHelp").getData()}var y=new r(d.toUpperCase(),{FCODE2:p});g._setRequestData(y,u);Promise.resolve(this._oDynamicDialog.setBusy(true)).then(o.post.bind(o,a.GET_SEARCH_HELP,y)).then(function(e){if(e.data.data.length===0){f(i.getMessageTextPool("K060"))}return e.data}).then(g._processDynamicData.bind(this)).then(function(e){i._oDynamicTable.destroyColumns();i._oDynamicTable.destroyItems();i._oDynamicDialog.setModel(e)}).catch(this.errorHandler.bind(this)).finally(this._oDynamicDialog.setBusy.bind(this._oDynamicDialog,false))}catch(e){this.errorHandler(e);this._oDynamicDialog.setBusy(false)}},onCloseDynamicDialog:function e(){if(this._oDynamicDialog){this._oDynamicDialog.close();this._oDynamicDialog.destroy();this._oDynamicDialog=null}},onValidateInputLiveChange:function e(t){var a;var r=t.getSource();var o=r.data("disableButtonId");(a=this.byId("".concat(o)))===null||a===void 0?void 0:a.setEnabled(false)},onValidateInputErnam:function e(t){var a,r=this;var o=t.getSource();var n=o.getValue();var i=o.data("disableButtonId");var l=this.byId("oIEmailManage");o.setValueState(sap.ui.core.ValueState.None);o.setDescription("");(a=this.byId("".concat(i)))===null||a===void 0?void 0:a.setEnabled(true);if(n){var s=g.getControlFieldname(o);Promise.resolve(o.setBusy(true)).then(g._validateValueInSearchHelp.bind(this,{name:s,value:n.toUpperCase()})).then(function(e){var t=e;if(!t){o.setValueState(sap.ui.core.ValueState.Error);o.setValue(null)}else{r._oSearchHelpContext=e;o.setValue(n.toUpperCase())}o.setDescription(t===null||t===void 0?void 0:t.FTEXT);l.setValue(t===null||t===void 0?void 0:t.FCODE2)}).catch(this.errorHandler.bind(this)).finally(o.setBusy.bind(o,false))}},_validateValueInSearchHelp:function e(t){var n=t.name,i=t.value;var l=new r(n.toUpperCase());l.setFCODE1(i);return o.post(a.GET_SEARCH_HELP,l).then(function(e){var t=e.data;var a=c(t,"data",[]);var r=s(a,{FCODE1:i});return r})},_setSelected:function e(t,a){var r=a.tokens,o=a.key;return t.map(function(e){return _objectSpread(_objectSpread({},e),{},{selected:r.some(function(t){return t.getKey()===e[o]})})})},_processDynamicData:function e(t){var a=i(t.catalog,"FIELDNAME");var r=t.data;var o=s(a,{F4AVAILABL:"X"});this._sKeySHelp=o.FIELDNAME;if(this._oControlSHelp.getMetadata().getName()==="sap.m.MultiInput"){r=g._setSelected(r,{tokens:this._oControlSHelp.getTokens(),key:this._sKeySHelp})}var n="".concat(a[this._sKeySHelp].SCRTEXT_L||a[this._sKeySHelp].REPTEXT);var l="";if(r.length>0){l=u(this.getMessageTextPool("K304"),["".concat(r.length),n])}a.FCODE2.SHOW_WERKS=null;if(n==="Material"){a.FCODE2.SHOW_WERKS="X"}return g._setSearchHelpModel.call(this,{catalog:a,data:r,title:l,lang:c(t,"spras",[]),shortTitle:n})},_setSearchHelpModel:function e(t){var a=t.catalog,r=t.data,o=t.lang,n=o===void 0?[]:o,i=t.title,l=t.shortTitle;var s=new m({catalog:a,data:r,lang:n,properties:{key:this._sKeySHelp,shortTitle:"".concat(l),mode:this._oControlSHelp.data("multi")==="true"?"MultiSelect":"None",title:"".concat(i),visible:r.length>0}});s.setSizeLimit(1e6);return s},_showDynamicDialog:function t(a,r){var o=this;if(!this._oDynamicDialog){d.load({id:this.getView().getId(),name:"com.innova.sitrack.view.searchHelp.DynamicSearchHelpDialog",controller:this}).then(function(t){o.getView().addDependent(t);t.addStyleClass(o.getOwnerComponent().getContentDensityClass());o._oDynamicTable=o.byId("dynamicSHTable");o._oDynamicTable.bindAggregation("columns",{path:"/catalog",sorter:{path:"COL_POS"},filter:[new y({path:"TECH",operator:"NE",value1:"X"}),new y({path:"NO_OUT",operator:"NE",value1:"X"}),new y({path:"SHOW_WERKS",operator:"NE",value1:"X"})],factory:e.sHelpColumnFactory(r.getProperty("/properties/key"))});o._oDynamicTable.bindItems({path:"/data",factory:e.tableItemDynamicSH.call(o,"/catalog")});o._oRowsStepInput=o.byId("rows");o._oSprasComboBox=o.byId("spras");o.oSimpleFormFilter=o.byId("SimpleFormFilter");o.oSimpleFormSH=o.byId("SimpleFormSH");var n=a.IV_ONLYFCAT==="X";o.oSimpleFormSH.setVisible(n);o.oSimpleFormFilter.setVisible(!n);t.setModel(r);o._oDynamicDialog=t;o._oDynamicDialog.open()})}else{this._oRowsStepInput.setValue(20);this._oSprasComboBox.setSelectedKey("S");this._oDynamicTable.destroyColumns();this._oDynamicTable.destroyItems();this._oDynamicDialog.setModel(r);this._oDynamicDialog.open()}},_getFilter:function e(t,a){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var o=[new y(t,"".concat(h.Contains.toString()),"".concat(a))];var n=Object.keys(r);if(n.length){o=n.filter(function(e){return r[e].TECH!=="X"}).map(function(e){return new y(r[e].FIELDNAME,"".concat(h.Contains.toString()),"".concat(a))})}return o},_getBindingItems:function e(t){return t.getMetadata().getName()==="sap.m.TableSelectDialog"?t.getBinding("items"):this.byId("dynamicSHTable").getBinding("items")},_setRequestData:function e(t,a){return Object.entries(a).forEach(function(e){var a=_slicedToArray(e,2),r=a[0],o=a[1];return o&&t["set".concat(r)](o)})},_getValue:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";return t!=="*"?t.replace(/\*/g,""):t},_comparerTokens:function e(t){return function(e){return t.filter(function(t){return e===t.getKey()}).length===0}},_setValueInputControl:function e(t,a,r){var o=_slicedToArray(t,1),n=o[0];var i=g._getValue(n.getProperty(r));a.setValue(i);a.destroySuggestionItems().addSuggestionItem(new p({key:i,text:i}));a.setSelectedKey(i);a.fireChangeEvent(i)},_setValueMultiInputControl:function e(t,a,r){t.map(function(e){return g._getValue(e[r]||e.getBindingContext().getProperty("".concat(e.getBindingContext(),"/").concat(r)))}).filter(g._comparerTokens(a.getTokens())).forEach(function(e){return a.addToken(new sap.m.Token({key:e,text:e}))});a.fireTokenUpdate({type:"added"})}};return g});