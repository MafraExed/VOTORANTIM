"use strict";function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach(function(t){_defineProperty(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _defineProperty(e,t,a){if(t in e){Object.defineProperty(e,t,{value:a,enumerable:true,configurable:true,writable:true})}else{e[t]=a}return e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(e);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _arrayLikeToArray(e,t)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var a=0,r=new Array(t);a<t;a++){r[a]=e[a]}return r}function _iterableToArrayLimit(e,t){var a=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(a==null)return;var r=[];var n=true;var i=false;var o,l;try{for(a=a.call(e);!(n=(o=a.next()).done);n=true){r.push(o.value);if(t&&r.length===t)break}}catch(e){i=true;l=e}finally{try{if(!n&&a["return"]!=null)a["return"]()}finally{if(i)throw l}}return r}function _arrayWithHoles(e){if(Array.isArray(e))return e}
/*!
 * SiTrack - Seguimiento de compras
 * (c) Copyright 2022 Innova Internacional S.A.S.
 */sap.ui.define(["com/innova/model/constant","com/innova/model/variant/Action","com/innova/model/variant/Function","com/innova/model/variant/Variant","com/innova/service/petitions","com/innova/util/isEmpty","com/innova/util/showToast","sap/m/Button","sap/m/CheckBox","sap/m/Dialog","sap/m/Input","sap/m/Label","sap/ui/core/Fragment","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel"],function(e,t,a,r,n,i,o,l,s,c,u,d,f,p,y,h){var b={onGetVariant:function i(o,l,s){var c=this;var u=c.getModel("appView");try{u.setProperty("/busy",true);n.post("".concat(e.GET_VARIANT),new r({function:a["".concat(s)],action:t.READ})).then(b._showVariantDialog.bind(c)).catch(c.errorHandler.bind(this)).then(u.setProperty.bind(u,"/busy",false))}catch(e){c.errorHandler(e);u.setProperty("/busy",false)}},onSaveVariant:function e(t,r,n){var i=this;var o=i.getModel("appView");try{i._sVariantFunction=a["".concat(n)];Promise.resolve(o.setProperty("/busy",true)).then(i._getFormDataForVariant.bind(i)).then(b._validateFormData.bind(i)).then(b._showSaveVariantDialog.bind(i)).catch(i.errorHandler.bind(i)).finally(o.setProperty.bind(o,"/busy",false))}catch(e){i.errorHandler(e);o.setProperty("/busy",false)}},onSaveVariantHandler:function t(a){var r=a.defaultVariant,l=a.nameVariant;var s=this;try{if(i(l)){throw new Error(s.getMessageTextPool("K069"))}Promise.resolve(s._oSaveVariantDialog.setBusy(true)).then(b._createPostRequest.bind(s,{defaultVariant:r,nameVariant:l})).then(n.post.bind(n,e.GET_VARIANT)).then(function(e){var t=e.data;return o(t.message)}).then(s._oSaveVariantDialog.close.bind(s._oSaveVariantDialog)).catch(s.errorHandler.bind(s)).finally(s._oSaveVariantDialog.setBusy.bind(s._oSaveVariantDialog,false))}catch(e){s.errorHandler(e);s._oSaveVariantDialog.setBusy(false)}},onSearch:function e(t,a){var r=[];if(a&&a.length>0){r=[new p("ZVARIANT",y.Contains,a)]}var n=t.getBinding("items");if(r.length!==0){n.filter(new p(r,false))}else{n.filter([])}},onConfirm:function i(o){var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(l.length){var s=this;var c=s.getModel("appView");try{c.setProperty("/busy",true);var u=_slicedToArray(l,1),d=u[0];var f=d.getProperty("ZVARIANT");n.post("".concat(e.GET_VARIANT),new r({function:a.PROCESS,action:t.GET,nameVariant:f})).then(s._bindVariantData.bind(s)).catch(s.errorHandler.bind(s)).then(function(){return o.getBinding("items").filter([])}).finally(c.setProperty.bind(c,"/busy",false))}catch(e){s.errorHandler(e);c.setProperty("/busy",false)}}},onDefault:function i(l){var s=l.getBindingContext();var c=s.getObject(),u=c.ZVARIANT;var d=this;var f=d.getModel("appView");f.setProperty("/busy",true);n.post("".concat(e.GET_VARIANT),new r({action:t.ASSING,defaultVariant:"X",function:a.PROCESS,nameVariant:u})).then(function(e){var t=e.data;return o(t.message)}).catch(d.errorHandler.bind(d)).finally(f.setProperty.bind(f,"/busy",false))},onGetDefaultVariant:function i(){var o=this;var l=o.getModel("appView");try{l.setProperty("/busy",true);n.post("".concat(e.GET_VARIANT),new r({function:a.PROCESS,action:t.DEFAULT})).then(o._bindVariantData.bind(o)).catch(o.errorHandler.bind(o)).finally(l.setProperty.bind(l,"/busy",false))}catch(e){o.errorHandler(e);l.setProperty("/busy",false)}},_validateFormData:function e(){var t=this;if(!t._aVariantItems.length){throw new Error(t.getMessageTextPool("K058"))}},_showSaveVariantDialog:function e(){var t=this;var a=this;a._oSaveVariantDialog=new c({busyIndicatorDelay:0,stretch:"{device>/system/phone}",title:"{main>/textPool/K086}",type:"Message",content:[new d({labelFor:a.createId("variantNameInput"),required:true,text:"{main>/textPool/K347}",width:"100%"}),new u(a.createId("variantNameInput"),{width:"100%",placeholder:"{main>/textPool/K347}",required:true,maxLength:50}),new d({labelFor:a.createId("defaultVariantCheckbox"),text:"{main>/textPool/K100}",width:"100%"}),new s(a.createId("defaultVariantCheckbox"),{useEntireWidth:true,width:"100%"})],beginButton:new l({text:"{main>/textPool/K065}",press:[function(){return b.onSaveVariantHandler.call(a,{nameVariant:a.byId("variantNameInput").getValue().trim(),defaultVariant:t.byId("defaultVariantCheckbox").getSelected()?"X":""})},a]}),endButton:new l({text:"{main>/textPool/K067}"})});a.getView().addDependent(a._oSaveVariantDialog);a._oSaveVariantDialog.attachAfterClose(a._oSaveVariantDialog.destroy.bind(a._oSaveVariantDialog));a._oSaveVariantDialog.getEndButton().attachPress(a._oSaveVariantDialog.close.bind(a._oSaveVariantDialog));a._oSaveVariantDialog.addStyleClass(a.getOwnerComponent().getContentDensityClass());a._oSaveVariantDialog.open()},_createPostRequest:function e(a){var n=a.defaultVariant,i=a.nameVariant;var o=this;return new r({defaultVariant:n,nameVariant:i,action:t.POST,function:o._sVariantFunction,variants:o._aVariantItems.map(function(e){return _objectSpread(_objectSpread({},e),{},{ZVARIANT:i})})})},_showVariantDialog:function e(t){var a=this;var r=t.data;var n=new h(_objectSpread(_objectSpread({},r),{},{properties:{}}));if(!this._oVariantSearchHelpDialogFragment){f.load({id:this.getView().getId(),name:"com.innova.sitrack.view.variant.VariantSearchHelp",controller:this}).then(function(e){a.getView().addDependent(e);e.addStyleClass(a.getOwnerComponent().getContentDensityClass());e.setModel(n);a._oVariantSearchHelpDialogFragment=e;e.open()})}else{this._oVariantSearchHelpDialogFragment.destroyItems();this._oVariantSearchHelpDialogFragment.setModel(n);this._oVariantSearchHelpDialogFragment.open()}}};return b});