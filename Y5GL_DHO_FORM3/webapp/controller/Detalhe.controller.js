sap.ui.define(["Y5GL_DHO_FORM3/Y5GL_DHO_FORM3/controller/BaseController","sap/ui/model/Filter"],function(e,t){"use strict";return e.extend("Y5GL_DHO_FORM3.Y5GL_DHO_FORM3.controller.Detalhe",{onInit:function(){this.getRouter().getRoute("Detalhe").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){this.getView().getModel().refresh(true);var t=e.getParameter("arguments").Infty;var r=e.getParameter("arguments").Subty;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_GLHR_FORMULARIOS_SUBTIPOSSet",{Infty:t,Subty:r});this._bindView("/"+e)}.bind(this))},_bindView:function(e){this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){},dataReceived:function(){}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}},onmodelListContextChange:function(e){var t=this.getView().byId("ComboBukrs").getSelectedKey();var r=this.getView().byId("Infotipo").getValue();var a=this.getView().byId("Subtipo").getValue();var i=this.getView().byId("ComboArea").getSelectedKey();if(r!==""||a!==""){var o=new sap.ui.model.Filter("Bukrs",sap.ui.model.FilterOperator.EQ,t);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var s=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,r);var l=new sap.ui.model.Filter("Area",sap.ui.model.FilterOperator.EQ,i);var d=this.getView().byId("UploadCollection");d.getBinding("items").filter([o,s,n,l])}},onBeforeUploadStarts:function(e){var t=this.getView().byId("ComboBukrs").getSelectedKey();var r=this.getView().byId("Infotipo").getValue();var a=this.getView().byId("Subtipo").getValue();var i=this.getView().byId("ComboArea").getSelectedKey();if(r!==""&&a!==""){var o=t+"$"+r+"$"+a+"$"+i+"$"+e.getParameter("fileName");var n=new sap.m.UploadCollectionParameter({name:"slug",value:encodeURIComponent(o)});e.getParameters().addHeaderParameter(n)}else{sap.m.MessageBox.error("No se pudo cargar el archivo.")}},onuploadComplete:function(e){var t=this.getView().byId("ComboBukrs").getSelectedKey();var r=this.getView().byId("Infotipo").getValue();var a=this.getView().byId("Subtipo").getValue();var i=this.getView().byId("ComboArea").getSelectedKey();if(r!==""&&a!==""){var o=new sap.ui.model.Filter("Bukrs",sap.ui.model.FilterOperator.EQ,t);var n=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,r);var s=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var l=new sap.ui.model.Filter("Area",sap.ui.model.FilterOperator.EQ,i);var d=this.getView().byId("UploadCollection");d.getBinding("items").filter([o,n,s,l])}sap.m.MessageBox.success("Su formulario se ha adjuntado correctamente.")},onChange:function(e){var t=this.getView().byId("ComboBukrs").getSelectedKey();if(t===""){sap.m.MessageBox.error("Informar a la empresa antes de cargar el archivo.");return}var r=this.getView().byId("ComboArea").getSelectedKey();if(r===""){sap.m.MessageBox.error("Informar al Ã¡rea de RH antes de cargar el archivo.");return}var a=e.getSource();var i=this.getView().getModel();i.refreshSecurityToken();var o=i.oHeaders;var n=o["x-csrf-token"];var s=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:n});a.addHeaderParameter(s)},onChangeBukrs:function(){var e=this.getView().byId("ComboBukrs").getSelectedKey();if(e!==""){this.getView().byId("ComboArea").setEditable(true)}var t=this.getView().byId("ComboArea").getBinding("items");var r=new sap.ui.model.Filter("Bukrs",sap.ui.model.FilterOperator.EQ,e);t.filter([r])},onchangeArea:function(){var e=this.getView().byId("ComboArea").getSelectedKey();var t=this.getView().byId("ComboBukrs").getSelectedKey();var r=this.getView().byId("Infotipo").getValue();var a=this.getView().byId("Subtipo").getValue();if(e!==""){var i=this.getView().byId("UploadCollection").getBinding("items");var o=new sap.ui.model.Filter("Bukrs",sap.ui.model.FilterOperator.EQ,t);var n=new sap.ui.model.Filter("Area",sap.ui.model.FilterOperator.EQ,e);var s=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,r);var l=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);i.filter([o,n,s,l])}},onDeleteSelectedItems:function(e){var t=this.getView().byId("UploadCollection");var r=this.getView().getModel();var a=this.getView().byId("ComboArea").getSelectedKey();var i=this.getView().byId("ComboBukrs").getSelectedKey();var o=this.getView().byId("Infotipo").getValue();var n=this.getView().byId("Subtipo").getValue();var s=e.getParameters().item.getProperty("documentId");var l={};var d;d="/ZET_GLHR_DHO_UPLOADSet(Area='"+a+"',Bukrs='"+i+"',Infty='"+o+"',Subty='"+n+"',DocId="+s+")";l.Autor="D";r.update(d,l,{success:function(e,r){sap.m.MessageBox.success("Archivo eliminado correctamente.",{actions:["OK"],onClose:function(e){t.getBinding("items").refresh(true)}})},error:function(e){}})},FormatFalse:function(){return false}})});