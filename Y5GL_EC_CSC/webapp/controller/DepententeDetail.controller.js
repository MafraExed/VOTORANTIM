sap.ui.define(["Y5GL_EC_CSC/Y5GL_EC_CSC/controller/BaseController","sap/ui/Device","Y5GL_EC_CSC/Y5GL_EC_CSC/model/formatter","sap/m/Button","sap/m/Dialog","sap/m/Text","sap/ui/model/json/JSONModel"],function(e,t,i,a,s,r,d){"use strict";var o;var n;var l;var g;var I;var u;var b;return e.extend("Y5GL_EC_CSC.Y5GL_EC_CSC.controller.DepententeDetail",{formatter:i,onInit:function(){this.getRouter().getRoute("DepententeDetail").attachPatternMatched(this._onObjectMatched,this);this.getRouter().getRoute("DependentesAdd").attachPatternMatched(this._onAdd,this);var e=jQuery.sap.getModulePath("Y5GL_EC_CSC.Y5GL_EC_CSC");var t=e+"/imagens/Transparente_CBA.gif";this.getView().byId("idimg").setSrc(t)},onVoltar:function(){var e=!t.system.phone;var i="object";this.getRouter().navTo(i,{Zdesc:"DEPENDENTES"},e)},formatVisibleEdit:function(e){if(e==="Em ResoluÃ§Ã£o"){return false}else{return true}},formatVisibleUpload:function(e){if(e==="Em ResoluÃ§Ã£o"||e===""){return true}else{return false}},_onAdd:function(e){var t=e.getParameter("arguments").Pernr;var i=e.getParameter("arguments").Subty;var a="N";var s=e.getParameter("arguments").Objps;var r=e.getParameter("arguments").Favor;var d;this.getView().byId("IdParentesco").setEditable(true);this.getView().byId("IdFavor").setEditable(true);this.getView().byId("IdFanam").setEditable(true);this.getView().byId("IdFgbdt").setEditable(true);this.getView().byId("IdSexo").setEditable(true);this.getView().byId("IdZzestciv").setEditable(true);this.getView().byId("IdIR").setEditable(true);this.getView().byId("idCpf").setEditable(true);this.getView().byId("IdSalvarDetailDep").setVisible(true);this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().byId("IdParentesco").setValueState("None");this.getView().byId("IdFavor").setValueState("None");this.getView().byId("IdFanam").setValueState("None");this.getView().byId("IdFgbdt").setValueState("None");this.getView().byId("IdFgbdt").setValueState("None");this.getView().byId("IdSexo").setValueState("None");this.getView().byId("IdZzestciv").setValueState("None");this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){d=this.getModel().createKey("ZET_GLRH_DEPENDENTESSet",{Pernr:t,Subty:i,Objps:s,Tipo:a,Favor:r});this._bindView("/"+d)}.bind(this))},onEdit:function(){o=this.getView().byId("IdParentesco").getSelectedKey();n=this.getView().byId("IdFavor").getValue();l=this.getView().byId("IdFanam").getValue();g=this.getView().byId("IdFgbdt").getValue();I=this.getView().byId("IdSexo").getValue();u=this.getView().byId("IdZzestciv").getSelectedKey();b=this.getView().byId("IdIR").getSelectedKey();this.getView().byId("UploadCollection").setUploadButtonInvisible(true);this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("IdSalvarDetailDep").setVisible(true);this.getView().byId("IdCancelarDetailDep").setVisible(true);this.getView().byId("IdParentesco").setEditable(true);this.getView().byId("IdFavor").setEditable(true);this.getView().byId("IdFanam").setEditable(true);this.getView().byId("IdFgbdt").setEditable(true);this.getView().byId("IdSexo").setEditable(true);this.getView().byId("IdZzestciv").setEditable(true);this.getView().byId("IdIR").setEditable(true);this.getView().byId("idCpf").setEditable(true)},onCancel:function(){this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().byId("IdEditDetailDep").setVisible(true);this.getView().byId("IdSalvarDetailDep").setVisible(false);this.getView().byId("UploadCollection").setUploadButtonInvisible(true);this.getView().byId("IdParentesco").setEditable(false);this.getView().byId("IdFavor").setEditable(false);this.getView().byId("IdFanam").setEditable(false);this.getView().byId("IdFgbdt").setEditable(false);this.getView().byId("IdSexo").setEditable(false);this.getView().byId("IdZzestciv").setEditable(false);this.getView().byId("IdIR").setEditable(false);this.getView().byId("idCpf").setEditable(false);this.getView().byId("IdParentesco").setSelectedKey(o);this.getView().byId("IdFavor").setValue(n);this.getView().byId("IdFanam").setValue(l);this.getView().byId("IdFgbdt").setValue(g);this.getView().byId("IdSexo").setValue(I);this.getView().byId("IdZzestciv").setSelectedKey(u);this.getView().byId("IdIR").setValue(b)},onchangeParentesco:function(){},_onObjectMatched:function(e){var t=e.getParameter("arguments").Pernr;var i=e.getParameter("arguments").Subty;var a="V";var s="0";var r=e.getParameter("arguments").Favor;var d="X";this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_GLRH_DEPENDENTESSet",{Pernr:t,Subty:i,Objps:s,Tipo:a,Favor:r,Icnum:d});this._bindView("/"+e)}.bind(this));this.getView().byId("IdParentesco").setEditable(false);this.getView().byId("IdFavor").setEditable(false);this.getView().byId("IdFanam").setEditable(false);this.getView().byId("IdFgbdt").setEditable(false);this.getView().byId("IdSexo").setEditable(false);this.getView().byId("IdZzestciv").setEditable(false);this.getView().byId("IdIR").setEditable(false);this.getView().byId("idCpf").setEditable(false)},_bindView:function(e){var t=this;t.loading(false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.loading(true)},dataReceived:function(){t.loading(false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}},onExcluir:function(){var e=this;var t=this.getView().getModel();var i=this.getView().byId("IdPernr").getValue();var d=this.getView().byId("IdParentesco").getSelectedKey();var o=this.getView().byId("IdObjps").getValue();var n=this.getView().byId("IdFavor").getValue();var l="/ZET_GLRH_DEPENDENTESSet(Pernr='"+i+"',Subty='"+d+"',Objps='"+o+"',Favor='"+n+"',Tipo='G')";var g={};g.Tipo="E";var I=new s({title:"Confirmação",type:"Message",content:new r({text:"Confirma a exclusão ?"}),beginButton:new a({text:"Sim",press:function(){t.update(l,g,{success:function(t,i){sap.m.MessageBox.success("Dependente excluido com sucesso.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(t){e.getRouter().navTo("DEPENDENTES")}})},error:function(e){sap.m.MessageBox.error("Erro ao chamar o serviço")}});I.close()}}),endButton:new a({text:"Não",press:function(){I.close()}}),afterClose:function(){I.destroy()}});I.open()},onChange:function(e){var t=e.getSource();var i=this.getView().getModel();i.refreshSecurityToken();var a=i.oHeaders;var s=a["x-csrf-token"];var r=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:s});t.addHeaderParameter(r)},onBeforeUploadStarts:function(e){var t="0";var i="0021";var a=this.getView().byId("IdParentesco").getSelectedKey();var s="0";var r=this.getView().byId("IdParentesco").getSelectedKey();var d=this.getView().byId("IdFavor").getValue();if(r===""){sap.m.MessageBox.error("Selecione o Grau de Parentesco.");return}if(t!==""&&a!==""&&s!==""){var o=t+"$"+i+"$"+a+"$"+s+"$"+e.getParameter("fileName")+"$"+d;var n=new sap.m.UploadCollectionParameter({name:"slug",value:o});e.getParameters().addHeaderParameter(n)}else{sap.m.MessageBox.error("Não foi possivel fazer upload do arquivo.")}},onuploadComplete:function(e){this.getView().byId("IdParentesco").setEditable(false);var t="0";var i="0021";var a=this.getView().byId("IdParentesco").getSelectedKey();var s="U";var r=this.getView().byId("IdFavor").getValue();if(t!==""&&a!==""){var d=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,t);var o=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,i);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var l=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,s);var g=new sap.ui.model.Filter("Favor",sap.ui.model.FilterOperator.EQ,r);var I=this.getView().byId("UploadCollection");I.getBinding("items").filter([d,o,n,l,g])}},onmodelListContextChange:function(e){var t="0";var i="0021";var a=this.getView().byId("IdParentesco").getSelectedKey();var s="U";var r=this.getView().byId("IdFavor").getValue();if(t!==""&&a!==""){var d=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,t);var o=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,i);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var l=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,s);var g=new sap.ui.model.Filter("Favor",sap.ui.model.FilterOperator.EQ,r);var I=this.getView().byId("UploadCollection");I.getBinding("items").filter([d,o,n,l,g])}},onSave:function(){var e=this;var t=this.getView().getModel();var i=this.getView().byId("IdPernr").getValue();var d=this.getView().byId("IdParentesco").getSelectedKey();var o=this.getView().byId("IdObjps").getValue();var n=this.getView().byId("IdFavor").getValue();var l="/ZET_GLRH_DEPENDENTESSet(Pernr='"+i+"',Subty='"+d+"',Objps='"+o+"',Favor='"+n+"',Tipo='G')";var g={};g.Parentesco=this.getView().byId("IdParentesco").getSelectedKey();if(g.Parentesco===""){this.getView().byId("IdParentesco").setValueState("Error");sap.m.MessageBox.error("Selecione o Grau de Parentesco.");return}else{this.getView().byId("IdParentesco").setValueState("Success")}g.Favor=this.getView().byId("IdFavor").getValue();if(g.Favor===""){this.getView().byId("IdFavor").setValueState("Error");sap.m.MessageBox.error("Preencher o Nome.");return}else{this.getView().byId("IdFavor").setValueState("Success")}g.Fanam=this.getView().byId("IdFanam").getValue();if(g.Fanam===""){this.getView().byId("IdFanam").setValueState("Error");sap.m.MessageBox.error("Preencher o sobrenome.");return}else{this.getView().byId("IdFanam").setValueState("Success")}g.Fgbdt=this.getView().byId("IdFgbdt").getValue();if(g.Fgbdt===""){this.getView().byId("IdFgbdt").setValueState("Error");sap.m.MessageBox.error("Selecione data de nascimento.");return}else{this.getView().byId("IdFgbdt").setValueState("Success")}g.Sexo=this.getView().byId("IdSexo").getSelectedKey();if(g.Sexo===" "){this.getView().byId("IdSexo").setValueState("Error");sap.m.MessageBox.error("Selecione o sexo.");return}else{this.getView().byId("IdSexo").setValueState("Success")}g.Zzestciv=this.getView().byId("IdZzestciv").getSelectedKey();if(g.Zzestciv===" "){this.getView().byId("IdZzestciv").setValueState("Error");sap.m.MessageBox.error("Selecione o Estado Civil.");return}else{this.getView().byId("IdZzestciv").setValueState("Success")}g.Irflg=this.getView().byId("IdIR").getSelectedKey();if(g.Irflg===" "){this.getView().byId("IdIR").setValueState("Error");sap.m.MessageBox.error("Selecione se é dependente de IR.");return}else{if(g.Irflg==="S"){g.Irflg="X"}else{g.Irflg=""}this.getView().byId("IdIR").setValueState("Success")}g.Icnum=this.getView().byId("idCpf").getSelectedKey();if(g.Irflg===" "){this.getView().byId("idCpf").setValueState("Error");sap.m.MessageBox.error("Informe o CPF.");return}else{this.getView().byId("idCpf").setValueState("Success")}var I=new s({title:"Confirmação",type:"Message",content:new r({text:"Confirma a inclusão/alteração do dependente?"}),beginButton:new a({text:"Sim",press:function(){t.update(l,g,{success:function(t,i){sap.m.MessageBox.success("Dependente salvo com sucesso.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(t){e.getView().getModel().refresh(true);e.getRouter().navTo("DEPENDENTES")}})},error:function(e){var t=e;t=t.responseText;var i=JSON.parse(t);var a=i.error.message.value;sap.m.MessageBox.error(a);return}});I.close()}}),endButton:new a({text:"Não",press:function(){I.close()}}),afterClose:function(){I.destroy()}});I.open()},onBackMaster:function(){this.getRouter().navTo("master")},onDeleteSelectedItems:function(e){sap.m.MessageBox.error("Não será possivel exclusão do anexo, deverá ser reprovado o chamado")},FormatIrflg:function(e){if(e==="X"){return"S"}else{return"N"}}})});