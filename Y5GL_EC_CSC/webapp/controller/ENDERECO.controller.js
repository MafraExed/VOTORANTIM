sap.ui.define(["Y5GL_EC_CSC/Y5GL_EC_CSC/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/Dialog","sap/m/Button","sap/m/Text"],function(e,t,a,r,i){"use strict";return e.extend("Y5GL_EC_CSC.Y5GL_EC_CSC.controller.ENDERECO",{onInit:function(){this.getRouter().getRoute("ENDERECO").attachPatternMatched(this._onObjectMatched,this);var e=sap.ushell.Container.getUser().getFullName();this.getView().byId("idTitleDep").setText(e);var t=jQuery.sap.getModulePath("Y5GL_EC_CSC.Y5GL_EC_CSC");var a=t+"/imagens/Transparente_CBA.gif";this.getView().byId("idimg").setSrc(a)},formatVisibleEdit:function(e){if(e==="Em ResoluÃ§Ã£o"){return false}else{return true}},onChangeCEP:function(){var e=this.getView().byId("IdCEP").getValue();var t="https://viacep.com.br/ws/"+e+"/json/?callback=callback_name";var a;var r=this;$.ajax({url:t,dataType:"jsonp",success:function(e){a=e;r.BuscaEndereco(a)},error:function(){}})},BuscaEndereco:function(e){var t=e.logradouro;var a=e.bairro;var r=e.localidade;var i=e.uf;var o=e.ibge;var s=e.cep;this.getView().byId("IdRua").setValue(t);this.getView().byId("IdBairro").setValue(a);this.getView().byId("IdCidade").setValue(r);this.getView().byId("IdUF").setValue(i);this.getView().byId("IdCodMunicipio").setValue(o);this.getView().byId("IdCEP").setValue(s)},FormatEditable:function(e){if(e!==""||e===undefined){return false}else{return true}},_onObjectMatched:function(){var e="V";var t="0";var a="0";this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var r=this.getModel().createKey("ZET_GLHR_CAD_ENDERECOSet",{ITipo:e,Pernr:t,Subty:a});this._bindView("/"+r)}.bind(this))},onBackMaster:function(){this.getRouter().navTo("master")},_bindView:function(e){var t=this;var a=this.getView().getModel();a.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.loading(true)},dataReceived:function(){t.loading(false)}}})},FormatButtom1:function(e){if(e!==""||e===undefined){return false}else{return true}},FormatButtom2:function(e){if(e!==""||e===undefined){return true}else{return false}},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");return}},onCancela:function(){this.getView().getModel().refresh(true)},onEdit:function(){this.getView().byId("IdCEP").setEditable(true);this.getView().byId("IdNumero").setEditable(true);this.getView().byId("IdComplemento").setEditable(true);this.getView().byId("IdTipo_End").setEditable(true);this.getView().byId("IdSalvarDetailDep").setVisible(true);this.getView().byId("IdCancelaAprov").setVisible(true);this.getView().byId("IdEditDetailDep").setVisible(false)},onChange:function(e){var t=e.getSource();var a=this.getView().getModel();a.refreshSecurityToken();var r=a.oHeaders;var i=r["x-csrf-token"];var o=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:i});t.addHeaderParameter(o)},onBeforeUploadStarts:function(e){var t="0";var a="0006";var r=this.getView().byId("IdTipoEnd").getSelectedKey();var i="0";if(t!==""||r!==""||i!==""){var o=t+"$"+a+"$"+r+"$"+i+"$"+e.getParameter("fileName");var s=new sap.m.UploadCollectionParameter({name:"slug",value:o});e.getParameters().addHeaderParameter(s)}},onuploadComplete:function(e){var t="0";var a="0006";var r=this.getView().byId("IdTipoEnd").getSelectedKey();var i="U";if(t!==""||r!==""){var o=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,a);var s=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,r);var n=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,i);var d=this.getView().byId("UploadCollection");d.getBinding("items").filter([o,s,n])}},onmodelListContextChange:function(e){var t="0";var a="0006";var r=this.getView().byId("IdTipoEnd").getSelectedKey();var i="U";if(t!==""||r!==""){var o=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,t);var s=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,a);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,r);var d=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,i);var u=this.getView().byId("UploadCollection");u.getBinding("items").filter([o,s,n,d])}},onSave:function(){var e=this.getView().byId("IdTipoEnd").getSelectedKey();var t=this.getView().byId("IdCEP").getValue();var o=this.getView().byId("IdRua").getValue();var s=this.getView().byId("IdNumero").getValue();var n=this.getView().byId("IdComplemento").getValue();var d=this.getView().byId("IdBairro").getValue();var u=this.getView().byId("IdCidade").getValue();var l=this.getView().byId("IdUF").getValue();var g=this.getView().byId("IdCodMunicipio").getValue();var c=this.getView().byId("IdTipo_End").getSelectedKey();var p;var v;var m=this;var I=this.getView().getModel();var f;var h={};var V;var b;h.Subty=e;if(h.Subty===""){this.getView().byId("IdTipoEnd").setValueState("Error");sap.m.MessageBox.error("Informe o tipo de endereço");return}else{this.getView().byId("IdTipoEnd").setValueState("Success")}h.Cep=t;if(h.Cep===""){this.getView().byId("IdCEP").setValueState("Error");sap.m.MessageBox.error("Informe o CEP");return}else{this.getView().byId("IdCEP").setValueState("Success")}h.Rua=o;h.Numero=s;if(h.Numero===""){this.getView().byId("IdNumero").setValueState("Error");sap.m.MessageBox.error("Informe o numero do endereço");return}else{this.getView().byId("IdNumero").setValueState("Success")}h.Zztpend=c;if(h.Zztpend===""){this.getView().byId("IdTipo_End").setValueState("Error");sap.m.MessageBox.error("Informe o tipo de endereço");return}else{this.getView().byId("IdTipo_End").setValueState("Success")}h.Complemento=n;h.Bairro=d;h.Cidade=u;h.Uf=l;h.Ibge=g;f="/ZET_GLHR_CAD_ENDERECOSet(ITipo='A',Pernr='0',Subty='"+e+"')";p=new a({title:"Confirmação",type:"Message",content:new i({text:"Confirma a gravação de endereço?"}),beginButton:new r({text:"Sim",press:function(){I.update(f,h,{success:function(e,t){sap.m.MessageBox.success("Endereço gravado com sucesso!",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){m.getView().getModel().refresh(true)}})},error:function(e){var t=e;t=t.responseText;var a=JSON.parse(t);var r=a.error.message.value;sap.m.MessageBox.error(r,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){}});return}});p.close()}}),endButton:new r({text:"Não",press:function(){p.close()}}),afterClose:function(){p.destroy()}});p.open()},onDeleteSelectedItems:function(e){var t="0";var o="0006";var s=this.getView().byId("IdTipoEnd").getSelectedKey();var n=this.getView().getModel();var d="0";var u="0";var o=o;var l="0";var t="0";var g="E";var s=s;var c=e.getParameters("listItem");var p=c.documentId;p=parseInt(p);var v=this.getView().byId("idTipo").getValue();if(v==="Em ResoluÃ§Ã£o"){sap.m.MessageBox.error("Não será possivel exclusão do anexo, quando o chamado ja existir.");return}var m="/ZET_GLRH_UPLOADSet(Ano='"+d+"',Favor='"+u+"',Infty='"+o+"',Mes='"+l+"',Pernr='"+t+"',Tipo='"+g+"',Subty='"+s+"',DocId="+p+",Objps='',Icnum='')";var I={};I.DocId=1;var f=new a({title:"Confirmação",type:"Message",content:new i({text:"Confirma a exclusão anexo?"}),beginButton:new r({text:"Sim",press:function(){n.update(m,I,{success:function(e,t){sap.m.MessageBox.success("Documentos excluido com suceso.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){}})},error:function(e){var t=e;t=t.responseText;var a=JSON.parse(t);var r=a.error.message.value;sap.m.MessageBox.error(r,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){}});return}});f.close()}}),endButton:new r({text:"Não",press:function(){f.close()}}),afterClose:function(){f.destroy()}});f.open()}})});