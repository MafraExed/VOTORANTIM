sap.ui.define(["Y5GL_EC_CSC/Y5GL_EC_CSC/controller/BaseController","sap/ui/Device","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/ui/model/Filter"],function(e,t,a,o,r,s){"use strict";return e.extend("Y5GL_EC_CSC.Y5GL_EC_CSC.controller.DADOS_PESSOAIS",{onInit:function(){this.getRouter().getRoute("DADOS_PESSOAIS").attachPatternMatched(this._onObjectMatched,this);var e=sap.ushell.Container.getUser().getFullName();this.getView().byId("idTitleDep").setText(e);var t=jQuery.sap.getModulePath("Y5GL_EC_CSC.Y5GL_EC_CSC");var a=t+"/imagens/Transparente_CBA.gif";this.getView().byId("idimg").setSrc(a)},_onObjectMatched:function(e){var t=e.getParameter("arguments").Pernr;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_MEUS_DADOS_ECSet",{Pernr:t,Tipo:"V"});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getView().getModel();var a=this;t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){a.loading(true)},dataReceived:function(){a.loading(false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");return}},onBackMaster:function(){this.getRouter().navTo("master")},onReprovar:function(){var e=this.getView();var t=e.byId("IdNomeCompleto").getValue();var s=e.byId("IdDataNascimento").getValue();var i=e.byId("IdSexo").getSelectedKey();var n=e.byId("IdNacionaliade").getSelectedKey();var d=e.byId("IdLocNascimento").getValue();var l=e.byId("IdEstNasc").getSelectedKey();var u=e.byId("IdPaisNasc").getSelectedKey();var I=e.byId("IdAposentado").getSelectedKey();var c=e.byId("IdRaca").getSelectedKey();var m=e.byId("IdCasadoDesde").getValue();var g=e.byId("IdEstCivil").getSelectedKey();var p=e.byId("IdIdioma").getSelectedKey();var f=e.byId("IdCodNat").getValue();var v;var b=this.getView().getModel();var y=this;var S;var V;var C;var E;var N={};if(t===""||t===undefined){e.byId("IdNomeCompleto").setValueState("Error");sap.m.MessageBox.error("Informe o nome completo.");return}else{e.byId("IdNomeCompleto").setValueState("None");N.Nome=t}if(s===""||s===undefined){e.byId("IdDataNascimento").setValueState("Error");sap.m.MessageBox.error("Informe a data de nascimento.");return}else{e.byId("IdDataNascimento").setValueState("None");s=s.substring(0,4)+s.substring(5,7)+s.substring(8,10);N.DtNasc=s}if(i===""||i===undefined){e.byId("IdSexo").setValueState("Error");sap.m.MessageBox.error("Informe o sexo.");return}else{e.byId("IdSexo").setValueState("None");N.Sexo=i}if(n===""||n===undefined){e.byId("IdNacionaliade").setValueState("Error");sap.m.MessageBox.error("Informe a nacionalidade.");return}else{e.byId("IdNacionaliade").setValueState("None");N.Nacionalidade=n}if(d===""||d===undefined){e.byId("IdLocalNascimento").setValueState("Error");sap.m.MessageBox.error("Informe a local de nascimento.");return}else{e.byId("IdLocNascimento").setValueState("None");N.Municipio=d}if(f===""||f===undefined){e.byId("IdCodNat").setValueState("Error");sap.m.MessageBox.error("Informe a local de nascimento.");return}else{e.byId("IdCodNat").setValueState("None");N.CodNaturalidade=f}if(l===""||l===undefined){e.byId("IdEstNasc").setValueState("Error");sap.m.MessageBox.error("Informe o estado de nascimento.");return}else{e.byId("IdEstNasc").setValueState("None");N.Estado=l}if(u===""||u===undefined){e.byId("IdPaisNasc").setValueState("Error");sap.m.MessageBox.error("Informe o pais de nascimento.");return}else{e.byId("IdPaisNasc").setValueState("None");N.Pais=u}if(p===""||p===undefined){e.byId("IdIdioma").setValueState("Error");sap.m.MessageBox.error("Informe o idioma.");return}else{e.byId("IdIdioma").setValueState("None");N.Idioma=p}if(g===""||g===undefined){e.byId("IdEstCivil").setValueState("Error");sap.m.MessageBox.error("Informe o estado civil.");return}else{e.byId("IdEstCivil").setValueState("None");N.EstadoCivil=g}if(m===""||m===undefined){if(g!=="1"){e.byId("IdCasadoDesde").setValueState("Error");sap.m.MessageBox.error("Informe o estado civil desde.");return}e.byId("IdCasadoDesde").setValueState("None")}else{e.byId("IdCasadoDesde").setValueState("None");m=m.substring(0,4)+m.substring(5,7)+m.substring(8,10);N.DtCasamento=m}if(c===""||c===undefined){e.byId("IdRaca").setValueState("Error");sap.m.MessageBox.error("Informe a raca.");return}else{e.byId("IdRaca").setValueState("None");N.Raca=c}if(I===""||I===undefined){e.byId("IdAposentado").setValueState("Error");sap.m.MessageBox.error("Informe se aposentado.");return}else{e.byId("IdAposentado").setValueState("None");N.Aposentado=I}N.Tipo="X";E="/ZET_MEUS_DADOS_ECSet(Pernr='0',Tipo='R')";v=new a({title:"Confirmação",type:"Message",content:new r({text:"Confirma a alteração de dados pessoais?"}),beginButton:new o({text:"Sim",press:function(){b.update(E,N,{success:function(e,t){sap.m.MessageBox.success("Dados gravados.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){y.getView().getModel().refresh(true);y.onCancel()}})},error:function(e){S=e;S=S.responseText;V=JSON.parse(S);C=V.error.message.value;sap.m.MessageBox.error(C,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){}});return}});v.close()}}),endButton:new o({text:"Não",press:function(){v.close()}}),afterClose:function(){v.destroy()}});v.open()},onAprovar:function(){var e=this.getView();var t=e.byId("IdNomeCompleto").getValue();var s=e.byId("IdDataNascimento").getValue();var i=e.byId("IdSexo").getSelectedKey();var n=e.byId("IdNacionaliade").getSelectedKey();var d=e.byId("IdLocNascimento").getValue();var l=e.byId("IdEstNasc").getSelectedKey();var u=e.byId("IdPaisNasc").getSelectedKey();var I=e.byId("IdAposentado").getSelectedKey();var c=e.byId("IdRaca").getSelectedKey();var m=e.byId("IdCasadoDesde").getValue();var g=e.byId("IdEstCivil").getSelectedKey();var p=e.byId("IdIdioma").getSelectedKey();var f=e.byId("IdCodNat").getValue();var v;var b=this.getView().getModel();var y=this;var S;var V;var C;var E;var N={};if(t===""||t===undefined){e.byId("IdNomeCompleto").setValueState("Error");sap.m.MessageBox.error("Informe o nome completo.");return}else{e.byId("IdNomeCompleto").setValueState("None");N.Nome=t}if(s===""||s===undefined){e.byId("IdDataNascimento").setValueState("Error");sap.m.MessageBox.error("Informe a data de nascimento.");return}else{e.byId("IdDataNascimento").setValueState("None");s=s.substring(0,4)+s.substring(5,7)+s.substring(8,10);N.DtNasc=s}if(i===""||i===undefined){e.byId("IdSexo").setValueState("Error");sap.m.MessageBox.error("Informe o sexo.");return}else{e.byId("IdSexo").setValueState("None");N.Sexo=i}if(n===""||n===undefined){e.byId("IdNacionaliade").setValueState("Error");sap.m.MessageBox.error("Informe a nacionalidade.");return}else{e.byId("IdNacionaliade").setValueState("None");N.Nacionalidade=n}if(d===""||d===undefined){e.byId("IdLocalNascimento").setValueState("Error");sap.m.MessageBox.error("Informe a local de nascimento.");return}else{e.byId("IdLocNascimento").setValueState("None");N.Municipio=d}if(f===""||f===undefined){e.byId("IdCodNat").setValueState("Error");sap.m.MessageBox.error("Informe a local de nascimento.");return}else{e.byId("IdCodNat").setValueState("None");N.CodNaturalidade=f}if(l===""||l===undefined){e.byId("IdEstNasc").setValueState("Error");sap.m.MessageBox.error("Informe o estado de nascimento.");return}else{e.byId("IdEstNasc").setValueState("None");N.Estado=l}if(u===""||u===undefined){e.byId("IdPaisNasc").setValueState("Error");sap.m.MessageBox.error("Informe o pais de nascimento.");return}else{e.byId("IdPaisNasc").setValueState("None");N.Pais=u}if(p===""||p===undefined){e.byId("IdIdioma").setValueState("Error");sap.m.MessageBox.error("Informe o idioma.");return}else{e.byId("IdIdioma").setValueState("None");N.Idioma=p}if(g===""||g===undefined){e.byId("IdEstCivil").setValueState("Error");sap.m.MessageBox.error("Informe o estado civil.");return}else{e.byId("IdEstCivil").setValueState("None");N.EstadoCivil=g}if(m===""||m===undefined){if(g!=="1"){e.byId("IdCasadoDesde").setValueState("Error");sap.m.MessageBox.error("Informe o estado civil desde.");return}e.byId("IdCasadoDesde").setValueState("None")}else{e.byId("IdCasadoDesde").setValueState("None");m=m.substring(0,4)+m.substring(5,7)+m.substring(8,10);N.DtCasamento=m}if(c===""||c===undefined){e.byId("IdRaca").setValueState("Error");sap.m.MessageBox.error("Informe a raca.");return}else{e.byId("IdRaca").setValueState("None");N.Raca=c}if(I===""||I===undefined){e.byId("IdAposentado").setValueState("Error");sap.m.MessageBox.error("Informe se aposentado.");return}else{e.byId("IdAposentado").setValueState("None");N.Aposentado=I}N.Tipo="X";E="/ZET_MEUS_DADOS_ECSet(Pernr='0',Tipo='A')";v=new a({title:"Confirmação",type:"Message",content:new r({text:"Confirma a alteração de dados pessoais?"}),beginButton:new o({text:"Sim",press:function(){b.update(E,N,{success:function(e,t){sap.m.MessageBox.success("Dados gravados.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){y.getView().getModel().refresh(true);y.onCancel()}})},error:function(e){S=e;S=S.responseText;V=JSON.parse(S);C=V.error.message.value;sap.m.MessageBox.error(C,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){}});return}});v.close()}}),endButton:new o({text:"Não",press:function(){v.close()}}),afterClose:function(){v.destroy()}});v.open()},handleValueHelp:function(e){var t=e.getSource().getValue();this.inputId=e.getSource().getId();if(!this._valueHelpDialog1){this._valueHelpDialog1=sap.ui.xmlfragment("Y5GL_EC_CSC.Y5GL_EC_CSC.view.LocNascimento",this);this.getView().addDependent(this._valueHelpDialog1)}this._valueHelpDialog1.open(t);if(t){this._valueHelpDialog1.getBinding("items").filter([new s("IMunicipio",sap.ui.model.FilterOperator.EQ,t)])}this._valueHelpDialog1.getBinding("items").filter([new s("IUf",sap.ui.model.FilterOperator.EQ,"SP")])},onSearchMunicipio:function(e){var t=e.getParameter("value");if(t){var a=t;var o=new sap.ui.model.Filter("IMunicipio",sap.ui.model.FilterOperator.EQ,a);var r=new sap.ui.model.Filter("IUf",sap.ui.model.FilterOperator.EQ,"SP");e.getSource().getBinding("items").filter([o,r])}},onConfirmMunicipio:function(e){var t=e.getParameter("selectedItem");this._valueHelpDialog1=null;if(t){var a=t.getTitle();var o=t.getDescription();var r=o+"-"+a;this.getView().byId("IdCodNat").setValue(r);var s=this.getView().byId(this.inputId);s.setValue(a)}},onEdit:function(){this.getView().byId("Form2").setVisible(false);this.getView().byId("form1").setVisible(true);this.getView().byId("UploadCollection").setUploadButtonInvisible(false);this.getView().byId("IdEnviarDetailDep").setVisible(true);this.getView().byId("IdEditDados").setVisible(false);this.getView().byId("IdCancelarDetailDep").setVisible(true)},onCancel:function(){this.getView().byId("Form2").setVisible(true);this.getView().byId("form1").setVisible(false);this.getView().byId("UploadCollection").setUploadButtonInvisible(true);this.getView().byId("IdEnviarDetailDep").setVisible(false);this.getView().byId("IdEditDados").setVisible(true);this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().getModel().refresh(true)},onChange:function(e){var t=e.getSource();var a=this.getView().getModel();a.refreshSecurityToken();var o=a.oHeaders;var r=o["x-csrf-token"];var s=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:r});t.addHeaderParameter(s)},onBeforeUploadStarts:function(e){var t="0";var a="0002";var o="0";var r="0";if(t!==""||o!==""||r!==""){var s=t+"$"+a+"$"+o+"$"+r+"$"+e.getParameter("fileName");var i=new sap.m.UploadCollectionParameter({name:"slug",value:s});e.getParameters().addHeaderParameter(i)}},onuploadComplete:function(e){var t="0";var a="0002";var o="0";var r="U";if(t!==""||o!==""){var s=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,a);var i=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,o);var n=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,r);var d=this.getView().byId("UploadCollection");d.getBinding("items").filter([s,i,n])}},onmodelListContextChange:function(e){var t="0";var a="0002";var o="0";var r="U";if(t!==""||o!==""){var s=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,t);var i=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,a);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,o);var d=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,r);var l=this.getView().byId("UploadCollection");l.getBinding("items").filter([s,i,n,d])}},onDeleteSelectedItems:function(e){var t="0002";var s="0";var i=this.getView().getModel();var n="0";var d="0";var l=t;var u="0";var I="0";var c="E";var s=s;var m=e.getParameters("listItem");var g=m.documentId;g=parseInt(g);var p=this.getView().byId("idTipo").getValue();if(p==="Em ResoluÃ§Ã£o"){sap.m.MessageBox.error("Não será possivel exclusão do anexo, quando o chamado ja existir.");return}var f="/ZET_GLRH_UPLOADSet(Ano='"+n+"',Favor='"+d+"',Infty='"+l+"',Mes='"+u+"',Pernr='"+I+"',Tipo='"+c+"',Subty='"+s+"',DocId="+g+",Objps='',Icnum='')";var v={};v.DocId=1;var b=this.getView().byId("UploadCollection");var y=new a({title:"Confirmação",type:"Message",content:new r({text:"Confirma a exclusão anexo?"}),beginButton:new o({text:"Sim",press:function(){i.update(f,v,{success:function(e,t){sap.m.MessageBox.success("Documentos excluido com suceso.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){b.getBinding("items").refresh(true)}})},error:function(e){var t=e;t=t.responseText;var a=JSON.parse(t);var o=a.error.message.value;sap.m.MessageBox.error(o,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){b.getBinding("items").refresh(true)}});return}});y.close()}}),endButton:new o({text:"Não",press:function(){y.close()}}),afterClose:function(){y.destroy()}});y.open()},formatVisibleEdit:function(e){if(e==="Em ResoluÃ§Ã£o"){return false}else{return true}}})});