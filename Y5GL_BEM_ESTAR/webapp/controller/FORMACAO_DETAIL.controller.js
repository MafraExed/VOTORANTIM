sap.ui.define(["Y5GL_BEM_ESTAR/Y5GL_BEM_ESTAR/controller/BaseController","sap/ui/Device","sap/m/Dialog","sap/m/Button","sap/m/Text"],function(e,t,i,a,r){"use strict";var s;var o;var n;return e.extend("Y5GL_BEM_ESTAR.Y5GL_BEM_ESTAR.controller.FORMACAO_DETAIL",{onInit:function(){this.getRouter().getRoute("FORMACAO_DETAIL").attachPatternMatched(this._onObjectMatched,this);var e=sap.ushell.Container.getUser().getFullName();this.getView().byId("idTitleDep").setText(e);var t=jQuery.sap.getModulePath("Y5GL_BEM_ESTAR.Y5GL_BEM_ESTAR");var i=t+"/imagens/loading.gif";this.getView().byId("idimg").setSrc(i)},formatVisibleEdit:function(e){if(e==="Em ResoluÃ§Ã£o"){return false}else{return true}},onVoltar:function(){this.getRouter().navTo("worklist")},onBackMaster:function(){this.getRouter().navTo("master")},_onObjectMatched:function(e){s="A";this.getView().byId("UploadCollection").setUploadButtonInvisible(true);o=e.getParameter("arguments").Pernr;this.getView().byId("idTitleMeuCadastro").setText("Formação Educacional - (Matrícula - "+o+")");var t=e.getParameter("arguments").Slart;n=e.getParameter("arguments").Chamado;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_GLHR_FORM_EMP_ECSet",{Pernr:o,Slart:t,Tipo:"V",Chamado:n});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getView().getModel();var i=this;i.loading(false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){i.loading(true)},dataReceived:function(){i.loading(false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");return}var i=this.getView().byId("IdDenCursoTESTE").getValue();while(i.indexOf(".")!==-1){i=i.replace(".","-")}this.getView().byId("IdDtFimForm").setValue(i);var a="0022";var r=this.getView().byId("IdEstEnsino").getSelectedKey();if(r!==""){var s=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,o);var d=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,a);var l=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,r);var u=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,"C");var g=new sap.ui.model.Filter("chamado",sap.ui.model.FilterOperator.EQ,n);var c=this.getView().byId("UploadCollection");c.getBinding("items").filter([s,d,l,u,g])}},_onDetail:function(){},onChangeIdFormacao:function(e){var t=this.getView().byId("IdFormacao").getSelectedKey();if(t==="00000000"){this.getView().byId("IdDenCurso").setEditable(true)}else{this.getView().byId("IdDenCurso").setEditable(false)}},onAdiciona:function(e){this.getView().getModel().refresh(true);s="I";this.getView().byId("UploadCollection").setUploadButtonInvisible(false);o=e.getParameter("arguments").Pernr;var t=e.getParameter("arguments").Slart;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_GLHR_FORM_EMP_ECSet",{Pernr:0,Slart:0,Tipo:"I"});this._bindView("/"+e)}.bind(this));this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("IdSalvarDetailDep").setVisible(true);this.getView().byId("IdCancelarDetailDep").setVisible(false)},formatEditable:function(e){return true},formatVisible:function(e){if(e!==""&&e!==undefined){return true}else{return false}},formatNotVisible:function(e){if(e!==""&&e!==undefined){return false}else{return true}},onEdit:function(){this.getView().byId("IdEstEnsino").setEditable(true);this.getView().byId("IdInstituicao").setEditable(true);this.getView().byId("IdPais").setEditable(true);this.getView().byId("IdCertificado").setEditable(true);this.getView().byId("IdDuracao").setEditable(true);this.getView().byId("IdTpDuracao").setEditable(true);this.getView().byId("IdDenCurso").setEditable(true);this.getView().byId("IdDtFimForm").setEditable(true);this.getView().byId("IdDenCursoTESTE").setEditable(true);this.getView().byId("IdFormacao").setEditable(true);this.getView().byId("IdSalvarDetailDep").setVisible(true);this.getView().byId("IdCancelarDetailDep").setVisible(true);this.getView().byId("IdEditDetailDep").setVisible(false);this.getView().byId("UploadCollection").setUploadButtonInvisible(false)},onCancel:function(){this.getView().getModel().refresh(true);this.getView().byId("IdCancelarDetailDep").setVisible(false);if(s!=="I"){this.getView().byId("UploadCollection").setUploadButtonInvisible(true)}this.getView().byId("IdEstEnsino").setValueState("None");this.getView().byId("IdFormacao").setValueState("None");this.getView().byId("IdInstituicao").setValueState("None");this.getView().byId("IdPais").setValueState("None");this.getView().byId("IdCertificado").setValueState("None");this.getView().byId("IdDuracao").setValueState("None");this.getView().byId("IdTpDuracao").setValueState("None");this.getView().byId("IdDenCurso").setValueState("None");this.getView().byId("IdDtFimForm").setValueState("None")},onChange:function(e){var t=e.getSource();var i=this.getView().getModel();i.refreshSecurityToken();var a=i.oHeaders;var r=a["x-csrf-token"];var s=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:r});t.addHeaderParameter(s)},onBeforeUploadStarts:function(e){var t="0022";var i=this.getView().byId("IdEstEnsino").getSelectedKey();var a="0";if(o!==""||i!==""||a!==""){var r=o+"$"+t+"$"+i+"$"+a+"$"+e.getParameter("fileName");var s=new sap.m.UploadCollectionParameter({name:"slug",value:r});e.getParameters().addHeaderParameter(s)}},onuploadComplete:function(e){var t="0022";var i=this.getView().byId("IdEstEnsino").getSelectedKey();var a="C";if(i!==""){var r=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,o);var s=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,t);var d=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,i);var l=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,a);var u=new sap.ui.model.Filter("chamado",sap.ui.model.FilterOperator.EQ,n);var g=this.getView().byId("UploadCollection");g.getBinding("items").filter([r,s,d,l,u])}},onmodelListContextChange:function(e){var t="0022";var i=this.getView().byId("IdEstEnsino").getSelectedKey();var a="C";if(i!==""){var r=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,o);var s=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,t);var d=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,i);var l=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,a);var u=new sap.ui.model.Filter("chamado",sap.ui.model.FilterOperator.EQ,n);var g=this.getView().byId("UploadCollection");g.getBinding("items").filter([r,s,d,l,u])}},formatEditableKsbez:function(e){if(e==="Outros"){return true}else{return false}},onSave:function(){var e;var t=this;var n=this.getView().getModel();var d={};var l=this.getView().byId("IdEstEnsino").getSelectedKey();var u="/ZET_GLHR_FORM_EMP_ECSet(Pernr='"+o+"',Slart='"+l+"',Tipo='G')";d.Slart=this.getView().byId("IdEstEnsino").getSelectedKey();if(d.Slart===""||d.Slart==="0"){this.getView().byId("IdEstEnsino").setValueState("Error");sap.m.MessageBox.error("Por favor, informe o tipo de Estabelecimento de Ensino.");return}else{this.getView().byId("IdEstEnsino").setValueState("Success")}d.Ausbi=this.getView().byId("IdFormacao").getSelectedKey();if(d.Ausbi===""||d.Ausbi==="0"){this.getView().byId("IdFormacao").setValueState("Error");sap.m.MessageBox.error("Por favor, informe a formação.");return}else{this.getView().byId("IdFormacao").setValueState("Success")}d.Insti=this.getView().byId("IdInstituicao").getValue();if(d.Insti===""){this.getView().byId("IdInstituicao").setValueState("Error");sap.m.MessageBox.error("Por favor, informe a instituição de ensino.");return}else{this.getView().byId("IdInstituicao").setValueState("Success")}d.Sland=this.getView().byId("IdPais").getSelectedKey();if(d.Sland===""){this.getView().byId("IdPais").setValueState("Error");sap.m.MessageBox.error("Por favor, selecione o Pais.");return}else{this.getView().byId("IdPais").setValueState("Success")}d.Slabs=this.getView().byId("IdCertificado").getSelectedKey();if(d.Slabs===""){this.getView().byId("IdCertificado").setValueState("Error");sap.m.MessageBox.error("Por favor, informe se a formação contem Certificado.");return}else{this.getView().byId("IdCertificado").setValueState("Success")}d.Anzkl=this.getView().byId("IdDuracao").getValue();if(d.Anzkl===""||d.Anzkl==="0"){this.getView().byId("IdDuracao").setValueState("Error");sap.m.MessageBox.error("Por favor, informe duração.");return}else{this.getView().byId("IdDuracao").setValueState("Success")}d.Anzeh=this.getView().byId("IdTpDuracao").getSelectedKey();if(d.Anzeh===""){this.getView().byId("IdTpDuracao").setValueState("Error");sap.m.MessageBox.error("Por favor, informe unidade de tempo.");return}else{this.getView().byId("IdTpDuracao").setValueState("Success")}d.Ksbez=this.getView().byId("IdDenCurso").getValue();if(d.Ksbez===""){if(d.Ausbi==="00000000"){this.getView().byId("IdDenCurso").setValueState("Error");sap.m.MessageBox.error("Por favor, para quando a formação for Outros, deverá ser preenchido o campo denominação do curso.");return}else{this.getView().byId("IdDenCurso").setValueState("Success")}}else{this.getView().byId("IdDenCurso").setValueState("Success")}d.ZenddaForm=this.getView().byId("IdDtFimForm").getValue();if(d.ZenddaForm===""){this.getView().byId("IdDtFimForm").setValueState("Error");sap.m.MessageBox.error("Por favor, data fim da formação.");return}else{this.getView().byId("IdDtFimForm").setValueState("Success")}e=new i({title:"Confirmación",type:"Message",content:new r({text:"Após a confirmação não será possivel alterar o anexo até que o processo seja finalizado. Deseja seguir?"}),beginButton:new a({text:"Si",press:function(){n.update(u,d,{success:function(e,i){sap.m.MessageBox.success("Sua inclusão/alteração foi iniciada e seguirá para processamento. Aguarde retorno ou acompanhae pelo app.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){t.getView().getModel().refresh(true);t.getRouter().navTo("FORMACAO")}})},error:function(e){var i=e;i=i.responseText;var a=JSON.parse(i);var r=a.error.message.value;sap.m.MessageBox.error(r,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){if(s==="A"){t.getView().getModel().refresh(true);t.getView().byId("UploadCollection").setUploadButtonInvisible(true)}if(s==="I"){t.getView().byId("IdCancelarDetailDep").setVisible(true)}}});return}});e.close()}}),endButton:new a({text:"No",press:function(){e.close()}}),afterClose:function(){e.destroy()}});e.open()},onDeleteSelectedItems:function(e){var t="0022";var s=this.getView().byId("IdEstEnsino").getSelectedKey();var n=this.getView().getModel();var d="0";var l="0";var t=t;var u="0";var g="E";var s=s;var c=e.getParameters("listItem");var I=c.documentId;I=parseInt(I);var m=this.getView().byId("idTipo").getValue();if(m==="Em ResoluÃ§Ã£o"){sap.m.MessageBox.error("Não será possivel exclusão do anexo, quando o chamado ja existir.");return}var p=this.getView().byId("UploadCollection");var V="/ZET_GLRH_UPLOADSet(Ano='"+d+"',Favor='"+l+"',Infty='"+t+"',Mes='"+u+"',Pernr='"+o+"',Tipo='"+g+"',Subty='"+s+"',DocId="+I+",Objps='',Icnum='')";var f={};f.DocId=1;var h=new i({title:"Confirmação",type:"Message",content:new r({text:"Confirma a exclusão anexo?"}),beginButton:new a({text:"Sim",press:function(){n.update(V,f,{success:function(e,t){sap.m.MessageBox.success("Documentos excluido com sucesso.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){p.getBinding("items").refresh(true)}})},error:function(e){var t=e;t=t.responseText;var i=JSON.parse(t);var a=i.error.message.value;sap.m.MessageBox.error(a,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){p.getBinding("items").refresh(true)}});return}});h.close()}}),endButton:new a({text:"Não",press:function(){h.close()}}),afterClose:function(){h.destroy()}});h.open()}})});