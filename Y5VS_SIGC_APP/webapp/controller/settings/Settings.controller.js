"use strict";function ownKeys(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,o)}return s}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(s),!0).forEach(function(t){_defineProperty(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}function _defineProperty(e,t,s){if(t in e){Object.defineProperty(e,t,{value:s,enumerable:true,configurable:true,writable:true})}else{e[t]=s}return e}sap.ui.define(["../BaseController","./components/DocumentType","./components/Evaluator","./components/Priority","./components/ProcessCategory","./components/ProcessType","./components/ProcessTypeTexts","./components/EmailTemplates","com/innova/sigc/formatter/getVisibleRowCount","com/innova/sigc/lib/searchHelp/searchHelp","com/innova/sigc/model/constant","com/innova/sigc/service/http","com/innova/sigc/service/petitions","sap/m/Button","sap/m/ButtonType","sap/m/Dialog","sap/m/DialogType","sap/m/MessageBox","sap/m/Text","sap/ui/core/Fragment","sap/ui/model/json/JSONModel"],function(e,t,s,o,i,r,n,a,c,l,d,g,p,u,h,y,b,f,m,T,v){return e.extend("com.innova.sigc.controller.settings.Settings",_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({},t),s),o),i),r),n),a),{},{formatter:{getVisibleRowCount:c},searchHelp:l,onInit:function e(){var t=new v(sap.ui.require.toUrl("com/innova/sigc/model/settings/ToolbarContent.json"));this.getView().setModel(t,"Settings");this._oPage=this.byId("page");this._oRouter=this.getRouter();this._oRouter.getRoute("settings").attachMatched(this._onRouteMatched,this)},onItemSelect:function e(t){this._oView.getModel("Settings").setProperty("/selectedTableRow",[]);var s=t.getParameter("item");this.byId("pageContainer").to(this._oView.createId(s.getKey()));this.sSelectedTabKey=s.getKey();this._oPage.setBusy(true);this._validateTabSelected(this.sSelectedTabKey,_objectSpread({},t.getParameter("item").data())).catch(this.errorHandler.bind(this)).finally(this._oPage.setBusy.bind(this._oPage,false))},onNavtoHomePress:function e(){this._oEmailTemplateEditor=undefined;this._oRouter.navTo("home",{},{},true)},onShowValueHelpPress:function e(){var t=this;if(!this._pDialog){this._pDialog=T.load({id:this._oView.getId(),name:"com.innova.sigc.view.settings.fragment.GlobalSearchHelp",controller:this}).then(function(e){e.setModel(t._oView.getModel());return e})}this._pDialog.then(function(e){e.open()})},onTableRowSelect:function e(t){var s=[];if(t.getSource().getSelectedIndex()!==-1){var o=t.getParameter("rowContext").getObject();s.push(o)}this._oView.getModel("Settings").setProperty("/selectedTableRow",s)},onChangeValueToUppercase:function e(t){var s;var o=t.getSource();o.setValue((s=o.getValue())===null||s===void 0?void 0:s.toUpperCase())},_onRouteMatched:function e(){var t=this;this._oPage.setBusy(true);this._oView=this.getView();this._oView.getModel("Settings").setProperty("/createprocesstype",{});this._oView.getModel("Settings").setProperty("/createcategory",{});this._oView.getModel("Settings").setProperty("/createprocesstypetext",{});this._oView.getModel("Settings").setProperty("/createpriority",{});this._oView.getModel("Settings").setProperty("/createdocumenttype",{BSART:"",WERKS_F:"",WERKS_T:""});this.sSelectedTabKey="sProcessTypeId";this.byId("pageContainer").to(this._oView.createId(this.sSelectedTabKey));this.byId("sideNavigation").setSelectedKey(this.sSelectedTabKey);setTimeout(function(){t._validateTabSelected(t.sSelectedTabKey).finally(t._oPage.setBusy.bind(t._oPage,false))})},_validateTabSelected:function e(t,s){this._oView.byId("sHelpIconId").setVisible(false);this._oView.getModel("Settings").setProperty("/templatemode",false);var o={sProcessTypeId:"getProcessTypes",sCategoriesId:"getCategories",sPrioritiesId:"getPriorities",sBuyersId:"getDocumentTypes",evaluators:"_getEvaluators",sProcessTypeTextId:"getProcessTypeTexts",emailTemplates:"_getEmailTemplates"};if(t in o){var i;return this===null||this===void 0?void 0:(i=this[o[t]])===null||i===void 0?void 0:i.call(this,s)}return Promise.resolve()},_handleResponseData:function e(t){var s=t.data;if(this.sSelectedTabKey==="sProcessTypeId"){var o=[];for(var i=0;i<s.length;i+=1){for(var r=0;r<s[i].description.length;r+=1){var n={language:s[i].description[r].language,description:s[i].description[r].description,id:s[i].id,createdBy:s[i].createdBy};o.push(n)}}this._oView.getModel("Settings").setProperty("/processtypes",o)}else if(this.sSelectedTabKey==="sCategoriesId"){var a=[];for(var c=0;c<s.length;c+=1){for(var l=0;l<s[c].catDescription.length;l+=1){var d={language:s[c].catDescription[l].language,description:s[c].catDescription[l].description,id:s[c].id,createdBy:s[c].createdBy};a.push(d)}}this._oView.getModel("Settings").setProperty("/categories",a)}else{this._oView.getModel("Settings").setProperty("/processtexttypes",s)}this._oView.getModel("Settings").refresh(true)},handleSaveorUpdate:function e(t,s,o){if(s){return g.update(o,t)}return g.post(o,t)},handleGenericRecordDelete:function e(t){var s=this;var o=this;var i="";if(o.sSelectedTabKey==="sBuyersId"){i=d.GET_CONF_DOCS}else if(o.sSelectedTabKey==="sPrioritiesId"){i=d.GET_CONF_PRIORITY}p.post(i,{IT_DOCS:[t]}).then(function(){if(o.sSelectedTabKey==="sBuyersId"){o.getDocumentTypes()}else if(o.sSelectedTabKey==="sPrioritiesId"){o.getPriorities()}f.success(s.getResourceBundle().getText("0229"))}).catch(this.errorHandler.bind(this))},handleDeleteRecord:function e(t,s){var o=this;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var r={sProcessTypeId:this.getProcessTypes,sCategoriesId:this.getCategories,sProcessTypeTextId:this.getProcessTypeTexts};var n=t?"".concat(s,"/").concat(t):s;g.delete("".concat(n),i).then(function(){f.success(o.getResourceBundle().getText("0229"))}).then(r[this.sSelectedTabKey].bind(this)).catch(this.errorHandler.bind(this))},_openDeleteRecordDialog:function e(t,s,o,i){var r=this;var n=new y({type:b.Message,title:this.getResourceBundle().getText("0243"),content:new m({text:this.getResourceBundle().getText("0228")}),beginButton:new u({type:h.Emphasized,text:this.getResourceBundle().getText("Commons.0032"),press:function e(){if(!o){r.handleDeleteRecord(t,s,i)}else{r.handleGenericRecordDelete(i)}n.close()}}),endButton:new u({type:h.Reject,text:this.getResourceBundle().getText("Commons.0007")})});this._oView.addDependent(n);n.attachAfterClose(n.destroy.bind(n));n.getEndButton().attachPress(n.close.bind(n));n.addStyleClass(this.getOwnerComponent().getContentDensityClass());n.open()}}))});