"use strict";
/*!
 * SiGC - GestiÃ³n de Compras
 * (c) Copyright 2022 Innova Internacional S.A.S.
 */sap.ui.define(["com/innova/sigc/model/constant","com/innova/sigc/service/http","com/innova/sigc/utils/isEmpty","sap/ui/core/format/DateFormat"],function(e,s,t,n){return{onPostQuestion:function t(n){var o=n.getSource().getBindingContext("processModel").getObject();var i=n.getParameter("value");Promise.resolve(this._oPage.setBusy(true)).then(this._createAnswerRequest.bind(this,i)).then(s.post.bind(s,"".concat(e.api.PROCESS_PATH,"/").concat(o.processId,"/").concat(e.api.ANSWER_QUESTION_PATH,"/").concat(o.idQuestion,"/answer"))).then(this._fetchQuestions.bind(this)).catch(this.errorHandler.bind(this)).finally(this._oPage.setBusy.bind(this._oPage,false))},onChangeQuestionTypeButton:function e(s){var t=s.getSource();t.getDependents()[0].openBy(t)},onChangeQuestion:function t(n,o){var i=n.getBindingContext("processModel").getObject();Promise.resolve(this._oPage.setBusy(true)).then(s.post.bind(s,"".concat(e.api.PROCESS_PATH,"/").concat(i.processId,"/").concat(e.api.ANSWER_QUESTION_PATH,"/").concat(i.idQuestion,"/").concat(e.api.CHANGE_QUESTION_TYPE_PATH),{classQuest:o})).then(this._fetchQuestions.bind(this)).catch(this.errorHandler.bind(this)).finally(this._oPage.setBusy.bind(this._oPage,false))},_fetchQuestions:function t(){var n=this;return s.get("process/".concat(this._numProc,"/").concat(e.api.ANSWER_QUESTION_PATH)).then(function(e){var s=e.data;var t=n._oFormModel.getProperty("/ernam");var o=n.getModel("main").getProperty("/sysParams/UNAME");var i=n._buildQuestions({processQaAn:s,canAnswer:t===o});n._oFormModel.setProperty("/questions",i);n._oFormModel.setProperty("/processQaAn",s);n.byId("Tree").collapseAll()})},_buildQuestions:function e(s){var n=s.processQaAn,o=s.canAnswer;return n.map(function(e){var s={classQuest:e.classQuest,dateQuest:e.dateQuest,ernam:e.vendor.name1,icon:"sap-icon://sys-help",idQuestion:e.id,processId:e.processId,question:e.question,visibleAnswer:false,visibleQuestion:true,nodes:[]};if(!t(e.answer)){s.nodes=[{dateQuest:e.dateAns,ernam:e.user,hourQuest:e.hourAns,icon:"sap-icon://trend-down",question:e.answer,visibleAnswer:false,visibleQuestion:true}]}else if(e.classQuest==="C"&&o){s.nodes=[{idQuestion:e.id,processId:e.processId,vendorId:e.vendorId,visibleAnswer:true,visibleQuestion:false}]}return s})},_createAnswerRequest:function e(s){var t=n.getDateInstance({pattern:"yyyy-MM-ddTkk:mm:ss"});var o=new Date;var i=t.format(o);return{dateAns:i,hourAns:i,answer:s}}}});