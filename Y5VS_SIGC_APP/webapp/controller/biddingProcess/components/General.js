"use strict";function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}
/*!
 * SiGC - GestiÃ³n de Compras
 * (c) Copyright 2022 Innova Internacional S.A.S.
 */sap.ui.define(["com/innova/sigc/lib/formUtils/formUtils","com/innova/sigc/lib/richTextEditor/editor","com/innova/sigc/model/constant","com/innova/sigc/model/process/Process","com/innova/sigc/model/process/TypesDocEnum","com/innova/sigc/service/http","com/innova/sigc/utils/isEmpty","com/innova/sigc/utils/showToast","com/innova/vendor/moment","sap/ui/core/ListItem"],function(e,t,n,i,o,r,s,a,c,u){return{onSave:function e(){var t=this;Promise.resolve(this._oPage.setBusy(true)).then(this._isValidForm.bind(this,this._oGeneralForm)).then(this._buildProcessObjToSave.bind(this)).then(this._saveOrUpdateProcess.bind(this)).then(function(){a(t._i18n.getText("Commons.0021"))}).catch(this.errorHandler.bind(this)).finally(this._oPage.setBusy.bind(this._oPage,false))},onTipoProcSuggest:function e(t){this._inputSuggest(t,n.api.PROCESS_TYPE_PATH)},onCategorySuggest:function e(t){this._inputSuggest(t,n.api.PROCESS_CATEGORY_PATH)},onCondNegocChange:function e(t){this.byId("dztermFormContainer").setVisible(!t)},onValRfiChange:function e(t){this.byId("numRfiFormContainer").setVisible(t)},onPregRespChange:function e(t){this.byId("limPregFormContainer").setVisible(t)},onSuggestionItemSelected:function e(t,n){t.setValue(n.getText())},onLimPregChange:function e(t,n){var i=this.byId("limOferta");var o=i.getDateValue();var r=c(n).isAfter(o);if(r){t.setDateValue();a(this._i18n.getText("0308"))}},onValidateCurrency:function e(t,n){var i;var o=this.byId("".concat(t.data("exclude")));var r=t.data("disableButtonId");var a=s(n);(i=this.byId("".concat(r)))===null||i===void 0?void 0:i.setEnabled(true);t.setValueState(sap.ui.core.ValueState.None);if(a){t.setDescription("");t.setValue("");o.setValueState(sap.ui.core.ValueState.None);o.setRequired(a);o.setEditable(a);o.getParent().getParent().setVisible(true)}else{var c=this.searchHelp.getControlFieldname(t);Promise.resolve(t.setBusy(true)).then(this.searchHelp._validateValueInSearchHelp.bind(this,{name:c,value:n.toUpperCase()})).then(function(e){var i=e;if(!i){a=true;t.setValueState(sap.ui.core.ValueState.Error);t.setValue(null)}t.setValue(n.toUpperCase());t.setDescription(i===null||i===void 0?void 0:i.FTEXT);o.setValueState(sap.ui.core.ValueState.None);o.setRequired(a);o.setEditable(a)}).catch(this.errorHandler.bind(this)).finally(t.setBusy.bind(t,false))}},onChangeErnam:function e(t){t.setValueState(sap.ui.core.ValueState.None);if(this._oSearchHelpContext){var n;var i=this.byId("oIEmailManage");i.setValue((n=this._oSearchHelpContext)===null||n===void 0?void 0:n.FCODE2);this._oSearchHelpContext=null}},_renderEditors:function e(){var n=this;setTimeout(function(){t.removeEditorManager();n._oInvitationEmailEditor=t.initializeQuillEditor.call(n,{container:n.byId("invitationEmailEditor").getDomRef(),placeholder:n._i18n.getText("0314"),setup:function e(t){t.on("init",function(){t.setContent(n._oFormModel.getProperty("/templateInvitation")||"")})}});n._oInvitationEmailEditor.render();n._oOferenteEditor=t.initializeQuillEditor.call(n,{container:n.byId("editorOferente").getDomRef(),placeholder:n._i18n.getText("0080"),setup:function e(t){t.on("init",function(){t.setContent(n._oFormModel.getProperty("/infoOferentes")||"")})}});n._oOferenteEditor.render();n._oInternoEditor=t.initializeQuillEditor({container:n.byId("editorInterno").getDomRef(),placeholder:n._i18n.getText("0081"),setup:function e(t){t.on("init",function(){t.setContent(n._oFormModel.getProperty("/infoInterno")||"")})}});n._oInternoEditor.render()},0)},_buildProcessObjToSave:function t(){var n=e.getFormData(this._oGeneralForm);return new i(_objectSpread(_objectSpread({},n),{},{tipoDoc:o.LIC_COT,infoOferentes:this._oOferenteEditor.getContent(),infoInterno:this._oInternoEditor.getContent(),templateInvitation:this._oInvitationEmailEditor.getContent()}))},_saveOrUpdateProcess:function e(t){var i=this;if(this._numProc){return r.update("".concat(n.api.PROCESS_PATH,"/").concat(this._numProc),t)}return r.post(n.api.PROCESS_PATH,t).then(function(e){var t=e.data;var n=t.numProc;i.getRouter().navTo("manageBiddingProcess",{query:window.encodeURIComponent(n)},{},true)})},_inputSuggest:function e(t,n){r.get("".concat(n)).then(function(e){var t=e.data;return t}).then(function(e){t.destroySuggestionItems();e.forEach(function(e){t.addSuggestionItem(new u({key:e.id,text:e.description,additionalText:e.id}))})}).catch(this.errorHandler.bind(this))},_validateProcessCurrency:function e(t){var n=t.offers,i=n===void 0?[]:n,o=t.waers,r=t.conversionCurrency;if(!s(r)){this.byId("processCurrency").setRequired(false);this.byId("processCurrency").setEditable(false);this.byId("waersContainer").setVisible(false)}else if(!s(o)){var a=i.some(function(e){var t=e.pricesPerRound;return t.length});this.byId("processCurrency").setEditable(!a);this.byId("processCurrency").setRequired(true);this.byId("processConversionCurrency").setRequired(false);this.byId("processConversionCurrency").setEditable(false);this.byId("conversionCurrencyContainer").setVisible(false)}},_validatePartialOffers:function e(t){var n=t.offers,i=n===void 0?[]:n;var o=i.some(function(e){var t=e.positions;return t.length});this.byId("offerPartialSwitch").setEnabled(!o)},_loadItemsRespJuridico:function e(){var t=this;return r.get(n.api.EVALUATORS_PATH).then(function(e){var n=e.data;t._oFormModel.setProperty("/valueHelp/respJuridico",n.filter(function(e){var t=e.role,n=e.status;return t.includes("LEGAL_EVALUATOR")&&n==="Verified"}))})},_loadItemsRespTecnico:function e(){var t=this;return r.get(n.api.EVALUATORS_PATH).then(function(e){var n=e.data;t._oFormModel.setProperty("/valueHelp/respTecnico",n.filter(function(e){var t=e.role,n=e.status;return t.includes("TECHNICAL_EVALUATOR")&&n==="Verified"}))})}}});