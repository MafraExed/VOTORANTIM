"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}function _iterableToArray(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,a=new Array(t);r<t;r++){a[r]=e[r]}return a}
/*!
 * SiGC - GestiÃ³n de Compras
 * (c) Copyright 2022 Innova Internacional S.A.S.
 */sap.ui.define(["com/innova/sigc/factory/attachment/attachment","com/innova/sigc/model/constant","com/innova/sigc/service/http","com/innova/sigc/utils/downloadFile"],function(e,t,r,a){return{onBeforeItemAdded:function e(a,n){var o=this;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;a.preventDefault();var s=a.getSource();var l=s.data("type");var c=new FormData;c.append("private",i);c.append("processId",this._numProc);c.append("files",n.getFileObject(),n.getFileName());c.append("type",l);Promise.resolve(this._oPage.setBusy(true)).then(r.post.bind(r,"".concat(t.api.ATTACHMENTS_PATH),c)).then(function(e){var t=e.data;o._oFormModel.setProperty("/attachments",[].concat(_toConsumableArray(o._oFormModel.getProperty("/attachments")),_toConsumableArray(t)))}).catch(this.errorHandler.bind(this)).finally(this._oPage.setBusy.bind(this._oPage,false))},onDownloadAttachment:function e(t){t.preventDefault();var r=t.getParameter("item");var a=r.getBindingContext("processModel");var n=a.getProperty("id");Promise.resolve(this._oPage.setBusy(true)).then(this._fecthAttachments.bind(this,{context:a,id:n})).catch(this.errorHandler.bind(this)).finally(this._oPage.setBusy.bind(this._oPage,false))},onRemoveAttachment:function e(a){var n=this;a.preventDefault();var o=a.getSource().getBindingContext("processModel").getProperty("id");Promise.resolve(this._oPage.setBusy(true)).then(r.delete.bind(r,"".concat(t.api.ATTACHMENTS_PATH,"/").concat(o),{})).then(function(){n._deleteBindingRows({path:"/attachments",ids:[o]})}).catch(this.errorHandler.bind(this)).finally(this._oPage.setBusy.bind(this._oPage,false))},_resetAttachments:function t(){this.byId("UploadSet1").unbindAggregation("items").bindAggregation("items",{path:"processModel>/attachments",filters:[new sap.ui.model.Filter({path:"private",operator:sap.ui.model.FilterOperator.NE,value1:"X"}),new sap.ui.model.Filter({path:"type",operator:sap.ui.model.FilterOperator.EQ,value1:"ANEXO"})],templateShareable:false,factory:e.sharedUse.bind(this)});this.byId("UploadSet2").unbindAggregation("items").bindAggregation("items",{path:"processModel>/attachments",filters:[new sap.ui.model.Filter({path:"private",operator:sap.ui.model.FilterOperator.EQ,value1:"X"}),new sap.ui.model.Filter({path:"type",operator:sap.ui.model.FilterOperator.EQ,value1:"ANEXO"})],templateShareable:false,factory:e.internalUse.bind(this)});this.byId("UploadSet3").unbindAggregation("items").bindAggregation("items",{path:"processModel>/attachments",filters:[new sap.ui.model.Filter({path:"type",operator:sap.ui.model.FilterOperator.EQ,value1:"ADENDO"})],templateShareable:false,factory:e.internalUse.bind(this)})},_fecthAttachments:function e(n){var o=n.context,i=n.id;return r.downloadAttachment({url:"".concat(t.api.ATTACHMENTS_PATH,"/").concat(i)}).then(function(e){var t=e.data;a({blob:t,filename:o.getProperty("originalname")})})}}});