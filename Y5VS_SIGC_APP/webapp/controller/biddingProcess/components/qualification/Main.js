"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _arrayLikeToArray(e,t)}function _iterableToArray(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++){n[r]=e[r]}return n}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}sap.ui.define(["./AdditionalInformation","./Commercial","./Technical","./Summary","com/innova/sigc/model/constant","com/innova/sigc/service/petitions","com/innova/sigc/utils/parseUniversalDate","sap/ui/core/Fragment","sap/ui/model/json/JSONModel"],function(e,t,r,n,o,a,i,c,s){return _objectSpread(_objectSpread(_objectSpread(_objectSpread({onShowPositionComments:function e(t){var r=this;var n=t.commentsByPosition;var o=this.getView();c.load({id:o.getId(),name:"com.innova.sigc.view.biddingProcess.dialog.qualification.SeePositionComments",controller:this}).then(function(e){var t=e;o.addDependent(t);t.getEndButton().attachPress(t.close.bind(t));r._oRejectOfferDialog=t;r._oRejectOfferDialog.setModel(new s({comments:n.comments}));t.attachAfterClose(t.destroy.bind(t));t.open()})},_fetchQualifications:function e(){var t=this.byId("qualificationsIconTabBar");t.setSelectedKey("commercialQualification");this._validateEvaluationCriteria(t);return this._fetchCommercialQualifications()},_validateEvaluationCriteria:function e(t){var r=this._sumOfEvaluationCriteria(this._oFormModel.getProperty("/evaluationCriteria")),n=r.sumCommercialEval,o=r.sumTechEval;var a=this.byId("oRBEvaluation");var i;if(a.getSelectedIndex()===0){i=o===100&&n===100;t.setBlocked(!i);t.setExpanded(i);if(!i){throw new Error(this._i18n.getText("0363"))}}else{var c=n+o;i=c===100;t.setBlocked(!i);t.setExpanded(i);if(!i){throw new Error(this._i18n.getText("0362"))}}},_getDefaultQualificationColumns:function e(){var t=[{label:this.getResourceBundle().getText("0053"),mergeDuplicates:false,name:"criterio",template:"Criterio"},{label:this.getResourceBundle().getText("0057"),mergeDuplicates:false,name:"pesoValor",template:"PesoValor"}];var r=[{label:this.getResourceBundle().getText("0083"),mergeDuplicates:true,name:"posProc",template:"PosProc"},{label:this.getResourceBundle().getText("0039"),mergeDuplicates:true,mergeFunctionName:"getTitle",name:"matnr",template:"Matnr"}];var n=[].concat(t);var o=r.concat(t);var a=r.concat([{label:this.getResourceBundle().getText("0042"),mergeDuplicates:true,name:"menge",template:"menge"},{label:this.getResourceBundle().getText("0143"),mergeDuplicates:true,name:"state",template:"state"}]);return[n,o,a]},_mapEvaluationCriteria:function e(t){return{criteriaId:t.id,criterio:t.criterio,entradaProveedor:t.entradaProveedor,pesoValor:t.pesoValor,valoracion:t.valoracion,tipo:t.tipo}},_getItemsUpdatedQualification:function e(t){var r=this.byId(t).getItems().filter(function(e){return e.getBindingContext().getProperty("isUpdated")});if(!r.length){throw new Error(this.getResourceBundle().getText("Commons.0026"))}this._oQualificationItems=r;return r},_getItemsSelectedQualification:function e(t){var r=this.byId(t).getItems().filter(function(e){return e.getBindingContext().getProperty("selected")});if(!r.length){throw new Error(this.getResourceBundle().getText("Commons.0022"))}this._aQualificationItems=r;return r},_fetchWithConversionCurrency:function e(t){var r=this;var n=t.offers,c=t.conversionCurrency,s=t.conversionDate;var u=[];n.forEach(function(e){e.pricesPerRound.forEach(function(e){u.push(e.waers)})});var l=s?i(s):new Date;return a.post(o.GET_CONVERT_TO_CURRENCY,{IV_DATE:l.toISOString().replace(/T.+/,""),IT_FOREIGN:_toConsumableArray(new Set(u)).map(function(e){return{WAERS:e}}),IV_LOCAL:c}).then(function(e){var t=e.data;var n={currencyBase:c,rates:u.map(function(e){var r;var n=(r=t.find(function(t){return t.FCURR===e}))!==null&&r!==void 0?r:{FCURR:e,UKURS:1};return{currency:n.FCURR,value:n.UKURS}})};r._oConversionCurrency=n;return n})}},e),t),r),n)});