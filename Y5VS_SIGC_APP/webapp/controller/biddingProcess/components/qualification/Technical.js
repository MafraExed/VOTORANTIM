"use strict";function _slicedToArray(r,e){return _arrayWithHoles(r)||_iterableToArrayLimit(r,e)||_unsupportedIterableToArray(r,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,e){if(!r)return;if(typeof r==="string")return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor)t=r.constructor.name;if(t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _arrayLikeToArray(r,e)}function _arrayLikeToArray(r,e){if(e==null||e>r.length)e=r.length;for(var t=0,a=new Array(e);t<e;t++){a[t]=r[t]}return a}function _iterableToArrayLimit(r,e){var t=r==null?null:typeof Symbol!=="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(t==null)return;var a=[];var o=true;var i=false;var n,s;try{for(t=t.call(r);!(o=(n=t.next()).done);o=true){a.push(n.value);if(e&&a.length===e)break}}catch(r){i=true;s=r}finally{try{if(!o&&t["return"]!=null)t["return"]()}finally{if(i)throw s}}return a}function _arrayWithHoles(r){if(Array.isArray(r))return r}function ownKeys(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,a)}return t}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(t),!0).forEach(function(e){_defineProperty(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}function _defineProperty(r,e,t){if(e in r){Object.defineProperty(r,e,{value:t,enumerable:true,configurable:true,writable:true})}else{r[e]=t}return r}
/*!
 * SiGC - GestiÃ³n de Compras
 * (c) Copyright 2022 Innova Internacional S.A.S.
 */sap.ui.define(["com/innova/sigc/factory/technicalQualification/qualification","com/innova/sigc/model/constant","com/innova/sigc/model/process/LevelEvaluationCriteria","com/innova/sigc/model/process/TypesEvaluationCriteria","com/innova/sigc/service/http","com/innova/vendor/lodash.filter","com/innova/vendor/lodash.find","com/innova/vendor/lodash.get","sap/ui/model/json/JSONModel","sap/ui/model/Sorter"],function(r,e,t,a,o,i,n,s,c,u){return{_fetchTechnicalQualifications:function r(){var t=this;return o.get("".concat(e.api.PROCESS_PATH,"/").concat(this._numProc,"/").concat(e.api.OFFERS_PATH)).then(function(r){var e=r.data;var a=t._oFormModel.getData();t._buildTechnicalQualifications(_objectSpread(_objectSpread({},a),{},{offers:e}));t._oFormModel.setProperty("/offers",e)})},_buildTechnicalQualifications:function r(e){var t=i(s(e,"offers",[]),{estaOfer:true});var o=s(e,"status","");var n=s(e,"positions",[]);var c=s(e,"evaluationCriteria",[]);var u=i(c,{tipo:a.T});var l=this._getDefaultQualificationColumns(),f=_slicedToArray(l,2),d=f[0],v=f[1];this._buildTechnicalQualificationsByHeader({evaluationCriteria:u,headerColumn:d,offers:t,processStatus:o});this._buildTechnicalQualificationsByPos({evaluationCriteria:u,offers:t,positionColumn:v,processPositions:n,processStatus:o})},_buildTechnicalQualificationsByHeader:function e(a){var o=this;var l=a.evaluationCriteria,f=a.headerColumn,d=a.offers,v=a.processStatus;var p=JSON.parse(JSON.stringify(f));var y=i(l,{indCabPos:t.C.key});var h=this._mappedOffers({offers:d,rows:y.map(this._mapEvaluationCriteria)});d.forEach(function(r){var e=s(r,"headerCriteria",[]);var t=s(r,"vendor.idProv","");var a={offerId:r.angnr,vendorId:t,label:s(r,"vendor.name1",""),name:t,template:"Custom",processStatus:v};e.forEach(function(e){var a=n(h,{criteriaId:e.evaluationCriteriaId});o._addPositionCriteriaToRow({criteria:e,offerId:r.angnr,row:a,vendorId:t})});p.push(a)});var b=this.byId("technicalQualificationTableByHeader");var m=this.byId("techQualificationPanel");m.setHeaderText("".concat(this.getResourceBundle().getText("0082")," (").concat(h.length,")"));b.bindItems({path:"/rows",sorter:new u("posId"),factory:r.createItems.bind(this)}).setModel(new c({rows:h,columns:p}))},_buildTechnicalQualificationsByPos:function e(a){var o=this;var l=a.evaluationCriteria,f=a.offers,d=a.positionColumn,v=a.processPositions,p=a.processStatus;var y=JSON.parse(JSON.stringify(d));var h=i(l,{indCabPos:t.P.key});var b=this._mappedOffers({offers:f,rows:this._mergeEvaluationCriteriaWithProcessPositions({evaluationCriteria:h,processPositions:v}),isPosition:true});f.forEach(function(r){var e=s(r,"positions",[]);var t=s(r,"positionCriteria",[]);var a=s(r,"vendor.idProv","");var c={offerId:r.angnr,vendorId:a,label:s(r,"vendor.name1",""),name:a,template:"Custom",processStatus:p};e.forEach(function(e){var t=i(b,{posId:e.positionId});t.forEach(function(t){var o,i,n;var s=t;s["cantOfer_".concat(a)]=e.cantOfer;s["cantAsig_".concat(a)]=e.cantAsig;s["diasEntrega_".concat(a)]=e.diasEntrega;s["diasGarantia_".concat(a)]=e.diasGarantia;(o=s.status)!==null&&o!==void 0?o:s.status=new Map;s.status.set(a,{status:e.status,statusType:r.statusEvaluatorType||e.statusEvaluatorType});var c=(i=s.offers)===null||i===void 0?void 0:i.get(a);(n=s.offers)===null||n===void 0?void 0:n.set(a,_objectSpread(_objectSpread({},c),{},{status:e.status,statusType:e.statusEvaluatorType}))})});t.forEach(function(e){var t=n(b,{posId:e.positionId,criteriaId:e.evaluationCriteriaId});o._addPositionCriteriaToRow({row:t,criteria:e,vendorId:a,offerId:r.angnr})});y.push(c)});var m=this.byId("technicalQualificationTableByPos");m.bindItems({path:"/rows",sorter:new u("posId"),factory:r.createItems.bind(this)}).setModel(new c({rows:b,columns:y}))}}});