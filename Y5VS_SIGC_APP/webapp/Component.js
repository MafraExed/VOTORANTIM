"use strict";var _excluded=["JWT","URL_API","DELAY"];function _objectWithoutProperties(e,t){if(e==null)return{};var n=_objectWithoutPropertiesLoose(e,t);var o,s;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++){o=i[s];if(t.indexOf(o)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,o))continue;n[o]=e[o]}}return n}function _objectWithoutPropertiesLoose(e,t){if(e==null)return{};var n={};var o=Object.keys(e);var s,i;for(i=0;i<o.length;i++){s=o[i];if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}
/*!
 * SiGC - GestiÃ³n de Compras
 * (c) Copyright 2022 Innova Internacional S.A.S.
 */sap.ui.define(["./errorHandlers","sap/m/MessageBox","sap/ui/core/IconPool","sap/ui/core/routing/History","sap/ui/core/UIComponent","sap/ui/Device","com/innova/sigc/model/constant","com/innova/sigc/model/models","com/innova/sigc/model/numberFormat","com/innova/sigc/model/searchHelp/SearchHelp","com/innova/sigc/service/petitions","com/innova/sigc/service/http"],function(e,t,n,o,s,i,r,a,c,u,d,l){return s.extend("com.innova.sigc.Component",{metadata:{manifest:"json"},_sContentDensityClass:undefined,_sTimeoutId:undefined,_sMUserSessTimeoutId:undefined,_oTextPool:{},init:function t(){var n=this;for(var o=arguments.length,i=new Array(o),r=0;r<o;r++){i[r]=arguments[r]}s.prototype.init.apply(this,i);d.setModel(this.getModel("odata"));this._bindFonts();var c=a.createMainModel();this.setModel(c,"main");this.setModel(a.createStoreModel(),"store");this.setModel(a.createCriteriaModel(),"criteria");this.setModel(a.createQuestionModel(),"questions");d.setModel(this.getModel("odata"));this.fecthInitialize(c).then(this._fetchUserInfo.bind(this,c)).then(this.fetchLanguage.bind(this,c)).then(this.fetchCountries.bind(this,c)).then(this.fetchTypeId.bind(this,c)).then(function(){n.getRouter().initialize();n.hideLoader(300)}).catch(e.bind(this))},destroy:function e(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++){n[o]=arguments[o]}s.prototype.destroy.apply(this,n)},getContentDensityClass:function e(){if(this._sContentDensityClass===undefined){if(document.body.classList.contains("sapUiSizeCozy")||document.body.classList.contains("sapUiSizeCompact")){this._sContentDensityClass=""}else if(!i.support.touch){this._sContentDensityClass="sapUiSizeCompact"}else{this._sContentDensityClass="sapUiSizeCozy"}}return this._sContentDensityClass},refreshToken:function e(){d.post("".concat(r.GET_INITIALIZE)).then(function(e){var t=e.data;var n=t.sysParams,o=n.JWT,s=n.URL_API;l.setInstance({token:o,baseURL:s})})},errorHandler:function t(n,o){e(n,o)},getMessageTextPool:function e(t){var n=this._oTextPool;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:""},hideLoader:function e(t){if(t&&t>0){if(this._sTimeoutId){clearTimeout(this._sTimeoutId);this._sTimeoutId=null}this._sTimeoutId=setTimeout(function(){document.getElementById("loader").style.display="none"},t)}},showLoader:function e(){document.getElementById("loader").style.display="block"},onNavBack:function e(){var t=o.getInstance().getPreviousHash();if(t!==undefined){window.history.go(-1)}else{this.getRouter().navTo("home",{},{},true)}},fecthInitialize:function e(t){var n=this;return d.post("".concat(r.GET_INITIALIZE)).then(function(e){var o=e.data;var s=o.bukrs,i=o.ekgrp,r=o.ekorg;n._oTextPool=_objectSpread({},o.textPool);var a=o.sysParams,u=a.JWT,d=a.URL_API,p=a.DELAY,f=p===void 0?3600:p,h=_objectWithoutProperties(a,_excluded);t.setProperty("/sysParams",_objectSpread({},h));t.setProperty("/bukrs",s);t.setProperty("/ekgrp",i);t.setProperty("/ekorg",r);t.setProperty("/logoAboutInnova",sap.ui.require.toUrl("com/innova/sigc/img/logo-azul.png"));var g=o.sysParams.sepmil;var m=o.sysParams.sepdec;c.getNumberFormat(g,m);c.getFormatOptions(g,m);l.setInstance({token:u,baseURL:d});n._managingUserSessions(f)})},_fetchUserInfo:function e(t){var n=t.getProperty("/sysParams/UNAME");var o=new u("ERNAM");o.setFCODE1(n);return d.post(r.GET_SEARCH_HELP,o).then(function(e){var n,o;var s=e.data;t.setProperty("/sysParams/FULLNAME",(n=s.data)===null||n===void 0?void 0:(o=n[0])===null||o===void 0?void 0:o.FTEXT)})},fetchLanguage:function e(t){var n=this;document.title=this.getModel("i18n").getResourceBundle().getText("title");return d.post(r.GET_SEARCH_HELP,new u("SPRAS")).then(function(e){var o=e.data;t.setProperty("/languages",o.spras);t.setProperty("/currentLanguage",n.getCookieLanguage())})},fetchCountries:function e(t){return l.get("".concat(r.api.GET_COUNTRIES_HELP,"?spras=").concat(this.getCookieLanguage()),new u("COUNTRIES")).then(function(e){var n=e.data;t.setProperty("/countries",n)})},fetchTypeId:function e(t){return l.get("".concat(r.api.GET_TYPEID_HELP,"?spras=").concat(this.getCookieLanguage()),new u("typeId")).then(function(e){var n=e.data;t.setProperty("/typeId",n)})},getCookieLanguage:function e(){var t,n;var o="sap-usercontext=";var s=decodeURIComponent(document.cookie);var i=s.split("; ");var r="";i.forEach(function(e){if(e.indexOf(o)===0)r=e.substring(o.length)});var a=(t=r)===null||t===void 0?void 0:(n=t.split("&"))===null||n===void 0?void 0:n.find(function(e){return e.match(/sap-language/)});return a?a.split("=")[1]:"ES"},_bindFonts:function e(){var t={fontFamily:"SAP-icons-TNT",fontURI:sap.ui.require.toUrl("sap/tnt/themes/base/fonts/")};n.registerFont(t)},_managingUserSessions:function n(o){var s=this;var i=this.getModel("i18n");var r=i.getResourceBundle();var a=r.getText("Commons.0043");if(this._sMUserSessTimeoutId){clearTimeout(this._sMUserSessTimeoutId);this._sMUserSessTimeoutId=null}this._sMUserSessTimeoutId=setTimeout(function(){t.warning(r.getText("Commons.0044"),{actions:[a],emphasizedAction:a,onClose:function t(n){if(a===n){var o=s.getModel("main");s.fecthInitialize(o).catch(e.bind(s))}}})},o*1e3-3e5)}})});