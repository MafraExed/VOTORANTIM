sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/m/library","sap/ui/core/Fragment","sap/m/Token","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast","sap/m/MessageBox"],function(e,i,t,a,s,l,o,n,d,r){"use strict";var m=a.URLHelper;return e.extend("votorantim.corp.clocov2planmanagement.controller.TaskAlertConfig",{formatter:t,onInit:function(){this.getView().attachModelContextChange(null,this.onContextChange,this);const e=["idMultiEmailLembrete","idMultiEmailatividadeNaoInic","idMultiEmailAtividadeNaoEnc","idMultiEmailAtividadeDisp","idMultiEmailAtividadeReoroc","idMultiEmailAtividadeFin"];for(const i of e){this.getView().byId(i).addValidator(this.multiInputEmailValidator)}this._updateEmailSuggestion=3;this._updatingSuggestion=false},onContextChange:function(e){if(!this.getView().getModel())return;if(!this.getView().getBindingContext())return;const i=this.getView().getBindingContext().getObject();this._lastItem=i.NodeID;this.updateAlertFields(i)},onExit:function(){this.getView().detachModelContextChange(this.onContextChange,this)},_onObjectMatched:function(e){let i=e.getParameter("arguments");this._profile=i.profile;this._instance=i.instance;this._item=i.item},getEmailTokens:function(e){const i=[];if(e==="")return i;const t=e.split(";");for(const e of t){const t={key:e,text:e,editable:true};i.push(t)}return i},updateAlertFields:function(e){let i;const t=[];const a=this.getView().getModel().getProperty(`/v2_notificacoes(Profile='${e.Profile}',Instance=${e.Instance},Item='${e.NodeID}')`);if(a.EmailResp)i={key:"resp",text:a.EmailResp,editable:false};if(a.EmailSucessores){const e=a.EmailSucessores.split(",");for(const i of e){t.push({key:"emailsucessor",text:i,editable:false})}}a.LembreteEmails=this.cleanVar(a.LembreteEmails);a.AtividadeNaoInicEmails=this.cleanVar(a.AtividadeNaoInicEmails);a.AtividadeNaoEncEmails=this.cleanVar(a.AtividadeNaoEncEmails);a.AtividadeDispEmails=this.cleanVar(a.AtividadeDispEmails);a.AtividadeRepEmails=this.cleanVar(a.AtividadeRepEmails);a.AtividadeFinEmails=this.cleanVar(a.AtividadeFinEmails);if(a.LembreteEmails){const e=this.getEmailTokens(a.LembreteEmails);if(i)e.unshift(i);this.getView().getModel("alertEmails").setProperty("/lembreteEmails",e)}else{if(i)this.getView().getModel("alertEmails").setProperty("/lembreteEmails",[i])}if(a.AtividadeNaoInicEmails){const e=this.getEmailTokens(a.AtividadeNaoInicEmails);if(i)e.unshift(i);this.getView().getModel("alertEmails").setProperty("/AtividadeNaoInicEmails",e)}else{if(i)this.getView().getModel("alertEmails").setProperty("/AtividadeNaoInicEmails",[i])}if(a.AtividadeNaoEncEmails){const e=this.getEmailTokens(a.AtividadeNaoEncEmails);if(i)e.unshift(i);this.getView().getModel("alertEmails").setProperty("/AtividadeNaoEncEmails",e)}else{if(i)this.getView().getModel("alertEmails").setProperty("/AtividadeNaoEncEmails",[i])}if(a.AtividadeDispEmails){const e=this.getEmailTokens(a.AtividadeDispEmails);if(i)e.unshift(i);this.getView().getModel("alertEmails").setProperty("/AtividadeDispEmails",e)}else{if(i)this.getView().getModel("alertEmails").setProperty("/AtividadeDispEmails",[i])}if(a.AtividadeRepEmails){const e=this.getEmailTokens(a.AtividadeRepEmails);if(i)e.unshift(i);this.getView().getModel("alertEmails").setProperty("/AtividadeRepEmails",e)}else{if(i)this.getView().getModel("alertEmails").setProperty("/AtividadeRepEmails",[i])}if(a.AtividadeFinEmails){const e=this.getEmailTokens(a.AtividadeFinEmails);this.getView().getModel("alertEmails").setProperty("/AtividadeFinEmails",e)}},cleanVar:function(e){if(e==="resp")return"";if(e.indexOf("resp;")!==-1)return e.replaceAll("resp;","");return e},onDataChanged:function(){if(!this._taskView)this._taskView=this.getRootView("votorantim.corp.clocov2planmanagement.view.Task");if(!this._taskView.getModel("taskView").getProperty("/hasChanges")){this._taskView.byId("ObjectPageTask").setShowFooter(true);this._taskView.getModel("taskView").setProperty("/hasChanges",true)}}})});