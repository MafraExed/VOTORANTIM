sap.ui.define(["Y5GL_DHO4/Y5GL_DHO4/controller/BaseController","sap/ui/Device","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/ui/model/Filter"],function(e,t,a,o,r,i){"use strict";var s;var n;return e.extend("Y5GL_DHO4.Y5GL_DHO4.controller.DADOS_PESSOAIS",{onInit:function(){this.getRouter().getRoute("DADOS_PESSOAIS").attachPatternMatched(this._onObjectMatched,this);var e=sap.ushell.Container.getUser().getFullName();this.getView().byId("idTitleDep").setText(e);var t=jQuery.sap.getModulePath("Y5GL_DHO4.Y5GL_DHO4");var a=t+"/imagens/loading.gif";this.getView().byId("idimg").setSrc(a)},_onObjectMatched:function(e){s=e.getParameter("arguments").Pernr;n=e.getParameter("arguments").Chamado;this.getView().byId("idTitleDependentes").setText("Dados Pessoais - (Matrícula - "+s+") - Chamado - "+n+" ");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_MEUS_DADOS_ECSet",{Pernr:s,Tipo:"V",Chamado:n});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getView().getModel();var a=this;t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){a.loading(true)},dataReceived:function(){a.loading(false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");return}},onBackMaster:function(){this.getRouter().navTo("worklist")},onAprovar:function(){var e=this.getView();var t=e.byId("IdNomeCompleto").getValue();var i=e.byId("IdDataNascimento").getValue();var s=e.byId("IdSexo").getSelectedKey();var n=e.byId("IdNacionaliade").getSelectedKey();var d=e.byId("IdLocNascimento").getValue();var l=e.byId("IdEstNasc").getSelectedKey();var u=e.byId("IdPaisNasc").getSelectedKey();var c=e.byId("IdAposentado").getSelectedKey();var g=e.byId("IdRaca").getSelectedKey();var m=e.byId("IdCasadoDesde").getValue();var I=e.byId("IdEstCivil").getSelectedKey();var p=e.byId("IdIdioma").getSelectedKey();var f=e.byId("IdCodNat").getValue();var v;var b=this.getView().getModel();var y=this;var V;var h;var S;var w;var C={};if(t===""||t===undefined){e.byId("IdNomeCompleto").setValueState("Error");sap.m.MessageBox.error("Informe o nome completo.");return}else{e.byId("IdNomeCompleto").setValueState("None");C.Nome=t}if(i===""||i===undefined){e.byId("IdDataNascimento").setValueState("Error");sap.m.MessageBox.error("Informe a data de nascimento.");return}else{e.byId("IdDataNascimento").setValueState("None");i=i.substring(0,4)+i.substring(5,7)+i.substring(8,10);C.DtNasc=i}if(s===""||s===undefined){e.byId("IdSexo").setValueState("Error");sap.m.MessageBox.error("Informe o sexo.");return}else{e.byId("IdSexo").setValueState("None");C.Sexo=s}if(n===""||n===undefined){e.byId("IdNacionaliade").setValueState("Error");sap.m.MessageBox.error("Informe a nacionalidade.");return}else{e.byId("IdNacionaliade").setValueState("None");C.Nacionalidade=n}if(d===""||d===undefined){e.byId("IdLocalNascimento").setValueState("Error");sap.m.MessageBox.error("Informe a local de nascimento.");return}else{e.byId("IdLocNascimento").setValueState("None");C.Municipio=d}if(f===""||f===undefined){e.byId("IdCodNat").setValueState("Error");sap.m.MessageBox.error("Informe a local de nascimento.");return}else{e.byId("IdCodNat").setValueState("None");C.CodNaturalidade=f}if(l===""||l===undefined){e.byId("IdEstNasc").setValueState("Error");sap.m.MessageBox.error("Informe o estado de nascimento.");return}else{e.byId("IdEstNasc").setValueState("None");C.Estado=l}if(u===""||u===undefined){e.byId("IdPaisNasc").setValueState("Error");sap.m.MessageBox.error("Informe o pais de nascimento.");return}else{e.byId("IdPaisNasc").setValueState("None");C.Pais=u}if(p===""||p===undefined){e.byId("IdIdioma").setValueState("Error");sap.m.MessageBox.error("Informe o idioma.");return}else{e.byId("IdIdioma").setValueState("None");C.Idioma=p}if(I===""||I===undefined){e.byId("IdEstCivil").setValueState("Error");sap.m.MessageBox.error("Informe o estado civil.");return}else{e.byId("IdEstCivil").setValueState("None");C.EstadoCivil=I}if(m===""||m===undefined){if(I!=="1"){e.byId("IdCasadoDesde").setValueState("Error");sap.m.MessageBox.error("Informe o estado civil desde.");return}e.byId("IdCasadoDesde").setValueState("None")}else{e.byId("IdCasadoDesde").setValueState("None");m=m.substring(0,4)+m.substring(5,7)+m.substring(8,10);C.DtCasamento=m}if(g===""||g===undefined){e.byId("IdRaca").setValueState("Error");sap.m.MessageBox.error("Informe a raca.");return}else{e.byId("IdRaca").setValueState("None");C.Raca=g}if(c===""||c===undefined){e.byId("IdAposentado").setValueState("Error");sap.m.MessageBox.error("Informe se aposentado.");return}else{e.byId("IdAposentado").setValueState("None");C.Aposentado=c}C.Tipo="X";w="/ZET_MEUS_DADOS_ECSet(Pernr='0',Tipo='G')";v=new a({title:"Confirmação",type:"Message",content:new r({text:"Após a confirmação não será possivel alterar o anexo até que o processo seja finalizado. Deseja seguir?"}),beginButton:new o({text:"Sim",press:function(){b.update(w,C,{success:function(e,t){sap.m.MessageBox.success("Sua inclusão/alteração foi iniciada e seguirá para processamento. Aguarde retorno ou acompanhe pelo app.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){y.getView().getModel().refresh(true);y.onCancel()}})},error:function(e){V=e;V=V.responseText;h=JSON.parse(V);S=h.error.message.value;sap.m.MessageBox.error(S,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){}});return}});v.close()}}),endButton:new o({text:"Não",press:function(){v.close()}}),afterClose:function(){v.destroy()}});v.open()},handleValueHelp:function(e){var t=e.getSource().getValue();this.inputId=e.getSource().getId();if(!this._valueHelpDialog1){this._valueHelpDialog1=sap.ui.xmlfragment("Y5GL_DHO4.Y5GL_DHO4.view.LocNascimento",this);this.getView().addDependent(this._valueHelpDialog1)}this._valueHelpDialog1.open(t);if(t){this._valueHelpDialog1.getBinding("items").filter([new i("IMunicipio",sap.ui.model.FilterOperator.EQ,t)])}this._valueHelpDialog1.getBinding("items").filter([new i("IUf",sap.ui.model.FilterOperator.EQ,"SP")])},onSearchMunicipio:function(e){var t=e.getParameter("value");if(t){var a=t;var o=new sap.ui.model.Filter("IMunicipio",sap.ui.model.FilterOperator.EQ,a);var r=new sap.ui.model.Filter("IUf",sap.ui.model.FilterOperator.EQ,"SP");e.getSource().getBinding("items").filter([o,r])}},onConfirmMunicipio:function(e){var t=e.getParameter("selectedItem");this._valueHelpDialog1=null;if(t){var a=t.getTitle();var o=t.getDescription();var r=o+"-"+a;this.getView().byId("IdCodNat").setValue(r);var i=this.getView().byId(this.inputId);i.setValue(a)}},onEdit:function(){this.getView().byId("Form2").setVisible(false);this.getView().byId("form1").setVisible(true);this.getView().byId("UploadCollection").setUploadButtonInvisible(false);this.getView().byId("IdEnviarDetailDep").setVisible(true);this.getView().byId("IdEditDados").setVisible(false);this.getView().byId("IdCancelarDetailDep").setVisible(true)},onCancel:function(){this.getView().byId("Form2").setVisible(true);this.getView().byId("form1").setVisible(false);this.getView().byId("UploadCollection").setUploadButtonInvisible(true);this.getView().byId("IdEnviarDetailDep").setVisible(false);this.getView().byId("IdEditDados").setVisible(true);this.getView().byId("IdCancelarDetailDep").setVisible(false);this.getView().getModel().refresh(true)},onChange:function(e){var t=e.getSource();var a=this.getView().getModel();a.refreshSecurityToken();var o=a.oHeaders;var r=o["x-csrf-token"];var i=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:r});t.addHeaderParameter(i)},onBeforeUploadStarts:function(e){var t="0";var a="0002";var o="0";var r="0";if(t!==""||o!==""||r!==""){var i=t+"$"+a+"$"+o+"$"+r+"$"+e.getParameter("fileName");var s=new sap.m.UploadCollectionParameter({name:"slug",value:i});e.getParameters().addHeaderParameter(s)}},onuploadComplete:function(e){var t="0002";var a="0";var o="U";if(s!==""||a!==""){var r=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,t);var i=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var n=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,o);var d=this.getView().byId("UploadCollection");d.getBinding("items").filter([r,i,n])}},onmodelListContextChange:function(e){var t="0002";var a="0";var o="U";if(s!==""||a!==""){var r=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,s);var i=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,t);var n=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var d=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,o);var l=this.getView().byId("UploadCollection");l.getBinding("items").filter([r,i,n,d])}},onDeleteSelectedItems:function(e){var t="0002";var i="0";var n=this.getView().getModel();var d="0";var l="0";var u=t;var c="0";var g="E";var i=i;var m=e.getParameters("listItem");var I=m.documentId;I=parseInt(I);var p=this.getView().byId("idTipo").getValue();if(p==="Em ResoluÃ§Ã£o"){sap.m.MessageBox.error("Não será possivel exclusão do anexo, quando o chamado ja existir.");return}var f="/ZET_GLRH_UPLOADSet(Ano='"+d+"',Favor='"+l+"',Infty='"+u+"',Mes='"+c+"',Pernr='"+s+"',Tipo='"+g+"',Subty='"+i+"',DocId="+I+",Objps='',Icnum='')";var v={};v.DocId=1;var b=this.getView().byId("UploadCollection");var y=new a({title:"Confirmação",type:"Message",content:new r({text:"Confirma a exclusão anexo?"}),beginButton:new o({text:"Sim",press:function(){n.update(f,v,{success:function(e,t){sap.m.MessageBox.success("Documentos excluido com sucesso.",{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){b.getBinding("items").refresh(true)}})},error:function(e){var t=e;t=t.responseText;var a=JSON.parse(t);var o=a.error.message.value;sap.m.MessageBox.error(o,{actions:["OK",sap.m.MessageBox.Action.CLOSE],onClose:function(e){b.getBinding("items").refresh(true)}});return}});y.close()}}),endButton:new o({text:"Não",press:function(){y.close()}}),afterClose:function(){y.destroy()}});y.open()},formatVisibleEdit:function(e){if(e==="Em ResoluÃ§Ã£o"){return false}else{return true}}})});