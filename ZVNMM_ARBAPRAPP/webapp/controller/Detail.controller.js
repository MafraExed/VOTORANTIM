sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/m/library","sap/m/MessageToast"],function(e,t,n,i,o){"use strict";var s=i.URLHelper;return e.extend("zvnmmarbaprapp.controller.Detail",{formatter:n,onInit:function(){var e=new t({busy:false,delay:0,lineItemListTitle:this.getResourceBundle().getText("detailLineItemTableHeading")});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"detailView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this))},onSendEmailPress:function(){var e=this.getModel("detailView");s.triggerEmail(null,e.getProperty("/shareSendEmailSubject"),e.getProperty("/shareSendEmailMessage"))},onListUpdateFinished:function(e){var t,n=e.getParameter("total"),i=this.getModel("detailView");if(this.byId("lineItemsList").getBinding("items").isLengthFinal()){if(n){t=this.getResourceBundle().getText("detailLineItemTableHeadingCount",[n])}else{t=this.getResourceBundle().getText("detailLineItemTableHeading")}i.setProperty("/lineItemListTitle",t)}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_VNMM_GET_PR_DETAILSSet",{PRId:t});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("detailView");t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();return}var n=t.getPath(),i=this.getResourceBundle(),o=e.getModel().getObject(n),s=o.PRId,a=o.PRId,r=this.getModel("detailView");this.getOwnerComponent().oListSelector.selectAListItem(n);r.setProperty("/shareSendEmailSubject",i.getText("shareSendEmailObjectSubject",[s]));r.setProperty("/shareSendEmailMessage",i.getText("shareSendEmailObjectMessage",[a,s,location.href]))},_onMetadataLoaded:function(){var e=this.getView().getBusyIndicatorDelay(),t=this.getModel("detailView"),n=this.byId("lineItemsList"),i=n.getBusyIndicatorDelay();t.setProperty("/delay",0);t.setProperty("/lineItemTableDelay",0);n.attachEventOnce("updateFinished",function(){t.setProperty("/lineItemTableDelay",i)});t.setProperty("/busy",true);t.setProperty("/delay",e)},onCloseDetailPress:function(){this.getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",false);this.getOwnerComponent().oListSelector.clearMasterListSelection();this.getRouter().navTo("master")},toggleFullScreen:function(){var e=this.getModel("appView").getProperty("/actionButtonsInfo/midColumn/fullScreen");this.getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",!e);if(!e){this.getModel("appView").setProperty("/previousLayout",this.getModel("appView").getProperty("/layout"));this.getModel("appView").setProperty("/layout","MidColumnFullScreen")}else{this.getModel("appView").setProperty("/layout",this.getModel("appView").getProperty("/previousLayout"))}},onApproveButtonPress:function(e){var t=this;var n=new sap.m.Dialog({title:this.getView().getModel("i18n").getResourceBundle().getText("ActionConfirm"),type:"Message",content:[new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("Comment"),labelFor:"event"}),new sap.m.Input("event",{liveChange:function(e){var t=e.getParameter("value");var n=e.getSource().getParent();n.getBeginButton().setEnabled(t.length>0)},width:"100%",placeholder:this.getView().getModel("i18n").getResourceBundle().getText("CommentPlease")})],beginButton:new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Submit"),enabled:false,press:function(){var e=sap.ui.getCore().byId("event").getValue();t.doAction("approve",e);n.close()}}),endButton:new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Cancel"),press:function(){n.close()}}),afterClose:function(){n.destroy()}});n.open()},onRejectButtonPress:function(e){var t=this;var n=new sap.m.Dialog({title:this.getView().getModel("i18n").getResourceBundle().getText("ActionConfirm"),type:"Message",content:[new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("Comment"),labelFor:"event"}),new sap.m.Input("event",{liveChange:function(e){var t=e.getParameter("value");var n=e.getSource().getParent();n.getBeginButton().setEnabled(t.length>0)},width:"100%",placeholder:this.getView().getModel("i18n").getResourceBundle().getText("CommentPlease")})],beginButton:new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Submit"),enabled:false,press:function(){var e=sap.ui.getCore().byId("event").getValue();t.doAction("deny",e);n.close()}}),endButton:new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Cancel"),press:function(){n.close()}}),afterClose:function(){n.destroy()}});n.open()},onWithdrawButtonPress:function(e){var t=this;var n=new sap.m.Dialog({title:this.getView().getModel("i18n").getResourceBundle().getText("ActionConfirm"),type:"Message",content:[new sap.m.Label({text:this.getView().getModel("i18n").getResourceBundle().getText("Comment"),labelFor:"event"}),new sap.m.Input("event",{liveChange:function(e){var t=e.getParameter("value");var n=e.getSource().getParent();n.getBeginButton().setEnabled(t.length>0)},width:"100%",placeholder:this.getView().getModel("i18n").getResourceBundle().getText("CommentPlease")})],beginButton:new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Submit"),enabled:false,press:function(){var e=sap.ui.getCore().byId("event").getValue();t.doAction("withdraw",e);n.close()}}),endButton:new sap.m.Button({text:this.getView().getModel("i18n").getResourceBundle().getText("Cancel"),press:function(){n.close()}}),afterClose:function(){n.destroy()}});n.open()},onOpenInAribaPress:function(e){var t=this.getView().getBindingContext();var n=t.getPath();var i=t.getModel().getProperty(n);sap.m.URLHelper.redirect(i.FullURL,true)},doAction:function(e,t){var n=this;var i=this.getView().getBindingContext();var s=i.getPath();var a=i.getModel().getProperty(s);var r=this.getModel("detailView");var l={};l.Prid=a.PRId;l.Comment=t;l.Action=e;l.User=a.User;l.PasswordAdapter=a.PasswordAdapter;l.Realm=a.Realm;r.setProperty("/busy",true);this.getModel().create("/ZET_VNMM_TASK_ACTIONSet",l,{success:function(e,t){var i="";if(e.Response=="OK"){i=n.getView().getModel("i18n").getResourceBundle().getText("PRProcessedSuccessfully");i=i.replace("{0}",e.Prid)}else{i=e.Response}o.show(i);r.setProperty("/busy",false);n.onCloseDetailPress();n.getModel().refresh()},error:function(e){r.setProperty("/busy",false)}})}})});