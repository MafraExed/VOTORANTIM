sap.ui.define(["sap/ui/core/mvc/Controller","sap/ndc/BarcodeScanner","../util/formatter","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Filter"],function(e,t,a,s,r,i){"use strict";return e.extend("Workspace.zagrupador.controller.S0",{myFormatter:a,_onAttachRequest:function(){sap.ui.core.BusyIndicator.show()},_onAttachRequestCompleted:function(){sap.ui.core.BusyIndicator.hide()},onInit:function(){this._filtrarInicial();var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("S0").attachMatched(this.onRouterMatched,this)},_filtrarInicial:function(){var e=this.getView().byId("list0");var t=new sap.ui.model.Sorter("Agrupador",true);var a=e.getItems()[0].clone();e.bindAggregation("items",{path:"GE>/ZET_VCMM_AGRUPSet",sorter:t,template:a})},handleCriar:function(e){this.getView().setBusy(true);var t=this.getView().getModel("i18n").getResourceBundle();var a=this;var i=!!this.getView().$().closest(".sapUiSizeCompact").length;s.warning(t.getText("message_create_grouper"),{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],styleClass:i?"sapUiSizeCompact":"",onClose:function(e){if(e==="YES"){a._handleRouteTypeValueHelp()}else{r.show(t.getText("message_canceled_by_user"));a.getView().setBusy(false)}}})},_criarNovoAgrupador:function(e){var t=this;var a=this.getView();var r=a.getModel("i18n").getResourceBundle();var i=a.getModel("GE");a.setBusy(true);var o={groupId:"gpIdLeituraAgrup",success:(e,i)=>{if(e){if(e.Agrupador===undefined){var o=e.responseText;if(o!==undefined){var n=JSON.parse(o);s.error(n.error.message.value,{title:r.getText("Error"),styleClass:"sapUiSizeCompact"})}}else{var u=this.myFormatter.shiftLeadingZeros(e.Agrupador);s.success(r.getText("RecordedData",[u]),{styleClass:"sapUiSizeCompact",onClose:function(s){a.setBusy(false);t._goToLeitura(e.Agrupador)}})}}},error:(e,t)=>{var a=e.responseText;if(a!==undefined){var i="";try{var o=JSON.parse(a);i=o.error.message.value}catch(e){i=a}s.error(i,{title:r.getText("Error"),styleClass:"sapUiSizeCompact"})}else{s.error(r.getText("ErrorRecordedData"),{styleClass:"sapUiSizeCompact"})}}};i.attachRequestSent(this._onAttachRequest);i.attachRequestCompleted(this._onAttachRequestCompleted);i.setDeferredGroups(["gpIdLeituraAgrup"]);let n={};n.Rota=e;i.create("/ZET_VCMM_AGRUPSet",n,o);i.submitChanges(o);a.setBusy(false)},_handleRouteTypeValueHelp:function(e){if(!this._valueHelpDialog){this._valueHelpDialog=sap.ui.xmlfragment("Workspace.zagrupador.view.SRota",this);this.getView().addDependent(this._valueHelpDialog)}this._valueHelpDialog.open()},_handleRouteTypeValueHelpSearch:function(e){var t=e.getParameter("value");var a=new i("Descricao",sap.ui.model.FilterOperator.Contains,t);e.getSource().getBinding("items").filter([a])},_handleRouteTypeValueHelpClose:function(e){let t=e.getParameter("selectedItem");if(t){var a=t.getDescription();this._criarNovoAgrupador(a)}},onRouterMatched:function(e){if(this.atualizarLista){this.atualizarLista=false;var t=this.getView().byId("list0");t.getBinding("items").refresh()}},_goToLeitura:function(e){this.atualizarLista=true;var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("S1",{agrupador:e})},handleSearch:function(e){var t=this.getView().byId("list0");var a=e.getSource().getValue();var s=null;if(a&&a.length>0){s=new sap.ui.model.Filter("Agrupador",sap.ui.model.FilterOperator.EQ,a)}var r=t.getBinding("items");r.filter(s)},handleListItemPress:function(e){var t=e.getSource().getBindingContext("GE");if(t){var a=t.getProperty("Agrupador");this._onListItemPress(a)}},_onListItemPress:function(e){this.getView().setBusy(true);var t=this.myFormatter.shiftLeadingZeros(e);var a=this.getView().getModel("i18n").getResourceBundle();var i=this;var o=!!this.getView().$().closest(".sapUiSizeCompact").length;var n=a.getText("message_edit_grouper");n=n.concat(" ",[t]," ");n=n.concat("?");s.confirm(n,{actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],styleClass:o?"sapUiSizeCompact":"",onClose:function(t){if(t==="YES"){i._goToLeitura(e);i.getView().setBusy(false)}else{r.show(a.getText("message_canceled_by_user"));i.getView().setBusy(false)}}})}})});