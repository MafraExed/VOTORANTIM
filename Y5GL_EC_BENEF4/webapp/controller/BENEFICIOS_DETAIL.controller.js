sap.ui.define(["Y5GL_EC_BENEF4/Y5GL_EC_BENEF4/controller/BaseController","sap/ui/Device","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/Label","sap/m/TextArea","sap/m/ButtonType"],function(e,t,i,a,s,r,n,l,o,d){"use strict";var I,c,E,O,A,b;return e.extend("Y5GL_EC_BENEF4.Y5GL_EC_BENEF4.controller.BENEFICIOS_DETAIL",{onInit:function(){this.getRouter().getRoute("BENEFICIOS_DETAIL").attachPatternMatched(this._onObjectMatched,this);this.buscaImagem()},getValue:function(e){return this.getView().byId(e).getValue()},getSelect:function(e){return this.getView().byId(e).getSelectedKey()},_onObjectMatched:function(e){var t=e.getParameter("arguments").Zparam;var i=e.getParameter("arguments").Zdesc;while(i.indexOf("_")!=-1){i=i.replace("_","/")}var a="0";var s="V";this.getView().getModel().refresh(true);this.getView().byId("idTitleDependentes").setText(i);I=t;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZET_GLHR_DETAIL_BENEFICIOSSet",{Pernr:a,Beneficio:t,Tipo:s});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this;var i=this.getView().getModel();i.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){t.loading(true)},dataReceived:function(){t.loading(false)}}})},_onBindingChange:function(){this.filtraUploadCollection();this.getView().byId(I).setVisible(true);if(I!==undefined){switch(I){case"EMP_CONSIGNADO":this.empConsiginado();break;case"ADELANTO":this.configBeneficio();break;case"ADELANTO_SUELDOS":this.configBeneficio();break;case"ASIGNACION":this.configBeneficio();break;case"ASIGNACION_ESCOLAR":this.configBeneficio();break;case"AGUINALDO_NAVIDENO":this.configBeneficio();break;case"PASAJE_UNIVERSITARIO":this.pasajeUniversitario();break;case"ESTAC_MOVBUS":this.estacMovBus();break;case"LABORAL":this.laboral();break;case"PASAJE":this.pasaje();break;case"REEMBOLSO_CURSOS":this.reembolsoCursos();break;case"REEMBOLSO_EXPATRIADO":this.reembolsoExpatriado();break;case"REEMBOLSO_IDIOMA":this.reembolsoIdioma();break;case"SEGURO_DE_VIDA":this.seguroVida();break;case"PLANO_MEDICO":this.planoMedico();break}}},filtraUploadCollection:function(){var e,t;if(I!==undefined){switch(I){case"EMP_CONSIGNADO":e="XXXX";t="EMCO";break;case"ADELANTO":e="XXXX";t="ADEL";break;case"ADELANTO_SUELDOS":e="XXXX";t="ADES";break;case"ASIGNACION":e="XXXX";t="ASIG";break;case"ASIGNACION_ESCOLAR":e="XXXX";t="ASIE";break;case"AGUINALDO_NAVIDENO":e="XXXX";t="AGUI";break;case"PASAJE_UNIVERSITARIO":e="XXXX";t="PASU";break;case"ESTAC_MOVBUS":e="XXXX";t="ESMV";break;case"LABORAL":e="XXXX";t="LABO";break;case"PASAJE":e="XXXX";t="PASA";break;case"REEMBOLSO_CURSOS":e="XXXX";t="RECU";break;case"REEMBOLSO_EXPATRIADO":e="XXXX";t="REEX";break;case"REEMBOLSO_IDIOMA":e="XXXX";t="REID";break;case"SEGURO_DE_VIDA":e="0037";t="PE05";break;case"PLANO_MEDICO":e="PS01";t="PS01";break}if(t!==""){var i=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,"0");var a=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,e);var s=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,t);var r=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,"B");var n=this.getView().byId("UploadCollection");n.getBinding("items").filter([i,a,s,r])}}},empConsiginado:function(){var e=this.getView().byId("idTipo").getValue();if(e!==""){if(e!=="X"){this.getView().byId("IdEditDetailDep").setVisible(false)}}else{this.getView().byId("IdEditDetailDep").setVisible(true)}this.getView().byId("IdEditDetailDep").setText("Solicitación")},configBeneficio:function(){var e=this.getView().byId("idTipo").getValue();if(e!==""){if(e!=="X"){this.getView().byId("IdEditDetailDep").setVisible(false)}}else{this.getView().byId("IdEditDetailDep").setVisible(true)}this.getView().byId("IdEditDetailDep").setText("Solicitación")},pasajeUniversitario:function(){this.getView().byId("IdEditDetailDep").setText("Solicitación");this.getView().byId("IdPlano_PASAJE_UNIVERSITARIO").setSelectedKey();this.getView().byId("IdAno_PASAJE_UNIVERSITARIO").setSelectedKey()},estacMovBus:function(){this.getView().byId("IdEditDetailDep").setText("Solicitación")},laboral:function(){this.getView().byId("IdEditDetailDep").setText("Solicitar");this.getView().byId("IdPlano_LABORAL").setSelectedKey();this.getView().byId("IdAno_LABORAL").setSelectedKey()},pasaje:function(){this.getView().byId("IdEditDetailDep").setText("Solicitar");this.getView().byId("IdPlano_PASAJE").setSelectedKey();this.getView().byId("IdAno_PASAJE").setSelectedKey()},reembolsoCursos:function(){this.getView().byId("IdEditDetailDep").setText("Solicitar")},reembolsoExpatriado:function(){this.getView().byId("IdEditDetailDep").setText("Solicitar")},reembolsoIdioma:function(){this.getView().byId("IdEditDetailDep").setText("Solicitar")},seguroVida:function(){this.getView().byId("IdIncluir").setVisible(false);var e=this.getView().byId("IdPlano_SEGURO_DE_VIDA").getSelectedKey();var t=this.getView().byId("IdOpcoes_SEGURO_DE_VIDA").getBinding("items");var i=new sap.ui.model.Filter("Bplan",sap.ui.model.FilterOperator.EQ,e);t.filter([i]);this.getView().byId("IdSegundaVia").setVisible(false);this.getView().byId("IdEditDetailDep").setText("Editar plan")},planoMedico:function(){var e=this.getView().byId("IdPlano_PLANO_MEDICO").getSelectedKey();var t=this.getView().byId("IdOpcoes_PLANO_MEDICO").getBinding("items");var i=this.getView().byId("smartTable");var a=new sap.ui.model.Filter("Bplan",sap.ui.model.FilterOperator.EQ,e);i.rebindTable("e");this.getView().byId("IdIncluir").setVisible(true);t.filter([a]);this.getView().byId("IdEditDetailDep").setText("Solicitar");this.getView().byId("IdCancelDetailDep").setVisible(false)},formatFalse:function(){return false},onVoltar:function(){var e;var i;this.getView().byId("IdCancelDetailDep").setVisible(false);e=!t.system.phone;i="master";this.getRouter().navTo(i,e)},onCancel:function(){var e;var t=this;e=new i({title:"Confirmacion",type:"Message",content:new s({text:"¿Quieres cancelar el cambio?"}),beginButton:new a({text:"Sí",press:function(){t.Cancela();t.getView().byId("TextInclusao").setVisible(false);e.close()}}),endButton:new a({text:"No",press:function(){e.close()}}),afterClose:function(){e.destroy()}});e.open()},Cancela:function(){var e=this;e.getView().getModel().refresh(true);switch(I){case"PLANO_MEDICO":e.getView().byId("TextInclusao").setVisible(false);e.getView().byId("TextExclusao").setVisible(false);break}e.getView().byId("UploadCollection").setUploadButtonInvisible(false);e.getView().byId("IdCancelDetailDep").setVisible(false);e.getView().byId("IdIncluir").setVisible(false);e.getView().byId("IdSalvarDetailDep").setVisible(false);e.getView().byId("UPLOAD").setVisible(false)},FormatBVisible:function(e){if(e!==null){if(e==="Não"||e==="Sim"){return true}else{return false}}},formatVisibleMsg:function(e){if(I!=="PASAJE"){if(I!=="LABORAL"){if(e!=="X"){if(e!==""){return true}else{return false}}else{return false}}else{return false}}else{return false}},formatVisibleEditOpcoes:function(e){if(I!=="PASAJE"){if(I!=="LABORAL"){if(e!=="X"){if(e!==""){return false}else{return true}}else{return true}}else{return true}}else{return true}},FormatEditable:function(e){if(e===""){return true}else{return false}},formatVisiblebButton:function(e){if(I!=="PASAJE"){if(I!=="LABORAL"){if(e!=="X"){if(e===""){return false}else{return true}}else{return false}}else{return false}}else{return false}},FormatBV:function(e){if(I!=="COOPERATIVA"){if(I!=="TRANSPORTE"){if(e==="Em ResoluÃ§Ã£o"||e===""){return false}else{return true}}else{return false}}else{return false}},onEdit:function(){var e=this.getView();var t=true;var i="";e.byId("UPLOAD").setVisible(true);switch(I){case"EMP_CONSIGNADO":this.getView().byId("TextEMP_CONSIGNADO").setVisible(true);break;case"ADELANTO":this.getView().byId("TextADELANTO").setVisible(true);break;case"ADELANTO_SUELDOS":this.getView().byId("TextADELANTO_SUELDOS").setVisible(true);break;case"ASIGNACION":this.getView().byId("TextASIGNACION").setVisible(true);break;case"ASIGNACION_ESCOLAR":this.getView().byId("TextASIGNACION_ESCOLAR").setVisible(true);break;case"AGUINALDO_NAVIDENO":this.getView().byId("TextAGUINALDO_NAVIDENO").setVisible(true);break;case"PASAJE_UNIVERSITARIO":this.getView().byId("IdPlano_PASAJE_UNIVERSITARIO").setEditable(true);this.getView().byId("IdAno_PASAJE_UNIVERSITARIO").setEditable(true);this.getView().byId("TextPASAJE_UNIVERSITARIO").setVisible(true);break;case"ESTAC_MOVBUS":this.getView().byId("IdPlano_ESTAC_MOVBUS").setEditable(true);this.getView().byId("IdAno_ESTAC_MOVBUS").setEditable(true);this.getView().byId("TextESTAC_MOVBUS").setVisible(true);break;case"LABORAL":this.getView().byId("IdPlano_LABORAL").setEditable(true);this.getView().byId("IdAno_LABORAL").setEditable(true);this.getView().byId("TextLABORAL").setVisible(true);break;case"PASAJE":this.getView().byId("IdPlano_PASAJE").setEditable(true);this.getView().byId("IdAno_PASAJE").setEditable(true);this.getView().byId("TextTransporte").setVisible(true);break;case"REEMBOLSO_CURSOS":this.getView().byId("IdPlano_REEMBOLSO_CURSOS").setEditable(true);this.getView().byId("IdAno_REEMBOLSO_CURSOS").setEditable(true);this.getView().byId("TextREEMBOLSO_CURSOS").setVisible(true);break;case"REEMBOLSO_EXPATRIADO":this.getView().byId("IdPlano_REEMBOLSO_EXPATRIADO").setEditable(true);this.getView().byId("IdAno_REEMBOLSO_EXPATRIADO").setEditable(true);this.getView().byId("TextREEMBOLSO_EXPATRIADO").setVisible(true);break;case"REEMBOLSO_IDIOMA":this.getView().byId("IdPlano_REEMBOLSO_IDIOMA").setEditable(true);this.getView().byId("IdAno_REEMBOLSO_IDIOMA").setEditable(true);this.getView().byId("TextREEMBOLSO_IDIOMA").setVisible(true);break;case"SEGURO_DE_VIDA":this.getView().byId("IdPlano_SEGURO_DE_VIDA").setEditable(true);this.getView().byId("IdOpcoes_SEGURO_DE_VIDA").setEditable(true);this.getView().byId("TextPlano").setVisible(true);break;case"PLANO_MEDICO":this.getView().byId("IdPlano_PLANO_MEDICO").setEditable(true);this.getView().byId("IdOpcoes_PLANO_MEDICO").setEditable(true);this.getView().byId("IdSegundaVia").setVisible(false);this.getView().byId("TextInclusao").setVisible(true);break}this.getView().byId("IdCancelDetailDep").setVisible(true);this.getView().byId("IdSalvarDetail").setVisible(true)},onChange:function(e){var t=e.getSource();var i=this.getView().getModel();i.refreshSecurityToken();var a=i.oHeaders;var s=a["x-csrf-token"];var r=new sap.m.UploadCollectionParameter({name:"x-csrf-token",value:s});t.addHeaderParameter(r)},onDeleteSelectedItems:function(e){var t=this.getView().getModel();var r=this.getView().byId("UploadCollection");var n=r.oList;var l=e.getParameters("listItem");var o=l.documentId;var d=this.getView().byId("idTipo").getValue();var A="";var b="";var u=" ";var S="0";var X="0";var f="0";var g="0";var V="E";var p="0";var _="0";var D="";var h="";var v="";var w={};var N="";var L="";var y="";var C="";var m="";var R=this;if(I!==undefined){switch(I){case"EMP_CONSIGNADO":A="XXXX";b="EMCO";m="x";break;case"ADELANTO":A="XXXX";b="ADEL";m="x";break;case"ADELANTO_SUELDOS":A="XXXX";b="ADES";m="x";break;case"ASIGNACION":A="XXXX";b="ASIG";m="x";break;case"ASIGNACION_ESCOLAR":A="XXXX";b="ASIE";m="x";break;case"AGUINALDO_NAVIDENO":A="XXXX";b="AGUI";m="x";break;case"PASAJE_UNIVERSITARIO":A="XXXX";b="PASU";break;case"ESTAC_MOVBUS":A="XXXX";b="ESMV";break;case"LABORAL":A="XXXX";b="LABO";break;case"PASAJE":A="XXXX";b="PASA";break;case"REEMBOLSO_CURSOS":A="XXXX";b="RECU";break;case"REEMBOLSO_EXPATRIADO":A="XXXX";b="REEX";break;case"REEMBOLSO_IDIOMA":A="XXXX";b="REID";break;case"SEGURO_DE_VIDA":A="0037";b="PE05";m="x";break;case"PLANO_MEDICO":A="0167";b="PS01";m="x";break}if(m!=="x"){S=this.getSelect("IdPlano_"+I);X=this.getSelect("IdAno_"+I);u=S+"_"+X}if(d==="Em ResoluÃ§Ã£o"){sap.m.MessageBox.error("No será posible eliminar el adjunto cuando el ticket ya exista.");return}if(c==="I"){D="No hay dependientes marcados para su inclusión"}else{D="No hay dependientes marcados para Exclusión"}if(E==="X"){if(c==="I"){h="I@";D="Não existem dependentes marcados para inclusão"}else{h="E@";D="Não existem dependentes marcados para Exclusão"}var P=O;b=P.split(",");b=b[2];b=b.split("Subty=");b=b[1];while(b.indexOf("'")!==-1){b=b.replace("'","")}if(b<10){b="0"+b}_=P.split(",");_=_[3];_=_.split("Objps=");_=_[1];while(_.indexOf("'")!==-1){_=_.replace("'","")}while(_.indexOf(")")!==-1){_=_.replace(")","")}if(_===""){_="00"}h=h+b+"-"+_}o=parseInt(o);v="/ZET_GLRH_UPLOADSet(Ano='"+X+"',Favor='"+f+"',Infty='"+A+"',Mes='"+S+"',Pernr='"+g+"',Tipo='"+V+"',Subty='"+b+"',DocId="+o+",Objps='',Icnum='',Valor='"+u+"',Dependentes='"+h+"',Area='"+p+"')";w.DocId=o;w.Valor=u;N=new i({title:"Confirmación",type:"Message",content:new s({text:"¿Confirmar la eliminación del archivo adjunto?"}),beginButton:new a({text:"Sí ",press:function(){t.update(v,w,{success:function(e,t){sap.m.MessageBox.success("Documentos eliminados correctamente.",{actions:["OK"],onClose:function(e){r.getBinding("items").refresh(true);R.getView().byId("IdPlano_"+I).setEditable(true);R.getView().byId("IdAno_"+I).setEditable(true)}})},error:function(e){L=e.responseText;y=JSON.parse(L);C=y.error.message.value;sap.m.MessageBox.error(C,{actions:["OK"],onClose:function(e){r.getBinding("items").refresh(true)}});return}});N.close()}}),endButton:new a({text:"No",press:function(){N.close()}}),afterClose:function(){N.destroy()}});N.open()}},onBeforeUploadStarts:function(e){var t="0";var i="0";var a="0";var s="0";var r;var n="";var l="";var o="";var d="";var b;var u;if(I!==undefined){switch(I){case"EMP_CONSIGNADO":i="XXXX";a="EMCO";l="x";break;case"ADELANTO":i="XXXX";a="ADEL";l="x";break;case"ADELANTO_SUELDOS":i="XXXX";a="ADES";l="x";break;case"ASIGNACION":i="XXXX";a="ASIG";l="x";break;case"ASIGNACION_ESCOLAR":i="XXXX";a="ASIE";l="x";break;case"AGUINALDO_NAVIDENO":i="XXXX";a="AGUI";l="x";break;case"PASAJE_UNIVERSITARIO":i="XXXX";a="PASU";break;case"ESTAC_MOVBUS":i="XXXX";a="ESMV";break;case"LABORAL":i="XXXX";a="LABO";break;case"PASAJE":i="XXXX";a="PASA";break;case"REEMBOLSO_CURSOS":i="XXXX";a="RECU";break;case"REEMBOLSO_EXPATRIADO":i="XXXX";a="REEX";break;case"REEMBOLSO_IDIOMA":i="XXXX";a="REID";break;case"SEGURO_DE_VIDA":i="0037";a="PE05";l="x";break;case"PLANO_MEDICO":i="0167";a="PS01";l="x";break}if(l!=="x"){b=this.getSelect("IdPlano_"+I);if(b===""){sap.m.MessageBox.error("Seleccione el mes de referencia.");return}u=this.getSelect("IdAno_"+I);if(u===""){sap.m.MessageBox.error("Seleccione año de referencia.");return}n=b+"_"+u}if(E==="X"){var S=r.getSelectedIndices();if(c==="I"){o="I@";d="Não existem dependentes marcados para inclusão"}else if(c==="E"){o="E@";d="Não existem dependentes marcados para Exclusão"}else if(A==="X"){o="2@";d="Não existem dependentes marcados para solicitação de segunda via.";for(var X=0;X<S.length;X++){a=r.getContextByIndex([S[X]]).getObject().Subty;s=r.getContextByIndex([S[X]]).getObject().Objps;o=o+a+"-"+s+"@"}}if(A!=="X"){var f=O;a=f.split(",");a=a[2];a=a.split("Subty=");a=a[1];while(a.indexOf("'")!==-1){a=a.replace("'","")}if(a<10){a="0"+a}s=f.split(",");s=s[3];s=s.split("Objps=");s=s[1];while(s.indexOf("'")!==-1){s=s.replace("'","")}while(s.indexOf(")")!==-1){s=s.replace(")","")}if(s===""){s="00"}o=o+a+"-"+s}}if(t!==""||a!==""||s!==""){var g=t+"$"+i+"$"+a+"$"+s+"$"+e.getParameter("fileName")+"$ $ $"+o+"$"+n;var V=new sap.m.UploadCollectionParameter({name:"slug",value:g});e.getParameters().addHeaderParameter(V)}}},onuploadComplete:function(e){var t="0";var i;var a;var s="";var r;var n;var l="";var o="";var d="";var b="";if(I!==undefined){switch(I){case"EMP_CONSIGNADO":i="XXXX";a="EMCO";l="x";break;case"ADELANTO":i="XXXX";a="ADEL";l="x";break;case"ADELANTO_SUELDOS":i="XXXX";a="ADES";l="x";break;case"ASIGNACION":i="XXXX";a="ASIG";l="x";break;case"ASIGNACION_ESCOLAR":i="XXXX";a="ASIE";l="x";break;case"AGUINALDO_NAVIDENO":i="XXXX";a="AGUI";l="x";break;case"PASAJE_UNIVERSITARIO":i="XXXX";a="PASU";break;case"ESTAC_MOVBUS":i="XXXX";a="ESMV";break;case"LABORAL":i="XXXX";a="LABO";break;case"PASAJE":i="XXXX";a="PASA";break;case"REEMBOLSO_CURSOS":i="XXXX";a="RECU";break;case"REEMBOLSO_EXPATRIADO":i="XXXX";a="REEX";break;case"REEMBOLSO_IDIOMA":i="XXXX";a="REID";break;case"SEGURO_DE_VIDA":i="0037";a="PE05";l="x";break;case"PLANO_MEDICO":i="0167";a="PS01";l="x";break}if(l!=="x"){r=this.getSelect("IdPlano_"+I);n=this.getSelect("IdAno_"+I);s=r+"_"+n;this.getView().byId("IdPlano_"+I).setEditable(false);this.getView().byId("IdAno_"+I).setEditable(false)}if(E==="X"){if(c==="I"){o="I@";d="Não existem dependentes marcados para inclusão"}else{o="E@";d="Não existem dependentes marcados para Exclusão"}if(A!=="X"){var u=O;a=u.split(",");a=a[2];a=a.split("Subty=");a=a[1];while(a.indexOf("'")!==-1){a=a.replace("'","")}if(a<10){a="0"+a}b=u.split(",");b=b[3];b=b.split("Objps=");b=b[1];while(b.indexOf("'")!==-1){b=b.replace("'","")}while(b.indexOf(")")!==-1){b=b.replace(")","")}if(b===""){b="00"}o=o+a+"-"+b}}if(t!==""||a!==""){var S=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,"U");var X=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,i);var f=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var g=new sap.ui.model.Filter("Valor",sap.ui.model.FilterOperator.EQ,s);var V=this.getView().byId("UploadCollection");V.getBinding("items").filter([X,f,S,g])}}},onmodelListContextChange:function(e){var t="0";var i;var a;var s;var r;var n;var l="";if(I!==undefined){switch(I){case"EMP_CONSIGNADO":i="XXXX";a="EMCO";l="x";break;case"ADELANTO":i="XXXX";a="ADEL";l="x";break;case"ADELANTO_SUELDOS":i="XXXX";a="ADES";l="x";break;case"ASIGNACION":i="XXXX";a="ASIG";l="x";break;case"ASIGNACION_ESCOLAR":i="XXXX";a="ASIE";l="x";break;case"AGUINALDO_NAVIDENO":i="XXXX";a="AGUI";l="x";break;case"PASAJE_UNIVERSITARIO":i="XXXX";a="PASU";break;case"ESTAC_MOVBUS":i="XXXX";a="ESMV";break;case"LABORAL":i="XXXX";a="LABO";break;case"PASAJE":i="XXXX";a="PASA";break;case"REEMBOLSO_CURSOS":i="XXXX";a="RECU";break;case"REEMBOLSO_EXPATRIADO":i="XXXX";a="REEX";break;case"REEMBOLSO_IDIOMA":i="XXXX";a="REID";break;case"SEGURO_DE_VIDA":i="0037";a="PE05";l="x";break;case"PLANO_MEDICO":i="0167";a="PS01";l="x";break}if(l!=="x"){r=this.getSelect("IdPlano_"+I);s=r+"_"+n}if(t!==""||a!==""){var o=new sap.ui.model.Filter("Pernr",sap.ui.model.FilterOperator.EQ,t);var d=new sap.ui.model.Filter("Infty",sap.ui.model.FilterOperator.EQ,i);var c=new sap.ui.model.Filter("Subty",sap.ui.model.FilterOperator.EQ,a);var E=new sap.ui.model.Filter("Tipo",sap.ui.model.FilterOperator.EQ,"B");var O=new sap.ui.model.Filter("Valor",sap.ui.model.FilterOperator.EQ,s);var A=this.getView().byId("UploadCollection");A.getBinding("items").filter([o,d,c,E,O])}}},onSave:function(e){var t;var i=this.getView().getModel();var a={};var s=this;var r=I;var n="0";var l;if(b==="C"){l=b}else{l="G"}var o="/ZET_GLHR_DETAIL_BENEFICIOSSet(Pernr='"+n+"',Beneficio='"+r+"',Tipo='"+l+"')";var d="";switch(r){case"EMP_CONSIGNADO":a.Rubrica=this.getSelect("IdPlano_EMP_CONSIGNADO");d="x";break;case"ADELANTO":a.Rubrica=this.getSelect("IdPlano_ADELANTO");d="x";break;case"ADELANTO_SUELDOS":a.Rubrica=this.getSelect("IdPlano_ADELANTO_SUELDOS");d="x";break;case"ASIGNACION":a.Rubrica=this.getSelect("IdPlano_ASIGNACION");d="x";break;case"ASIGNACION_ESCOLAR":a.Rubrica=this.getSelect("IdPlano_ASIGNACION_ESCOLAR");d="x";break;case"AGUINALDO_NAVIDENO":a.Rubrica=this.getSelect("IdPlano_AGUINALDO_NAVIDENO");d="x";break;case"SEGURO_DE_VIDA":a.Bplan=this.getSelect("IdPlano_SEGURO_DE_VIDA");if(a.Bplan===""){this.getView().byId("IdPlano_SEGURO_DE_VIDA").setValueState("Error");sap.m.MessageBox.error("Informar el plan");return}else{this.getView().byId("IdPlano_SEGURO_DE_VIDA").setValueState("Success")}a.Opcoes=this.getView().byId("IdOpcoes_SEGURO_DE_VIDA").getSelectedKey();if(a.Opcoes===""){this.getView().byId("IdOpcoes_SEGURO_DE_VIDA").setValueState("Error");sap.m.MessageBox.error("Selecciona entre las opciones");return}else{this.getView().byId("IdOpcoes_SEGURO_DE_VIDA").setValueState("Success")}d="x";break;case"PLANO_MEDICO":a.Bplan=this.getSelect("IdPlano_PLANO_MEDICO");a.Opcoes=this.getSelect("IdOpcoes_PLANO_MEDICO");d="x";break}if(d!=="x"){var c=this.getSelect("IdPlano_"+I);var E=this.getSelect("IdAno_"+I);a.Valor=c+"_"+E}a.Tipo=a.Operation;a.Beneficio=r;if(a.Montante!==""&&a.Montante!==undefined){while(a.Montante.indexOf(".")!==-1){a.Montante=a.Montante.replace(".","")}a.Montante=a.Montante.replace(",",".")}this.GravaBeneficio(o,a,e)},GravaBeneficio:function(e,t,r){var n=this;var l=this.getView().getModel();var o="";if(r==="X"){o="¿Confirmar pedido duplicado?"}else{o="¿Confirma el cambio / inclusión del beneficio?"}var d=new i({title:"Confirmación",type:"Message",content:new s({text:o}),beginButton:new a({text:"Sí",press:function(){l.update(e,t,{success:function(e,t){sap.m.MessageBox.success("Solicitud enviada",{actions:["OK"],onClose:function(e){n.getView().getModel().refresh(true);n.getView().byId("IdCancelDetailDep").setVisible(false)}})},error:function(e){var t=e;t=t.responseText;var i=JSON.parse(t);var a=i.error.message.value;var s=i.error.code;if(s==="Fiori - W/001"){sap.m.MessageBox.warning(a,{actions:["OK"],onClose:function(e){n.getView().getModel().refresh(true);n.getView().byId("IdCancelDetailDep").setVisible(false)}})}else{sap.m.MessageBox.error(a,{actions:["OK"],onClose:function(e){}});return}}});d.close()}}),endButton:new a({text:"No",press:function(){d.close()}}),afterClose:function(){d.destroy()}});d.open()},onchangeIdMargemEmp:function(e){var t=this;var i;var a=e.getParameter("value");var s=e.getParameter("id");var r=s.split("DETAIL--")[1];var n;n=a;while(a.indexOf(",")!==-1){a=a.replace(",",".")}i=!isNaN(a);if(i===true){a=this.adicionarpontoFloat(n);this.getView().byId(r).setValue(a)}else{sap.m.MessageBox.error("O valor informado deverá ser um número.",{actions:["OK"],onClose:function(e){t.getView().byId("IdMargemEmp").setValue()}})}},onAdd:function(){var e="0";var t="A";var i="0";var a="-";var s="-";var r="DependentesAdd";var n="-";this.getRouter().navTo(r,{Pernr:e,Subty:a,Objps:i,Tipo:t,Favor:s,Icnum:n})},onAnoReferenciaChanged:async function(e){const t=I;const i=this.getView();i.setBusy(true);const a=e.getParameters().value;const s=await this.getMinhasSolicitacoesCount(t,a);const r=s>0;i.setBusy(false);if(r){sap.m.MessageBox.warning(`Ya ha registrado una solicitud en el año ${a}. Por favor, asegúrese que esta nueva solicitud sea por un hijo distinto.`)}},getMinhasSolicitacoesCount:async function(e,t){const i=this.getView().getModel();const a=[new r("Beneficio",n.EQ,e),new r("DataCriacao",n.Contains,t)];return new Promise((e,t)=>{i.read("/ZET_GLHR_MINHAS_SOLICITACOESSet/$count",{filters:a,success:t=>{e(Number.parseInt(t,10))},error:e=>{t(e)}})})},onSegunda:function(){var e=this;var t;A="X";var i;if(I==="PLANO_MEDICO"){i=this.getView().byId("table1").getBinding("rows").getLength()}else if(I==="PLANO_ODONTOLOGICO"){i=this.getView().byId("table1_PLANO_ODONTOLOGICO").getBinding("rows").getLength()}if(i>0){t="Deseje solicitar segunda via da carterinha para:";sap.m.MessageBox.show(t,{actions:["Dependente","Titular"],onClose:function(t){if(t==="Dependente"){if(I==="PLANO_MEDICO"){e.byId("table1").setSelectionMode("MultiToggle");e.byId("IdCancelBeneficio").setVisible(false);e.byId("IdSegundaVia").setVisible(false);e.byId("IdCancelDetailDep").setVisible(true);e.byId("IdSalvarDetailDep").setVisible(true);e.byId("UPLOAD").setVisible(true);E="X"}else if(I==="PLANO_ODONTOLOGICO"){e.byId("table1_PLANO_ODONTOLOGICO").setSelectionMode("MultiToggle");e.byId("IdCancelBeneficio").setVisible(false);e.byId("IdSegundaVia").setVisible(false);e.byId("IdCancelDetailDep").setVisible(true);e.byId("IdSalvarDetailDep").setVisible(true);e.byId("UPLOAD").setVisible(true)}}else if(t==="Titular"){e.byId("UPLOAD").setVisible(true);e.byId("IdSegundaVia").setVisible(false);e.byId("IdCancelBeneficio").setVisible(false);e.byId("IdSalvarDetail2via").setVisible(true);e.byId("IdCancelDetailDep").setVisible(true)}}})}else{e.onSave(A)}}})});